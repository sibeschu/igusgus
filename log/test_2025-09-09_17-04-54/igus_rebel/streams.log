[0.019s] Invoking command in '/home/amrl-linux24-04/ros2_ben/build/igus_rebel': AMENT_PREFIX_PATH=/home/amrl-linux24-04/ros2_ben/install/igus_rebel:/home/amrl-linux24-04/ros2_ben/install/igus_rebel_msgs:${AMENT_PREFIX_PATH} CMAKE_PREFIX_PATH=/home/amrl-linux24-04/ros2_ben/install/igus_rebel:/home/amrl-linux24-04/ros2_ben/install/igus_rebel_msgs:${CMAKE_PREFIX_PATH} DEBUGINFOD_URLS=https://debuginfod.ubuntu.com LD_LIBRARY_PATH=/home/amrl-linux24-04/ros2_ben/install/igus_rebel/lib:/home/amrl-linux24-04/ros2_ben/install/igus_rebel_msgs/lib:${LD_LIBRARY_PATH} PYTHONPATH=/home/amrl-linux24-04/ros2_ben/install/igus_rebel_msgs/lib/python3.12/site-packages:${PYTHONPATH} /usr/bin/ctest -C Release -D ExperimentalTest --no-compress-output -V --force-new-ctest-process
[0.024s] UpdateCTestConfiguration  from :/home/amrl-linux24-04/ros2_ben/build/igus_rebel/CTestConfiguration.ini
[0.024s] Parse Config file:/home/amrl-linux24-04/ros2_ben/build/igus_rebel/CTestConfiguration.ini
[0.024s]    Site: amrl-linux24-04-ThinkPad-E16-Gen-2
[0.024s]    Build name: (empty)
[0.024s]  Add coverage exclude regular expressions.
[0.024s] Create new tag: 20250909-1504 - Experimental
[0.025s] UpdateCTestConfiguration  from :/home/amrl-linux24-04/ros2_ben/build/igus_rebel/CTestConfiguration.ini
[0.025s] Parse Config file:/home/amrl-linux24-04/ros2_ben/build/igus_rebel/CTestConfiguration.ini
[0.025s] Test project /home/amrl-linux24-04/ros2_ben/build/igus_rebel
[0.025s] Constructing a list of tests
[0.025s] Done constructing a list of tests
[0.025s] Updating test list for fixtures
[0.025s] Added 0 tests to meet fixture requirements
[0.025s] Checking test dependency graph...
[0.025s] Checking test dependency graph end
[0.025s] test 1
[0.026s]     Start 1: cppcheck
[0.026s] 
[0.026s] 1: Test command: /usr/bin/python3 "-u" "/opt/ros/jazzy/share/ament_cmake_test/cmake/run_test.py" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/cppcheck.xunit.xml" "--package-name" "igus_rebel" "--output-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/ament_cppcheck/cppcheck.txt" "--command" "/opt/ros/jazzy/bin/ament_cppcheck" "--xunit-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/cppcheck.xunit.xml" "--include_dirs" "/home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel/include"
[0.026s] 1: Working Directory: /home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel
[0.026s] 1: Test timeout computed to be: 300
[0.067s] 1: -- run_test.py: invoking following command in '/home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel':
[0.067s] 1:  - /opt/ros/jazzy/bin/ament_cppcheck --xunit-file /home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/cppcheck.xunit.xml --include_dirs /home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel/include
[0.114s] 1: cppcheck 2.13.0 has known performance issues and therefore will not be used, set the AMENT_CPPCHECK_ALLOW_SLOW_VERSIONS environment variable to override this.
[0.122s] 1: -- run_test.py: return code 0
[0.122s] 1: -- run_test.py: verify result file '/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/cppcheck.xunit.xml'
[0.127s] 1/6 Test #1: cppcheck .........................   Passed    0.10 sec
[0.127s] test 2
[0.127s]     Start 2: flake8
[0.127s] 
[0.127s] 2: Test command: /usr/bin/python3 "-u" "/opt/ros/jazzy/share/ament_cmake_test/cmake/run_test.py" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/flake8.xunit.xml" "--package-name" "igus_rebel" "--output-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/ament_flake8/flake8.txt" "--command" "/opt/ros/jazzy/bin/ament_flake8" "--xunit-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/flake8.xunit.xml"
[0.127s] 2: Working Directory: /home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel
[0.127s] 2: Test timeout computed to be: 60
[0.170s] 2: -- run_test.py: invoking following command in '/home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel':
[0.170s] 2:  - /opt/ros/jazzy/bin/ament_flake8 --xunit-file /home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/flake8.xunit.xml
[0.300s] 2: from launch.substitutions import Command, FindExecutable, LaunchConfiguration
[0.300s] 2: ^
[0.300s] 2: from launch.actions import IncludeLaunchDescription, DeclareLaunchArgument
[0.300s] 2: ^
[0.300s] 2: from launch.actions import IncludeLaunchDescription, DeclareLaunchArgument
[0.300s] 2: ^
[0.300s] 2: from launch.actions import IncludeLaunchDescription, DeclareLaunchArgument
[0.300s] 2: ^
[0.300s] 2: from launch.launch_description_sources import PythonLaunchDescriptionSource
[0.300s] 2: ^
[0.300s] 2: from ament_index_python.packages import get_package_share_directory
[0.300s] 2: ^
[0.301s] 2: import os
[0.301s] 2: ^
[0.301s] 2: import os
[0.301s] 2: ^
[0.301s] 2:     env = {
[0.301s] 2:     ^
[0.301s] 2:     
[0.301s] 2: ^
[0.301s] 2:         "hardware_protocol",
[0.301s] 2:         ^
[0.301s] 2:         default_value="rebel",
[0.301s] 2:                       ^
[0.301s] 2:         choices=["mock_hardware", "gazebo", "rebel"],
[0.301s] 2:                  ^
[0.301s] 2:         choices=["mock_hardware", "gazebo", "rebel"],
[0.302s] 2:                                   ^
[0.302s] 2:         choices=["mock_hardware", "gazebo", "rebel"],
[0.302s] 2:                                             ^
[0.302s] 2:         description="Which hardware protocol or mock hardware should be used",
[0.302s] 2:                     ^
[0.302s] 2:     
[0.302s] 2: ^
[0.302s] 2:     igus_rebel_pkg = get_package_share_directory("igus_rebel")
[0.302s] 2:                                                  ^
[0.302s] 2:     igus_rebel_desc_pkg = get_package_share_directory("igus_rebel_description")
[0.302s] 2:                                                       ^
[0.302s] 2:     
[0.302s] 2: ^
[0.302s] 2:     controller_config_path = os.path.join(igus_rebel_pkg, "config", "controller.yaml")
[0.302s] 2:                                                           ^
[0.302s] 2:     controller_config_path = os.path.join(igus_rebel_pkg, "config", "controller.yaml")
[0.302s] 2:                                                                     ^
[0.302s] 2:     robot_description = {"robot_description" : Command(
[0.303s] 2:                          ^
[0.303s] 2:     robot_description = {"robot_description" : Command(
[0.303s] 2:                                             ^
[0.303s] 2:             FindExecutable(name="xacro"),
[0.303s] 2:                                 ^
[0.303s] 2:             " ",
[0.303s] 2:             ^
[0.303s] 2:             " hardware_protocol:=",
[0.303s] 2:             ^
[0.303s] 2:             LaunchConfiguration("hardware_protocol"),
[0.303s] 2:                                 ^
[0.303s] 2:         
[0.303s] 2: ^
[0.303s] 2:         package="controller_manager",
[0.303s] 2:                 ^
[0.303s] 2:         executable="ros2_control_node",
[0.303s] 2:                    ^
[0.303s] 2:         output="both",
[0.303s] 2:                ^
[0.303s] 2:     
[0.303s] 2: ^
[0.303s] 2:         package="robot_state_publisher",
[0.303s] 2:                 ^
[0.303s] 2:         executable="robot_state_publisher",
[0.303s] 2:                    ^
[0.303s] 2:         output="both",
[0.303s] 2:                ^
[0.304s] 2:     
[0.304s] 2: ^
[0.304s] 2:         package="controller_manager",
[0.304s] 2:                 ^
[0.304s] 2:         executable="spawner",
[0.304s] 2:                    ^
[0.304s] 2:         arguments=["joint_state_broadcaster", "--controller-manager", "/controller_manager"],
[0.304s] 2:                    ^
[0.304s] 2:         arguments=["joint_state_broadcaster", "--controller-manager", "/controller_manager"],
[0.304s] 2:                                               ^
[0.304s] 2:         arguments=["joint_state_broadcaster", "--controller-manager", "/controller_manager"],
[0.304s] 2:                                                                       ^
[0.304s] 2:         output="both",
[0.304s] 2:                ^
[0.304s] 2:     
[0.304s] 2: ^
[0.304s] 2:         package="controller_manager",
[0.304s] 2:                 ^
[0.304s] 2:         executable="spawner",
[0.304s] 2:                    ^
[0.304s] 2:         arguments=["rebel_arm_controller", "--controller-manager", "/controller_manager"],
[0.304s] 2:                    ^
[0.304s] 2:         arguments=["rebel_arm_controller", "--controller-manager", "/controller_manager"],
[0.304s] 2:                                            ^
[0.304s] 2:         arguments=["rebel_arm_controller", "--controller-manager", "/controller_manager"],
[0.304s] 2:                                                                    ^
[0.304s] 2:         output="both",
[0.304s] 2:                ^
[0.304s] 2:     
[0.304s] 2: ^
[0.304s] 2:     ^
[0.304s] 2:         ^
[0.304s] 2: 1     E203 whitespace before ':'
[0.305s] 2: 2     F401 'launch.actions.IncludeLaunchDescription' imported but unused
[0.305s] 2: 1     F841 local variable 'env' is assigned to but never used
[0.305s] 2: 4     I100 Import statements are in the wrong order. 'from launch.substitutions import Command, FindExecutable, LaunchConfiguration' should be before 'from launch_ros.actions import Node'
[0.305s] 2: 1     I101 Imported names are in the wrong order. Should be DeclareLaunchArgument, IncludeLaunchDescription
[0.305s] 2: 1     I201 Missing newline between import groups. 'import os' is identified as Stdlib and 'from ament_index_python.packages import get_package_share_directory' is identified as Third Party.
[0.305s] 2: 33    Q000 Double quotes found but single quotes preferred
[0.305s] 2: 1     W292 no newline at end of file
[0.305s] 2: 9     W293 blank line contains whitespace
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:3:1: I100 Import statements are in the wrong order. 'from launch.substitutions import Command, FindExecutable, LaunchConfiguration' should be before 'from launch_ros.actions import Node'
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:4:1: I101 Imported names are in the wrong order. Should be DeclareLaunchArgument, IncludeLaunchDescription
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:4:1: I100 Import statements are in the wrong order. 'from launch.actions import IncludeLaunchDescription, DeclareLaunchArgument' should be before 'from launch.substitutions import Command, FindExecutable, LaunchConfiguration'
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:4:1: F401 'launch.actions.IncludeLaunchDescription' imported but unused
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:5:1: F401 'launch.launch_description_sources.PythonLaunchDescriptionSource' imported but unused
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:6:1: I100 Import statements are in the wrong order. 'from ament_index_python.packages import get_package_share_directory' should be before 'from launch.launch_description_sources import PythonLaunchDescriptionSource'
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:7:1: I100 Import statements are in the wrong order. 'import os' should be before 'from ament_index_python.packages import get_package_share_directory' and in a different group.
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:7:1: I201 Missing newline between import groups. 'import os' is identified as Stdlib and 'from ament_index_python.packages import get_package_share_directory' is identified as Third Party.
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:11:5: F841 local variable 'env' is assigned to but never used
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:17:1: W293 blank line contains whitespace
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:19:9: Q000 Double quotes found but single quotes preferred
[0.305s] 2: 
[0.305s] 2: ./launch/rebel.launch.py:20:23: Q000 Double quotes found but single quotes preferred
[0.305s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:21:18: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:21:35: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:21:45: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:22:21: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:24:1: W293 blank line contains whitespace
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:25:50: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:26:55: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:27:1: W293 blank line contains whitespace
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:28:59: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:28:69: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:36:26: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:36:45: E203 whitespace before ':'
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:38:33: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:39:13: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:41:13: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:42:33: Q000 Double quotes found but single quotes preferred
[0.306s] 2: 
[0.306s] 2: ./launch/rebel.launch.py:45:1: W293 blank line contains whitespace
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:47:17: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:48:20: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:54:16: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:56:1: W293 blank line contains whitespace
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:58:17: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:59:20: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:62:16: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:64:1: W293 blank line contains whitespace
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:66:17: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:67:20: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:68:20: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:68:47: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:68:71: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:69:16: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:71:1: W293 blank line contains whitespace
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:73:17: Q000 Double quotes found but single quotes preferred
[0.307s] 2: 
[0.307s] 2: ./launch/rebel.launch.py:74:20: Q000 Double quotes found but single quotes preferred
[0.308s] 2: 
[0.308s] 2: ./launch/rebel.launch.py:75:20: Q000 Double quotes found but single quotes preferred
[0.308s] 2: 
[0.308s] 2: ./launch/rebel.launch.py:75:44: Q000 Double quotes found but single quotes preferred
[0.308s] 2: 
[0.308s] 2: ./launch/rebel.launch.py:75:68: Q000 Double quotes found but single quotes preferred
[0.308s] 2: 
[0.308s] 2: ./launch/rebel.launch.py:76:16: Q000 Double quotes found but single quotes preferred
[0.308s] 2: 
[0.308s] 2: ./launch/rebel.launch.py:78:1: W293 blank line contains whitespace
[0.308s] 2: 
[0.308s] 2: ./launch/rebel.launch.py:86:1: W293 blank line contains whitespace
[0.308s] 2: 
[0.308s] 2: ./launch/rebel.launch.py:86:5: W292 no newline at end of file
[0.308s] 2: 
[0.308s] 2: 
[0.308s] 2: 1 files checked
[0.308s] 2: 53 errors
[0.308s] 2: 
[0.308s] 2: 'E'-type errors: 1
[0.308s] 2: 'F'-type errors: 3
[0.308s] 2: 'I'-type errors: 6
[0.308s] 2: 'Q'-type errors: 33
[0.308s] 2: 'W'-type errors: 10
[0.308s] 2: 
[0.308s] 2: Checked files:
[0.308s] 2: 
[0.308s] 2: * ./launch/rebel.launch.py
[0.313s] 2: -- run_test.py: return code 1
[0.313s] 2: -- run_test.py: verify result file '/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/flake8.xunit.xml'
[0.320s] 2/6 Test #2: flake8 ...........................***Failed    0.19 sec
[0.320s] test 3
[0.320s]     Start 3: lint_cmake
[0.320s] 
[0.320s] 3: Test command: /usr/bin/python3 "-u" "/opt/ros/jazzy/share/ament_cmake_test/cmake/run_test.py" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/lint_cmake.xunit.xml" "--package-name" "igus_rebel" "--output-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/ament_lint_cmake/lint_cmake.txt" "--command" "/opt/ros/jazzy/bin/ament_lint_cmake" "--xunit-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/lint_cmake.xunit.xml"
[0.320s] 3: Working Directory: /home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel
[0.320s] 3: Test timeout computed to be: 60
[0.354s] 3: -- run_test.py: invoking following command in '/home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel':
[0.354s] 3:  - /opt/ros/jazzy/bin/ament_lint_cmake --xunit-file /home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/lint_cmake.xunit.xml
[0.396s] 3: CMakeLists.txt:6: Line ends in whitespace [whitespace/eol]
[0.396s] 3: 
[0.396s] 3: 
[0.396s] 3: 1 errors
[0.402s] 3: -- run_test.py: return code 1
[0.402s] 3: -- run_test.py: verify result file '/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/lint_cmake.xunit.xml'
[0.409s] 3/6 Test #3: lint_cmake .......................***Failed    0.09 sec
[0.409s] test 4
[0.409s]     Start 4: pep257
[0.409s] 
[0.409s] 4: Test command: /usr/bin/python3 "-u" "/opt/ros/jazzy/share/ament_cmake_test/cmake/run_test.py" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/pep257.xunit.xml" "--package-name" "igus_rebel" "--output-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/ament_pep257/pep257.txt" "--command" "/opt/ros/jazzy/bin/ament_pep257" "--xunit-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/pep257.xunit.xml"
[0.409s] 4: Working Directory: /home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel
[0.410s] 4: Test timeout computed to be: 60
[0.449s] 4: -- run_test.py: invoking following command in '/home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel':
[0.449s] 4:  - /opt/ros/jazzy/bin/ament_pep257 --xunit-file /home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/pep257.xunit.xml
[0.516s] 4: checking ./launch/rebel.launch.py
[0.516s] 4: No problems found
[0.525s] 4: -- run_test.py: return code 0
[0.525s] 4: -- run_test.py: verify result file '/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/pep257.xunit.xml'
[0.532s] 4/6 Test #4: pep257 ...........................   Passed    0.12 sec
[0.532s] test 5
[0.532s]     Start 5: uncrustify
[0.532s] 
[0.532s] 5: Test command: /usr/bin/python3 "-u" "/opt/ros/jazzy/share/ament_cmake_test/cmake/run_test.py" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/uncrustify.xunit.xml" "--package-name" "igus_rebel" "--output-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/ament_uncrustify/uncrustify.txt" "--command" "/opt/ros/jazzy/bin/ament_uncrustify" "--xunit-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/uncrustify.xunit.xml"
[0.532s] 5: Working Directory: /home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel
[0.532s] 5: Test timeout computed to be: 60
[0.572s] 5: -- run_test.py: invoking following command in '/home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel':
[0.572s] 5:  - /opt/ros/jazzy/bin/ament_uncrustify --xunit-file /home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/uncrustify.xunit.xml
[0.724s] 5: Code style divergence in file 'include/igus_rebel/CriKeywords.hpp':
[0.725s] 5: 
[0.725s] 5: --- include/igus_rebel/CriKeywords.hpp
[0.725s] 5: +++ include/igus_rebel/CriKeywords.hpp.uncrustify
[0.725s] 5: @@ -8,4 +8,4 @@
[0.725s] 5: -    namespace CriKeywords
[0.725s] 5: -    {
[0.725s] 5: -        const std::string START = "CRISTART";
[0.725s] 5: -        const std::string END = "CRIEND";
[0.725s] 5: +namespace CriKeywords
[0.725s] 5: +{
[0.725s] 5: +const std::string START = "CRISTART";
[0.725s] 5: +const std::string END = "CRIEND";
[0.725s] 5: @@ -13,14 +13,14 @@
[0.725s] 5: -        const std::string TYPE_STATUS = "STATUS";
[0.725s] 5: -        const std::string TYPE_OPINFO = "OPINFO";
[0.726s] 5: -        const std::string TYPE_GSIG = "GSIG";
[0.726s] 5: -        const std::string TYPE_GRIPPERSTATE = "GRIPPERSTATE";
[0.726s] 5: -        const std::string TYPE_RUNSTATE = "RUNSTATE";
[0.726s] 5: -        const std::string TYPE_MESSAGE = "MESSAGE";
[0.726s] 5: -        const std::string TYPE_CMD = "CMD";
[0.726s] 5: -        const std::string TYPE_CONFIG = "CONFIG";
[0.726s] 5: -        const std::string TYPE_INFO = "INFO";
[0.726s] 5: -        const std::string TYPE_LOGMSG = "LOGMSG";
[0.726s] 5: -        const std::string TYPE_VARIABLES = "VARIABLES";
[0.726s] 5: -        const std::string TYPE_CMDERROR = "CMDERROR";
[0.726s] 5: -        const std::string TYPE_CMDACK = "CMDACK";
[0.726s] 5: -        const std::string TYPE_CYCLESTAT = "CYCLESTAT";
[0.726s] 5: +const std::string TYPE_STATUS = "STATUS";
[0.727s] 5: +const std::string TYPE_OPINFO = "OPINFO";
[0.727s] 5: +const std::string TYPE_GSIG = "GSIG";
[0.727s] 5: +const std::string TYPE_GRIPPERSTATE = "GRIPPERSTATE";
[0.727s] 5: +const std::string TYPE_RUNSTATE = "RUNSTATE";
[0.727s] 5: +const std::string TYPE_MESSAGE = "MESSAGE";
[0.727s] 5: +const std::string TYPE_CMD = "CMD";
[0.727s] 5: +const std::string TYPE_CONFIG = "CONFIG";
[0.727s] 5: +const std::string TYPE_INFO = "INFO";
[0.727s] 5: +const std::string TYPE_LOGMSG = "LOGMSG";
[0.727s] 5: +const std::string TYPE_VARIABLES = "VARIABLES";
[0.727s] 5: +const std::string TYPE_CMDERROR = "CMDERROR";
[0.727s] 5: +const std::string TYPE_CMDACK = "CMDACK";
[0.727s] 5: +const std::string TYPE_CYCLESTAT = "CYCLESTAT";
[0.727s] 5: @@ -28,15 +28,15 @@
[0.727s] 5: -        const std::string STATUS_MODE = "MODE";
[0.727s] 5: -        const std::string STATUS_POSJOINTSETPOINT = "POSJOINTSETPOINT";
[0.727s] 5: -        const std::string STATUS_POSJOINTCURRENT = "POSJOINTCURRENT";
[0.727s] 5: -        const std::string STATUS_POSCARTROBOT = "POSCARTROBOT";
[0.728s] 5: -        const std::string STATUS_POSCARTPLATTFORM = "POSCARTPLATTFORM";
[0.728s] 5: -        const std::string STATUS_OVERRIDE = "OVERRIDE";
[0.728s] 5: -        const std::string STATUS_DIN = "DIN";
[0.728s] 5: -        const std::string STATUS_DOUT = "DOUT";
[0.728s] 5: -        const std::string STATUS_ESTOP = "ESTOP";
[0.728s] 5: -        const std::string STATUS_SUPPLY = "SUPPLY";
[0.728s] 5: -        const std::string STATUS_CURRENTALL = "CURRENTALL";
[0.728s] 5: -        const std::string STATUS_CURRENTJOINTS = "CURRENTJOINTS";
[0.728s] 5: -        const std::string STATUS_ERROR = "ERROR";
[0.728s] 5: -        const std::string STATUS_KINSTATE = "KINSTATE";
[0.728s] 5: -        const std::string STATUS_FRAMEROBOT = "FRAMEROBOT";
[0.728s] 5: +const std::string STATUS_MODE = "MODE";
[0.728s] 5: +const std::string STATUS_POSJOINTSETPOINT = "POSJOINTSETPOINT";
[0.728s] 5: +const std::string STATUS_POSJOINTCURRENT = "POSJOINTCURRENT";
[0.728s] 5: +const std::string STATUS_POSCARTROBOT = "POSCARTROBOT";
[0.728s] 5: +const std::string STATUS_POSCARTPLATTFORM = "POSCARTPLATTFORM";
[0.728s] 5: +const std::string STATUS_OVERRIDE = "OVERRIDE";
[0.728s] 5: +const std::string STATUS_DIN = "DIN";
[0.728s] 5: +const std::string STATUS_DOUT = "DOUT";
[0.728s] 5: +const std::string STATUS_ESTOP = "ESTOP";
[0.728s] 5: +const std::string STATUS_SUPPLY = "SUPPLY";
[0.728s] 5: +const std::string STATUS_CURRENTALL = "CURRENTALL";
[0.728s] 5: +const std::string STATUS_CURRENTJOINTS = "CURRENTJOINTS";
[0.728s] 5: +const std::string STATUS_ERROR = "ERROR";
[0.728s] 5: +const std::string STATUS_KINSTATE = "KINSTATE";
[0.728s] 5: +const std::string STATUS_FRAMEROBOT = "FRAMEROBOT";
[0.728s] 5: @@ -44,10 +44,10 @@
[0.728s] 5: -        const std::string COMMAND_CONNECT = "Connect";
[0.728s] 5: -        const std::string COMMAND_RESET = "Reset";
[0.728s] 5: -        const std::string COMMAND_ENABLE = "Enable";
[0.728s] 5: -        const std::string COMMAND_DISABLE = "Disable";
[0.728s] 5: -        const std::string COMMAND_DISCONNECT = "Disconnect";
[0.729s] 5: -        const std::string COMMAND_MOTIONTYPEJOINT = "MotionTypeJoint";
[0.729s] 5: -        const std::string COMMAND_MOTIONTYPECARTBASE = "MotionTypeCartBase";
[0.729s] 5: -        const std::string COMMAND_QUIT = "QUIT";
[0.729s] 5: -        const std::string COMMAND_SETACTIVE = "SetActive";
[0.729s] 5: -        const std::string COMMAND_DOUT = "DOUT";
[0.729s] 5: +const std::string COMMAND_CONNECT = "Connect";
[0.729s] 5: +const std::string COMMAND_RESET = "Reset";
[0.729s] 5: +const std::string COMMAND_ENABLE = "Enable";
[0.729s] 5: +const std::string COMMAND_DISABLE = "Disable";
[0.729s] 5: +const std::string COMMAND_DISCONNECT = "Disconnect";
[0.729s] 5: +const std::string COMMAND_MOTIONTYPEJOINT = "MotionTypeJoint";
[0.729s] 5: +const std::string COMMAND_MOTIONTYPECARTBASE = "MotionTypeCartBase";
[0.729s] 5: +const std::string COMMAND_QUIT = "QUIT";
[0.729s] 5: +const std::string COMMAND_SETACTIVE = "SetActive";
[0.729s] 5: +const std::string COMMAND_DOUT = "DOUT";
[0.729s] 5: @@ -55,2 +55,2 @@
[0.729s] 5: -        const std::string CONFIG_GETKINEMATICLIMITS = "GetKinematicLimits";
[0.729s] 5: -        const std::string CONFIG_GETKINEMATICLIMITS_ANSWER = "KinematicLimits";
[0.729s] 5: +const std::string CONFIG_GETKINEMATICLIMITS = "GetKinematicLimits";
[0.729s] 5: +const std::string CONFIG_GETKINEMATICLIMITS_ANSWER = "KinematicLimits";
[0.729s] 5: @@ -58,5 +58,5 @@
[0.729s] 5: -        const std::string MODE_JOINT = "joint";
[0.729s] 5: -        const std::string MODE_CARTBASE = "cartbase";
[0.729s] 5: -        const std::string MODE_CARTTOOL = "carttool";
[0.729s] 5: -        const std::string MODE_PLATFORM = "platform";
[0.729s] 5: -        const std::string MODE_FSM = "fsm";
[0.729s] 5: +const std::string MODE_JOINT = "joint";
[0.729s] 5: +const std::string MODE_CARTBASE = "cartbase";
[0.729s] 5: +const std::string MODE_CARTTOOL = "carttool";
[0.729s] 5: +const std::string MODE_PLATFORM = "platform";
[0.729s] 5: +const std::string MODE_FSM = "fsm";
[0.729s] 5: @@ -64,7 +64,7 @@
[0.730s] 5: -        const std::string LOG_LEVEL_DEBUG = "DEBUG";
[0.730s] 5: -        const std::string LOG_LEVEL_APP_INFO = "APP_INFO";
[0.730s] 5: -        const std::string LOG_LEVEL_APP_ERROR = "APP_ERROR";
[0.730s] 5: -        const std::string LOG_LEVEL_INFO = "INFO";
[0.730s] 5: -        const std::string LOG_LEVEL_WARN = "WARN";
[0.730s] 5: -        const std::string LOG_LEVEL_ERROR = "ERROR";
[0.730s] 5: -        const std::string LOG_LEVEL_FATAL = "FATAL";
[0.730s] 5: +const std::string LOG_LEVEL_DEBUG = "DEBUG";
[0.730s] 5: +const std::string LOG_LEVEL_APP_INFO = "APP_INFO";
[0.730s] 5: +const std::string LOG_LEVEL_APP_ERROR = "APP_ERROR";
[0.730s] 5: +const std::string LOG_LEVEL_INFO = "INFO";
[0.730s] 5: +const std::string LOG_LEVEL_WARN = "WARN";
[0.730s] 5: +const std::string LOG_LEVEL_ERROR = "ERROR";
[0.730s] 5: +const std::string LOG_LEVEL_FATAL = "FATAL";
[0.730s] 5: @@ -72,3 +72,3 @@
[0.730s] 5: -        const std::string VARIABLES_NR_VARIABLE = "ValueNrVariable";
[0.730s] 5: -        const std::string VARIABLES_POS_VARIABLE = "ValuePosVariable";
[0.730s] 5: -    }
[0.730s] 5: +const std::string VARIABLES_NR_VARIABLE = "ValueNrVariable";
[0.730s] 5: +const std::string VARIABLES_POS_VARIABLE = "ValuePosVariable";
[0.730s] 5: +}
[0.730s] 5: 
[0.730s] 5: Code style divergence in file 'include/igus_rebel/CriMessages.hpp':
[0.730s] 5: 
[0.731s] 5: --- include/igus_rebel/CriMessages.hpp
[0.731s] 5: +++ include/igus_rebel/CriMessages.hpp.uncrustify
[0.731s] 5: @@ -21,238 +21,241 @@
[0.731s] 5: -    namespace CriMessages
[0.731s] 5: -    {
[0.731s] 5: -        enum class MessageType
[0.731s] 5: -        {
[0.731s] 5: -            STATUS,
[0.731s] 5: -            OPINFO,
[0.731s] 5: -            GSIG,
[0.731s] 5: -            GRIPPERSTATE,
[0.731s] 5: -            RUNSTATE,
[0.731s] 5: -            MESSAGE,
[0.731s] 5: -            CMD,
[0.731s] 5: -            CONFIG,
[0.731s] 5: -            INFO,
[0.731s] 5: -            LOGMSG,
[0.731s] 5: -            VARIABLES,
[0.731s] 5: -            CMDERROR,
[0.731s] 5: -            CMDACK,
[0.731s] 5: -            CYCLESTAT,
[0.731s] 5: -            UNKNOWN = 1000
[0.731s] 5: -        };
[0.731s] 5: -
[0.731s] 5: -        enum class Mode
[0.732s] 5: -        {
[0.732s] 5: -            JOINT,
[0.732s] 5: -            CARTBASE,
[0.732s] 5: -            CARTTOOL,
[0.732s] 5: -            PLATFORM,
[0.732s] 5: -            FSM,
[0.732s] 5: -            UNKNOWN = 1000
[0.732s] 5: -        };
[0.732s] 5: -
[0.732s] 5: -        enum class Kinstate
[0.732s] 5: -        {
[0.732s] 5: -            NO_ERROR = 0,
[0.732s] 5: -            JOINT_LIMIT_MIN = 13,
[0.732s] 5: -            JOINT_LIMIT_MAX = 14,
[0.732s] 5: -            CARTESIAN_SINGULARITY_CENTER = 21,
[0.732s] 5: -            CARTESIAN_SINGULARITY_REACH = 23,
[0.732s] 5: -            CARTESIAN_SINGULARITY_WRIST = 24,
[0.732s] 5: -            TOOL_AT_VIRTUAL_BOX_LIMIT_1 = 30,
[0.732s] 5: -            TOOL_AT_VIRTUAL_BOX_LIMIT_2 = 31,
[0.732s] 5: -            TOOL_AT_VIRTUAL_BOX_LIMIT_3 = 32,
[0.732s] 5: -            TOOL_AT_VIRTUAL_BOX_LIMIT_4 = 33,
[0.732s] 5: -            TOOL_AT_VIRTUAL_BOX_LIMIT_5 = 34,
[0.732s] 5: -            TOOL_AT_VIRTUAL_BOX_LIMIT_6 = 35,
[0.732s] 5: -            MOTION_NOT_ALLOWED = 99,
[0.732s] 5: -            UNKNOWN = 1000
[0.732s] 5: -        };
[0.732s] 5: -
[0.732s] 5: -        enum class ErrorJoint
[0.732s] 5: -        {
[0.733s] 5: -            TEMP = 1,       // OverTemperature
[0.733s] 5: -            ESTOP_LOWV = 2, // Energy supply too low
[0.733s] 5: -            MNE = 4,        // Motor not enabled
[0.733s] 5: -            COM = 8,        // Communication watch dog
[0.733s] 5: -            POS = 16,       // Position lag
[0.733s] 5: -            ENC = 32,       // Encoder Error
[0.733s] 5: -            OC = 64,        // Overcurrent
[0.733s] 5: -            DRV = 128       // Driver Error
[0.733s] 5: -        };
[0.733s] 5: -
[0.733s] 5: -        enum class ConfigType
[0.733s] 5: -        {
[0.733s] 5: -            KINEMATICLIMITS,
[0.733s] 5: -            UNKNOWN = 1000
[0.733s] 5: -        };
[0.733s] 5: -
[0.733s] 5: -        enum class LogLevel
[0.733s] 5: -        {
[0.733s] 5: -            DEBUG,
[0.733s] 5: -            APP_INFO,
[0.733s] 5: -            APP_ERROR,
[0.733s] 5: -            INFO,
[0.733s] 5: -            WARN,
[0.733s] 5: -            ERROR,
[0.733s] 5: -            FATAL,
[0.733s] 5: -            UNKNOWN = 1000
[0.733s] 5: -        };
[0.733s] 5: -
[0.733s] 5: -        class CriMessage
[0.733s] 5: -        {
[0.733s] 5: -        public:
[0.733s] 5: -            MessageType GetType()
[0.733s] 5: -            {
[0.733s] 5: -                return type;
[0.734s] 5: -            }
[0.734s] 5: -
[0.734s] 5: -            static MessageType GetMessageType(const std::string &);
[0.734s] 5: -
[0.734s] 5: -        protected:
[0.734s] 5: -            MessageType type;
[0.734s] 5: -            explicit CriMessage(const MessageType &_type) : type(_type) {}
[0.734s] 5: -
[0.734s] 5: -            static std::string ParseMessageString(const std::string &, const std::string::size_type &,
[0.734s] 5: -                                                  const std::string::size_type &, const std::string::size_type &);
[0.734s] 5: -
[0.734s] 5: -            template <class T, std::size_t N>
[0.734s] 5: -            static void FillArray(std::array<T, N> &, const std::string &);
[0.734s] 5: -
[0.734s] 5: -            template <class T>
[0.734s] 5: -            void FillVector(std::vector<T> &, const std::string &);
[0.734s] 5: -
[0.734s] 5: -            template <class T, std::size_t N>
[0.734s] 5: -            static std::string ArrayToString(std::array<T, N> &);
[0.734s] 5: -
[0.734s] 5: -            template <class T>
[0.734s] 5: -            std::string VectorToString(std::vector<T> &vector);
[0.734s] 5: -        };
[0.734s] 5: -
[0.734s] 5: -        class Status : public CriMessage
[0.734s] 5: -        {
[0.734s] 5: -        public:
[0.734s] 5: -            Mode mode;
[0.734s] 5: -            std::array<float, 16> posJointSetPoint;
[0.735s] 5: -            std::array<float, 16> posJointCurrent;
[0.735s] 5: -            std::array<float, 6> posCartRobot;
[0.735s] 5: -            std::array<float, 3> posCartPlattform;
[0.735s] 5: -            float overrideValue;
[0.735s] 5: -            int din;
[0.735s] 5: -            int dout;
[0.735s] 5: -            int eStop;
[0.735s] 5: -            int supply;
[0.735s] 5: -            int currentall;
[0.735s] 5: -            std::array<int, 16> currentjoints;
[0.735s] 5: -            std::string errorSummary;
[0.735s] 5: -            std::array<int, 16> errorJoints;
[0.735s] 5: -            Kinstate kinstate;
[0.735s] 5: -
[0.735s] 5: -            explicit Status(const std::string &);
[0.735s] 5: -            explicit Status();
[0.735s] 5: -            static std::string ModeToString(const Mode &);
[0.736s] 5: -            void Print();
[0.736s] 5: -            void Log();
[0.736s] 5: -
[0.736s] 5: -        private:
[0.736s] 5: -            std::string ToString();
[0.736s] 5: -            Mode GetMode(const std::string &);
[0.736s] 5: -            Kinstate GetKinstate(const std::string &);
[0.736s] 5: -        };
[0.736s] 5: -
[0.736s] 5: -        class Message : public CriMessage
[0.736s] 5: -        {
[0.736s] 5: -        public:
[0.736s] 5: -            explicit Message(const std::string &);
[0.736s] 5: -
[0.736s] 5: -            std::string message;
[0.736s] 5: -        };
[0.736s] 5: -
[0.736s] 5: -        class Command : public CriMessage
[0.736s] 5: -        {
[0.736s] 5: -        public:
[0.736s] 5: -            explicit Command(const std::string &);
[0.736s] 5: -
[0.736s] 5: -            std::string command;
[0.736s] 5: -        };
[0.736s] 5: -
[0.736s] 5: -        class Info : public CriMessage
[0.736s] 5: -        {
[0.737s] 5: -        public:
[0.737s] 5: -            explicit Info(const std::string &);
[0.737s] 5: -
[0.737s] 5: -            std::string info;
[0.737s] 5: -        };
[0.737s] 5: -
[0.737s] 5: -        class LogMsg : public CriMessage
[0.737s] 5: -        {
[0.737s] 5: -        public:
[0.737s] 5: -            explicit LogMsg(const std::string &);
[0.737s] 5: -
[0.737s] 5: -            LogLevel logLevel;
[0.737s] 5: -            long timestamp;
[0.737s] 5: -            std::string logMsg;
[0.737s] 5: -
[0.737s] 5: -        private:
[0.737s] 5: -            LogLevel GetLogLevel(const std::string &);
[0.737s] 5: -        };
[0.737s] 5: -
[0.737s] 5: -        class Variables : public CriMessage
[0.737s] 5: -        {
[0.737s] 5: -        public:
[0.737s] 5: -            explicit Variables(const std::string &);
[0.737s] 5: -
[0.737s] 5: -            struct NumberVariable
[0.737s] 5: -            {
[0.737s] 5: -                std::string name;
[0.737s] 5: -                double value;
[0.737s] 5: -            };
[0.737s] 5: -
[0.737s] 5: -            struct PositionVariable
[0.738s] 5: -            {
[0.738s] 5: -                std::string name;
[0.738s] 5: -                std::array<double, 15> values;
[0.738s] 5: -            };
[0.738s] 5: -
[0.738s] 5: -            std::vector<NumberVariable> numberVariables;
[0.738s] 5: -            std::vector<PositionVariable> positionVariables;
[0.738s] 5: -
[0.738s] 5: -        private:
[0.738s] 5: -            std::string GetMatchString(const std::smatch &);
[0.738s] 5: -        };
[0.738s] 5: -
[0.738s] 5: -        class CmdError : public CriMessage
[0.738s] 5: -        {
[0.738s] 5: -        public:
[0.738s] 5: -            explicit CmdError(const std::string &);
[0.738s] 5: -            int recjectedCmd;
[0.738s] 5: -            std::string error;
[0.738s] 5: -        };
[0.738s] 5: -
[0.738s] 5: -        class CmdAck : public CriMessage
[0.738s] 5: -        {
[0.738s] 5: -        public:
[0.738s] 5: -            explicit CmdAck(const std::string &);
[0.738s] 5: -            int acceptedCmd;
[0.739s] 5: -        };
[0.739s] 5: -
[0.739s] 5: -        class Cyclestat : public CriMessage
[0.739s] 5: -        {
[0.739s] 5: -        public:
[0.739s] 5: -            explicit Cyclestat(const std::string &);
[0.739s] 5: -            int cycletime;
[0.739s] 5: -            int workload;
[0.739s] 5: -        };
[0.739s] 5: -
[0.739s] 5: -        class Config : public CriMessage
[0.739s] 5: -        {
[0.739s] 5: -        public:
[0.739s] 5: -            ConfigType configType;
[0.739s] 5: -            static ConfigType GetConfigType(const std::string &);
[0.739s] 5: -
[0.739s] 5: -        protected:
[0.739s] 5: -            explicit Config(const ConfigType &_configType) : CriMessage(MessageType::CONFIG), configType(_configType) {}
[0.739s] 5: -        };
[0.739s] 5: -
[0.739s] 5: -        class KinematicLimits : public Config
[0.739s] 5: -        {
[0.739s] 5: -        public:
[0.739s] 5: -            explicit KinematicLimits(const std::string &);
[0.739s] 5: +namespace CriMessages
[0.739s] 5: +{
[0.739s] 5: +enum class MessageType
[0.740s] 5: +{
[0.740s] 5: +  STATUS,
[0.740s] 5: +  OPINFO,
[0.740s] 5: +  GSIG,
[0.740s] 5: +  GRIPPERSTATE,
[0.740s] 5: +  RUNSTATE,
[0.740s] 5: +  MESSAGE,
[0.740s] 5: +  CMD,
[0.740s] 5: +  CONFIG,
[0.740s] 5: +  INFO,
[0.740s] 5: +  LOGMSG,
[0.740s] 5: +  VARIABLES,
[0.740s] 5: +  CMDERROR,
[0.740s] 5: +  CMDACK,
[0.740s] 5: +  CYCLESTAT,
[0.740s] 5: +  UNKNOWN = 1000
[0.740s] 5: +};
[0.740s] 5: +
[0.740s] 5: +enum class Mode
[0.740s] 5: +{
[0.740s] 5: +  JOINT,
[0.740s] 5: +  CARTBASE,
[0.740s] 5: +  CARTTOOL,
[0.740s] 5: +  PLATFORM,
[0.740s] 5: +  FSM,
[0.740s] 5: +  UNKNOWN = 1000
[0.740s] 5: +};
[0.740s] 5: +
[0.740s] 5: +enum class Kinstate
[0.740s] 5: +{
[0.740s] 5: +  NO_ERROR = 0,
[0.740s] 5: +  JOINT_LIMIT_MIN = 13,
[0.741s] 5: +  JOINT_LIMIT_MAX = 14,
[0.741s] 5: +  CARTESIAN_SINGULARITY_CENTER = 21,
[0.742s] 5: +  CARTESIAN_SINGULARITY_REACH = 23,
[0.742s] 5: +  CARTESIAN_SINGULARITY_WRIST = 24,
[0.742s] 5: +  TOOL_AT_VIRTUAL_BOX_LIMIT_1 = 30,
[0.742s] 5: +  TOOL_AT_VIRTUAL_BOX_LIMIT_2 = 31,
[0.742s] 5: +  TOOL_AT_VIRTUAL_BOX_LIMIT_3 = 32,
[0.742s] 5: +  TOOL_AT_VIRTUAL_BOX_LIMIT_4 = 33,
[0.742s] 5: +  TOOL_AT_VIRTUAL_BOX_LIMIT_5 = 34,
[0.742s] 5: +  TOOL_AT_VIRTUAL_BOX_LIMIT_6 = 35,
[0.742s] 5: +  MOTION_NOT_ALLOWED = 99,
[0.742s] 5: +  UNKNOWN = 1000
[0.742s] 5: +};
[0.742s] 5: +
[0.742s] 5: +enum class ErrorJoint
[0.742s] 5: +{
[0.742s] 5: +  TEMP = 1,                 // OverTemperature
[0.742s] 5: +  ESTOP_LOWV = 2,           // Energy supply too low
[0.742s] 5: +  MNE = 4,                  // Motor not enabled
[0.742s] 5: +  COM = 8,                  // Communication watch dog
[0.742s] 5: +  POS = 16,                 // Position lag
[0.742s] 5: +  ENC = 32,                 // Encoder Error
[0.742s] 5: +  OC = 64,                  // Overcurrent
[0.742s] 5: +  DRV = 128                 // Driver Error
[0.742s] 5: +};
[0.742s] 5: +
[0.742s] 5: +enum class ConfigType
[0.742s] 5: +{
[0.742s] 5: +  KINEMATICLIMITS,
[0.742s] 5: +  UNKNOWN = 1000
[0.743s] 5: +};
[0.743s] 5: +
[0.743s] 5: +enum class LogLevel
[0.743s] 5: +{
[0.743s] 5: +  DEBUG,
[0.743s] 5: +  APP_INFO,
[0.743s] 5: +  APP_ERROR,
[0.743s] 5: +  INFO,
[0.743s] 5: +  WARN,
[0.743s] 5: +  ERROR,
[0.743s] 5: +  FATAL,
[0.752s] 5: +  UNKNOWN = 1000
[0.752s] 5: +};
[0.752s] 5: +
[0.752s] 5: +class CriMessage
[0.752s] 5: +{
[0.752s] 5: +public:
[0.752s] 5: +  MessageType GetType()
[0.752s] 5: +  {
[0.752s] 5: +    return type;
[0.752s] 5: +  }
[0.752s] 5: +
[0.752s] 5: +  static MessageType GetMessageType(const std::string &);
[0.752s] 5: +
[0.752s] 5: +protected:
[0.753s] 5: +  MessageType type;
[0.753s] 5: +  explicit CriMessage(const MessageType & _type)
[0.753s] 5: +  : type(_type) {}
[0.753s] 5: +
[0.753s] 5: +  static std::string ParseMessageString(
[0.753s] 5: +    const std::string &, const std::string::size_type &,
[0.753s] 5: +    const std::string::size_type &, const std::string::size_type &);
[0.753s] 5: +
[0.753s] 5: +  template<class T, std::size_t N>
[0.753s] 5: +  static void FillArray(std::array<T, N> &, const std::string &);
[0.753s] 5: +
[0.753s] 5: +  template<class T>
[0.753s] 5: +  void FillVector(std::vector<T> &, const std::string &);
[0.753s] 5: +
[0.753s] 5: +  template<class T, std::size_t N>
[0.753s] 5: +  static std::string ArrayToString(std::array<T, N> &);
[0.753s] 5: +
[0.753s] 5: +  template<class T>
[0.753s] 5: +  std::string VectorToString(std::vector<T> & vector);
[0.753s] 5: +};
[0.753s] 5: +
[0.753s] 5: +class Status : public CriMessage
[0.753s] 5: +{
[0.753s] 5: +public:
[0.753s] 5: +  Mode mode;
[0.753s] 5: +  std::array<float, 16> posJointSetPoint;
[0.754s] 5: +  std::array<float, 16> posJointCurrent;
[0.754s] 5: +  std::array<float, 6> posCartRobot;
[0.754s] 5: +  std::array<float, 3> posCartPlattform;
[0.754s] 5: +  float overrideValue;
[0.754s] 5: +  int din;
[0.754s] 5: +  int dout;
[0.754s] 5: +  int eStop;
[0.754s] 5: +  int supply;
[0.754s] 5: +  int currentall;
[0.754s] 5: +  std::array<int, 16> currentjoints;
[0.754s] 5: +  std::string errorSummary;
[0.754s] 5: +  std::array<int, 16> errorJoints;
[0.754s] 5: +  Kinstate kinstate;
[0.754s] 5: +
[0.754s] 5: +  explicit Status(const std::string &);
[0.754s] 5: +  explicit Status();
[0.754s] 5: +  static std::string ModeToString(const Mode &);
[0.754s] 5: +  void Print();
[0.754s] 5: +  void Log();
[0.754s] 5: +
[0.754s] 5: +private:
[0.754s] 5: +  std::string ToString();
[0.754s] 5: +  Mode GetMode(const std::string &);
[0.754s] 5: +  Kinstate GetKinstate(const std::string &);
[0.754s] 5: +};
[0.754s] 5: +
[0.754s] 5: +class Message : public CriMessage
[0.754s] 5: +{
[0.754s] 5: +public:
[0.754s] 5: +  explicit Message(const std::string &);
[0.754s] 5: +
[0.754s] 5: +  std::string message;
[0.754s] 5: +};
[0.754s] 5: +
[0.755s] 5: +class Command : public CriMessage
[0.755s] 5: +{
[0.755s] 5: +public:
[0.755s] 5: +  explicit Command(const std::string &);
[0.755s] 5: +
[0.755s] 5: +  std::string command;
[0.755s] 5: +};
[0.755s] 5: +
[0.755s] 5: +class Info : public CriMessage
[0.755s] 5: +{
[0.755s] 5: +public:
[0.755s] 5: +  explicit Info(const std::string &);
[0.755s] 5: +
[0.755s] 5: +  std::string info;
[0.755s] 5: +};
[0.755s] 5: +
[0.755s] 5: +class LogMsg : public CriMessage
[0.755s] 5: +{
[0.755s] 5: +public:
[0.755s] 5: +  explicit LogMsg(const std::string &);
[0.755s] 5: +
[0.755s] 5: +  LogLevel logLevel;
[0.755s] 5: +  long timestamp;
[0.755s] 5: +  std::string logMsg;
[0.755s] 5: +
[0.755s] 5: +private:
[0.755s] 5: +  LogLevel GetLogLevel(const std::string &);
[0.755s] 5: +};
[0.755s] 5: +
[0.755s] 5: +class Variables : public CriMessage
[0.755s] 5: +{
[0.755s] 5: +public:
[0.755s] 5: +  explicit Variables(const std::string &);
[0.756s] 5: +
[0.756s] 5: +  struct NumberVariable
[0.756s] 5: +  {
[0.756s] 5: +    std::string name;
[0.756s] 5: +    double value;
[0.756s] 5: +  };
[0.756s] 5: +
[0.756s] 5: +  struct PositionVariable
[0.756s] 5: +  {
[0.756s] 5: +    std::string name;
[0.756s] 5: +    std::array<double, 15> values;
[0.756s] 5: +  };
[0.756s] 5: +
[0.756s] 5: +  std::vector<NumberVariable> numberVariables;
[0.756s] 5: +  std::vector<PositionVariable> positionVariables;
[0.756s] 5: +
[0.756s] 5: +private:
[0.756s] 5: +  std::string GetMatchString(const std::smatch &);
[0.756s] 5: +};
[0.756s] 5: +
[0.756s] 5: +class CmdError : public CriMessage
[0.756s] 5: +{
[0.756s] 5: +public:
[0.756s] 5: +  explicit CmdError(const std::string &);
[0.756s] 5: +  int recjectedCmd;
[0.756s] 5: +  std::string error;
[0.756s] 5: +};
[0.756s] 5: +
[0.756s] 5: +class CmdAck : public CriMessage
[0.756s] 5: +{
[0.756s] 5: +public:
[0.756s] 5: +  explicit CmdAck(const std::string &);
[0.756s] 5: +  int acceptedCmd;
[0.756s] 5: +};
[0.757s] 5: +
[0.757s] 5: +class Cyclestat : public CriMessage
[0.757s] 5: +{
[0.757s] 5: +public:
[0.757s] 5: +  explicit Cyclestat(const std::string &);
[0.757s] 5: +  int cycletime;
[0.757s] 5: +  int workload;
[0.758s] 5: +};
[0.758s] 5: +
[0.758s] 5: +class Config : public CriMessage
[0.758s] 5: +{
[0.758s] 5: +public:
[0.758s] 5: +  ConfigType configType;
[0.758s] 5: +  static ConfigType GetConfigType(const std::string &);
[0.758s] 5: +
[0.758s] 5: +protected:
[0.758s] 5: +  explicit Config(const ConfigType & _configType)
[0.758s] 5: +  : CriMessage(MessageType::CONFIG), configType(_configType) {}
[0.758s] 5: +};
[0.758s] 5: +
[0.758s] 5: +class KinematicLimits : public Config
[0.758s] 5: +{
[0.758s] 5: +public:
[0.758s] 5: +  explicit KinematicLimits(const std::string &);
[0.758s] 5: @@ -263,6 +266,5 @@
[0.758s] 5: -            std::vector<std::pair<float, float>> minMaxPairs;
[0.758s] 5: -
[0.758s] 5: -            std::string ToString();
[0.758s] 5: -            void Print();
[0.758s] 5: -        };
[0.758s] 5: -    }
[0.758s] 5: +  std::vector<std::pair<float, float>> minMaxPairs;
[0.758s] 5: +
[0.758s] 5: +  std::string ToString();
[0.758s] 5: +  void Print();
[0.759s] 5: +};
[0.759s] 5: @@ -269,0 +272 @@
[0.759s] 5: +}
[0.759s] 5: 
[0.759s] 5: Code style divergence in file 'include/igus_rebel/Rebel.hpp':
[0.759s] 5: 
[0.759s] 5: --- include/igus_rebel/Rebel.hpp
[0.759s] 5: +++ include/igus_rebel/Rebel.hpp.uncrustify
[0.759s] 5: @@ -20,8 +20,8 @@
[0.759s] 5: -    class Rebel : public SystemInterface
[0.759s] 5: -    {
[0.759s] 5: -    public:
[0.759s] 5: -        enum class ControlMode
[0.759s] 5: -        {
[0.759s] 5: -            POSITION,
[0.759s] 5: -            VELOCITY
[0.759s] 5: -        };
[0.759s] 5: +class Rebel : public SystemInterface
[0.759s] 5: +{
[0.759s] 5: +public:
[0.759s] 5: +  enum class ControlMode
[0.759s] 5: +  {
[0.759s] 5: +    POSITION,
[0.760s] 5: +    VELOCITY
[0.760s] 5: +  };
[0.760s] 5: @@ -29,5 +29,5 @@
[0.760s] 5: -    private:
[0.760s] 5: -        rclcpp::Node::SharedPtr node_;
[0.760s] 5: -        
[0.760s] 5: -        std::shared_ptr<RebelSocket> rebelSocket;
[0.760s] 5: -        CriMessages::Status currentStatus;
[0.760s] 5: +private:
[0.760s] 5: +  rclcpp::Node::SharedPtr node_;
[0.760s] 5: +
[0.760s] 5: +  std::shared_ptr<RebelSocket> rebelSocket;
[0.760s] 5: +  CriMessages::Status currentStatus;
[0.760s] 5: @@ -36,2 +36,2 @@
[0.760s] 5: -        float j1, j2, j3, j4, j5, j6;
[0.760s] 5: -        ControlMode controlMode;
[0.760s] 5: +  float j1, j2, j3, j4, j5, j6;
[0.760s] 5: +  ControlMode controlMode;
[0.760s] 5: @@ -39,5 +39,5 @@
[0.760s] 5: -        bool continueAlive;
[0.760s] 5: -        bool continueMessage;
[0.760s] 5: -        std::thread aliveThread;
[0.760s] 5: -        std::thread messageThread;
[0.760s] 5: -        int aliveWaitMs;
[0.760s] 5: +  bool continueAlive;
[0.760s] 5: +  bool continueMessage;
[0.760s] 5: +  std::thread aliveThread;
[0.760s] 5: +  std::thread messageThread;
[0.760s] 5: +  int aliveWaitMs;
[0.760s] 5: @@ -45,3 +45,3 @@
[0.760s] 5: -        int current_ccnt;
[0.760s] 5: -        std::mutex cntLock;
[0.761s] 5: -        std::mutex aliveLock;
[0.761s] 5: +  int current_ccnt;
[0.761s] 5: +  std::mutex cntLock;
[0.761s] 5: +  std::mutex aliveLock;
[0.761s] 5: @@ -49,5 +49,5 @@
[0.761s] 5: -        double vel_cmd[6] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
[0.761s] 5: -        double pos[6] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
[0.761s] 5: -        double last_pos[6] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
[0.761s] 5: -        double vel[6] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
[0.761s] 5: -        double eff[6] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
[0.761s] 5: +  double vel_cmd[6] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
[0.761s] 5: +  double pos[6] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
[0.761s] 5: +  double last_pos[6] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
[0.761s] 5: +  double vel[6] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
[0.761s] 5: +  double eff[6] = {0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
[0.761s] 5: @@ -55,3 +55,3 @@
[0.761s] 5: -        CriMessages::Kinstate lastKinstate;
[0.761s] 5: -        std::array<int, 16> lastErrorJoints;
[0.761s] 5: -        std::string kinstateMessage;
[0.761s] 5: +  CriMessages::Kinstate lastKinstate;
[0.761s] 5: +  std::array<int, 16> lastErrorJoints;
[0.761s] 5: +  std::string kinstateMessage;
[0.761s] 5: @@ -59 +59 @@
[0.761s] 5: -        std::unordered_map<int, std::string> unacknowledgedCommands;
[0.761s] 5: +  std::unordered_map<int, std::string> unacknowledgedCommands;
[0.761s] 5: @@ -62 +62 @@
[0.761s] 5: -        rclcpp::Service<igus_rebel_msgs::srv::SetDigitalOutput>::SharedPtr digital_output_srv_;
[0.761s] 5: +  rclcpp::Service<igus_rebel_msgs::srv::SetDigitalOutput>::SharedPtr digital_output_srv_;
[0.761s] 5: @@ -65,2 +65,2 @@
[0.761s] 5: -        void AliveThreadFunction();
[0.761s] 5: -        void MessageThreadFunction();
[0.762s] 5: +  void AliveThreadFunction();
[0.762s] 5: +  void MessageThreadFunction();
[0.762s] 5: @@ -69,4 +69,4 @@
[0.762s] 5: -        int Ccnt();
[0.762s] 5: -        void Command(const std::string &);
[0.762s] 5: -        void GetConfig(const std::string &);
[0.762s] 5: -        void SetControlMode(const ControlMode &);
[0.762s] 5: +  int Ccnt();
[0.762s] 5: +  void Command(const std::string &);
[0.762s] 5: +  void GetConfig(const std::string &);
[0.762s] 5: +  void SetControlMode(const ControlMode &);
[0.762s] 5: @@ -75,2 +75,2 @@
[0.762s] 5: -        void ProcessStatus(const CriMessages::Status &);
[0.762s] 5: -        void SetUpRosHardwareInterface();
[0.762s] 5: +  void ProcessStatus(const CriMessages::Status &);
[0.762s] 5: +  void SetUpRosHardwareInterface();
[0.762s] 5: @@ -78,3 +78,3 @@
[0.762s] 5: -    public:
[0.762s] 5: -        const std::vector<std::string> JOINT_NAME = {
[0.762s] 5: -            "joint1", "joint2", "joint3", "joint4", "joint5", "joint6"};
[0.762s] 5: +public:
[0.762s] 5: +  const std::vector<std::string> JOINT_NAME = {
[0.762s] 5: +    "joint1", "joint2", "joint3", "joint4", "joint5", "joint6"};
[0.762s] 5: @@ -83 +83 @@
[0.762s] 5: -        const double degToRad = 0.0174532925199432957692369076848861271344287188854172545609719144;
[0.762s] 5: +  const double degToRad = 0.0174532925199432957692369076848861271344287188854172545609719144;
[0.762s] 5: @@ -86,2 +86,2 @@
[0.762s] 5: -        const std::string ip = "192.168.3.11";
[0.762s] 5: -        const int port = 3920;
[0.762s] 5: +  const std::string ip = "192.168.3.11";
[0.762s] 5: +  const int port = 3920;
[0.762s] 5: @@ -89,2 +89,2 @@
[0.762s] 5: -        Rebel();
[0.762s] 5: -        ~Rebel();
[0.763s] 5: +  Rebel();
[0.763s] 5: +  ~Rebel();
[0.763s] 5: @@ -92,3 +92,5 @@
[0.763s] 5: -        void SetJog(const float &, const float &, const float &, const float &, const float &, const float &);
[0.763s] 5: -        void GetJoints(float &, float &, float &, float &, float &, float &);
[0.763s] 5: -        void SetDigitalOut(const int &, const bool &);
[0.763s] 5: +  void SetJog(
[0.763s] 5: +    const float &, const float &, const float &, const float &, const float &,
[0.763s] 5: +    const float &);
[0.763s] 5: +  void GetJoints(float &, float &, float &, float &, float &, float &);
[0.763s] 5: +  void SetDigitalOut(const int &, const bool &);
[0.763s] 5: @@ -97 +99 @@
[0.763s] 5: -        CallbackReturn on_init(const HardwareInfo &hardware_info) override;
[0.763s] 5: +  CallbackReturn on_init(const HardwareInfo & hardware_info) override;
[0.763s] 5: @@ -99,4 +101,4 @@
[0.763s] 5: -        std::vector<StateInterface> export_state_interfaces() override;
[0.763s] 5: -        std::vector<CommandInterface> export_command_interfaces() override;
[0.763s] 5: -        return_type read(const rclcpp::Time &time, const rclcpp::Duration &period) override;
[0.763s] 5: -        return_type write(const rclcpp::Time &time, const rclcpp::Duration &period) override;
[0.763s] 5: +  std::vector<StateInterface> export_state_interfaces() override;
[0.763s] 5: +  std::vector<CommandInterface> export_command_interfaces() override;
[0.763s] 5: +  return_type read(const rclcpp::Time & time, const rclcpp::Duration & period) override;
[0.763s] 5: +  return_type write(const rclcpp::Time & time, const rclcpp::Duration & period) override;
[0.763s] 5: @@ -104,2 +106,2 @@
[0.763s] 5: -        void read();
[0.763s] 5: -        void write();
[0.763s] 5: +  void read();
[0.763s] 5: +  void write();
[0.763s] 5: @@ -107,2 +109,3 @@
[0.763s] 5: -        void dio_callback(const std::shared_ptr<igus_rebel_msgs::srv::SetDigitalOutput::Request> request,
[0.763s] 5: -                          std::shared_ptr<igus_rebel_msgs::srv::SetDigitalOutput::Response> response);
[0.763s] 5: +  void dio_callback(
[0.763s] 5: +    const std::shared_ptr<igus_rebel_msgs::srv::SetDigitalOutput::Request> request,
[0.763s] 5: +    std::shared_ptr<igus_rebel_msgs::srv::SetDigitalOutput::Response> response);
[0.763s] 5: @@ -110 +113 @@
[0.764s] 5: -        void GetReferenceInfo();
[0.764s] 5: +  void GetReferenceInfo();
[0.764s] 5: @@ -112,3 +115,3 @@
[0.764s] 5: -        void Start();
[0.764s] 5: -        void Stop();
[0.764s] 5: -    };
[0.764s] 5: +  void Start();
[0.764s] 5: +  void Stop();
[0.764s] 5: +};
[0.764s] 5: @@ -117 +120 @@
[0.764s] 5: -#endif
[0.764s] 5: +#endif
[0.764s] 5: 
[0.764s] 5: Code style divergence in file 'include/igus_rebel/RebelSocket.hpp':
[0.764s] 5: 
[0.764s] 5: --- include/igus_rebel/RebelSocket.hpp
[0.764s] 5: +++ include/igus_rebel/RebelSocket.hpp.uncrustify
[0.764s] 5: @@ -14,8 +14,8 @@
[0.764s] 5: -    class RebelSocket
[0.764s] 5: -    {
[0.764s] 5: -    private:
[0.764s] 5: -        int sock;
[0.764s] 5: -        std::string ip;
[0.764s] 5: -        int port;
[0.764s] 5: -        int timeout;
[0.764s] 5: -        std::list<std::string> unprocessedMessages;
[0.764s] 5: +class RebelSocket
[0.764s] 5: +{
[0.764s] 5: +private:
[0.764s] 5: +  int sock;
[0.764s] 5: +  std::string ip;
[0.764s] 5: +  int port;
[0.764s] 5: +  int timeout;
[0.764s] 5: +  std::list<std::string> unprocessedMessages;
[0.764s] 5: @@ -23,8 +23,8 @@
[0.764s] 5: -        bool continueReceive = false;
[0.764s] 5: -        std::thread receiveThread;
[0.765s] 5: -        std::thread listCheckThread;
[0.765s] 5: -        std::mutex socketWriteLock;
[0.765s] 5: -        std::mutex connectionLock;
[0.765s] 5: -        std::mutex messageLock;
[0.765s] 5: -        unsigned long maxUnprocessedMessages = 25;
[0.765s] 5: -        int listCheckWaitMs = 500;
[0.765s] 5: +  bool continueReceive = false;
[0.765s] 5: +  std::thread receiveThread;
[0.765s] 5: +  std::thread listCheckThread;
[0.765s] 5: +  std::mutex socketWriteLock;
[0.765s] 5: +  std::mutex connectionLock;
[0.765s] 5: +  std::mutex messageLock;
[0.765s] 5: +  unsigned long maxUnprocessedMessages = 25;
[0.765s] 5: +  int listCheckWaitMs = 500;
[0.765s] 5: @@ -32,2 +32,2 @@
[0.765s] 5: -        bool connectionNeeded = false;
[0.765s] 5: -        static const int bufferSize = 4096;
[0.765s] 5: +  bool connectionNeeded = false;
[0.765s] 5: +  static const int bufferSize = 4096;
[0.765s] 5: @@ -35,2 +35,2 @@
[0.765s] 5: -        char fragmentBuffer[bufferSize];
[0.765s] 5: -        int fragmentLength = 0;
[0.765s] 5: +  char fragmentBuffer[bufferSize];
[0.765s] 5: +  int fragmentLength = 0;
[0.765s] 5: @@ -38,2 +38,2 @@
[0.765s] 5: -        void MakeConnection();
[0.765s] 5: -        void SeparateMessages(const char *);
[0.765s] 5: +  void MakeConnection();
[0.765s] 5: +  void SeparateMessages(const char *);
[0.765s] 5: @@ -41,2 +41,2 @@
[0.765s] 5: -        void ReceiveThreadFunction();
[0.765s] 5: -        void ListCheckThreadFunction();
[0.765s] 5: +  void ReceiveThreadFunction();
[0.765s] 5: +  void ListCheckThreadFunction();
[0.765s] 5: @@ -44 +44 @@
[0.765s] 5: -        bool IsSocketOk();
[0.766s] 5: +  bool IsSocketOk();
[0.766s] 5: @@ -46,3 +46,3 @@
[0.766s] 5: -    public:
[0.766s] 5: -        RebelSocket(const std::string &, const int &, const int &);
[0.766s] 5: -        ~RebelSocket();
[0.766s] 5: +public:
[0.766s] 5: +  RebelSocket(const std::string &, const int &, const int &);
[0.766s] 5: +  ~RebelSocket();
[0.766s] 5: @@ -50,6 +50,6 @@
[0.766s] 5: -        void Start();
[0.766s] 5: -        void Stop();
[0.766s] 5: -        bool HasMessage();
[0.766s] 5: -        std::string GetMessage();
[0.766s] 5: -        void SendMessage(const std::string &);
[0.766s] 5: -    };
[0.766s] 5: +  void Start();
[0.766s] 5: +  void Stop();
[0.766s] 5: +  bool HasMessage();
[0.766s] 5: +  std::string GetMessage();
[0.766s] 5: +  void SendMessage(const std::string &);
[0.766s] 5: +};
[0.766s] 5: 
[0.766s] 5: Code style divergence in file 'src/CriMessages.cpp':
[0.766s] 5: 
[0.766s] 5: --- src/CriMessages.cpp
[0.766s] 5: +++ src/CriMessages.cpp.uncrustify
[0.766s] 5: @@ -10,5 +10,5 @@
[0.766s] 5: -    namespace CriMessages
[0.766s] 5: -    {
[0.766s] 5: -        MessageType CriMessage::GetMessageType(const std::string &msg)
[0.766s] 5: -        {
[0.766s] 5: -            std::string::size_type typeStart;
[0.766s] 5: +namespace CriMessages
[0.766s] 5: +{
[0.766s] 5: +MessageType CriMessage::GetMessageType(const std::string & msg)
[0.766s] 5: +{
[0.767s] 5: +  std::string::size_type typeStart;
[0.767s] 5: @@ -16,247 +16,224 @@
[0.767s] 5: -            if (msg.at(0) == ' ')
[0.767s] 5: -            {
[0.767s] 5: -                typeStart = msg.find(" ", 1) + 1;
[0.767s] 5: -            }
[0.767s] 5: -            else
[0.767s] 5: -            {
[0.767s] 5: -                typeStart = msg.find(" ") + 1;
[0.767s] 5: -            }
[0.767s] 5: -            std::string::size_type typeEnd = msg.find(" ", typeStart);
[0.767s] 5: -
[0.767s] 5: -            std::string typeString = msg.substr(typeStart, typeEnd - typeStart);
[0.767s] 5: -
[0.767s] 5: -            if (typeString == CriKeywords::TYPE_STATUS)
[0.767s] 5: -            {
[0.767s] 5: -                return MessageType::STATUS;
[0.767s] 5: -            }
[0.767s] 5: -
[0.767s] 5: -            if (typeString == CriKeywords::TYPE_OPINFO)
[0.767s] 5: -            {
[0.767s] 5: -                return MessageType::OPINFO;
[0.767s] 5: -            }
[0.767s] 5: -
[0.767s] 5: -            if (typeString == CriKeywords::TYPE_GSIG)
[0.767s] 5: -            {
[0.767s] 5: -                return MessageType::GSIG;
[0.767s] 5: -            }
[0.767s] 5: -
[0.767s] 5: -            if (typeString == CriKeywords::TYPE_GRIPPERSTATE)
[0.767s] 5: -            {
[0.767s] 5: -                return MessageType::GRIPPERSTATE;
[0.767s] 5: -            }
[0.767s] 5: -
[0.767s] 5: -            if (typeString == CriKeywords::TYPE_RUNSTATE)
[0.767s] 5: -            {
[0.768s] 5: -                return MessageType::RUNSTATE;
[0.768s] 5: -            }
[0.768s] 5: -
[0.768s] 5: -            if (typeString == CriKeywords::TYPE_MESSAGE)
[0.768s] 5: -            {
[0.768s] 5: -                return MessageType::MESSAGE;
[0.768s] 5: -            }
[0.768s] 5: -
[0.768s] 5: -            if (typeString == CriKeywords::TYPE_CMD)
[0.768s] 5: -            {
[0.768s] 5: -                return MessageType::CMD;
[0.768s] 5: -            }
[0.768s] 5: -
[0.768s] 5: -            if (typeString == CriKeywords::TYPE_CONFIG)
[0.768s] 5: -            {
[0.768s] 5: -                return MessageType::CONFIG;
[0.768s] 5: -            }
[0.768s] 5: -
[0.768s] 5: -            if (typeString == CriKeywords::TYPE_INFO)
[0.768s] 5: -            {
[0.768s] 5: -                return MessageType::INFO;
[0.768s] 5: -            }
[0.768s] 5: -
[0.768s] 5: -            if (typeString == CriKeywords::TYPE_LOGMSG)
[0.768s] 5: -            {
[0.768s] 5: -                return MessageType::LOGMSG;
[0.768s] 5: -            }
[0.768s] 5: -
[0.768s] 5: -            if (typeString == CriKeywords::TYPE_VARIABLES)
[0.768s] 5: -            {
[0.768s] 5: -                return MessageType::VARIABLES;
[0.768s] 5: -            }
[0.768s] 5: -
[0.768s] 5: -            if (typeString == CriKeywords::TYPE_CMDERROR)
[0.768s] 5: -            {
[0.768s] 5: -                return MessageType::CMDERROR;
[0.769s] 5: -            }
[0.769s] 5: -
[0.769s] 5: -            if (typeString == CriKeywords::TYPE_CMDACK)
[0.769s] 5: -            {
[0.769s] 5: -                return MessageType::CMDACK;
[0.769s] 5: -            }
[0.769s] 5: -
[0.769s] 5: -            if (typeString == CriKeywords::TYPE_CYCLESTAT)
[0.769s] 5: -            {
[0.769s] 5: -                return MessageType::CYCLESTAT;
[0.769s] 5: -            }
[0.769s] 5: -
[0.769s] 5: -            RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Unknown message type: \"%s\"", typeString.c_str());
[0.769s] 5: -            return MessageType::UNKNOWN;
[0.769s] 5: -        }
[0.769s] 5: -
[0.769s] 5: -        std::string CriMessage::ParseMessageString(const std::string &statusString, const std::string::size_type &begin,
[0.769s] 5: -                                                   const std::string::size_type &end, const std::string::size_type &keywordLength)
[0.769s] 5: -        {
[0.769s] 5: -            int start = begin + keywordLength + 1;
[0.769s] 5: -            int length = end - start - 1;
[0.769s] 5: -
[0.769s] 5: -            return statusString.substr(start, length);
[0.769s] 5: -        }
[0.769s] 5: -
[0.769s] 5: -        template <class T, std::size_t N>
[0.769s] 5: -        void CriMessage::FillArray(std::array<T, N> &array, const std::string &spaceSeparatedValues)
[0.769s] 5: -        {
[0.769s] 5: -            typename std::array<T, N>::size_type idx = 0;
[0.769s] 5: -            std::string::size_type begin = 0;
[0.769s] 5: -            std::string::size_type end = spaceSeparatedValues.find(" ", begin + 1);
[0.769s] 5: -
[0.769s] 5: -            while (end != std::string::npos)
[0.769s] 5: -            {
[0.769s] 5: -                if (idx >= N)
[0.769s] 5: -                {
[0.770s] 5: -                    RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Parsing error");
[0.770s] 5: -                    return;
[0.770s] 5: -                }
[0.770s] 5: -
[0.770s] 5: -                std::string value = spaceSeparatedValues.substr(begin, end - begin);
[0.770s] 5: -
[0.770s] 5: -                if (std::is_same<float, T>::value)
[0.770s] 5: -                {
[0.770s] 5: -                    array.at(idx) = std::stof(value);
[0.770s] 5: -                }
[0.770s] 5: -
[0.770s] 5: -                if (std::is_same<int, T>::value)
[0.770s] 5: -                {
[0.770s] 5: -                    array.at(idx) = std::stoi(value);
[0.770s] 5: -                }
[0.770s] 5: -
[0.770s] 5: -                begin = spaceSeparatedValues.find(" ", end);
[0.770s] 5: -                end = spaceSeparatedValues.find(" ", begin + 1);
[0.770s] 5: -                idx++;
[0.770s] 5: -            }
[0.770s] 5: -
[0.770s] 5: -            std::string value = spaceSeparatedValues.substr(begin);
[0.770s] 5: -
[0.770s] 5: -            if (std::is_same<float, T>::value)
[0.770s] 5: -            {
[0.770s] 5: -                array.at(idx) = std::stof(value);
[0.770s] 5: -            }
[0.770s] 5: -
[0.770s] 5: -            if (std::is_same<int, T>::value)
[0.770s] 5: -            {
[0.770s] 5: -                array.at(idx) = std::stoi(value);
[0.770s] 5: -            }
[0.770s] 5: -        }
[0.770s] 5: -
[0.770s] 5: -        template <class T>
[0.770s] 5: -        void CriMessage::FillVector(std::vector<T> &vector, const std::string &spaceSeparatedValues)
[0.770s] 5: -        {
[0.770s] 5: -            std::string::size_type begin = 0;
[0.771s] 5: -            std::string::size_type end = spaceSeparatedValues.find(" ", begin + 1);
[0.771s] 5: -
[0.771s] 5: -            while (end != std::string::npos)
[0.771s] 5: -            {
[0.771s] 5: -                std::string value = spaceSeparatedValues.substr(begin, end - begin);
[0.771s] 5: -
[0.771s] 5: -                if (std::is_same<float, T>::value)
[0.771s] 5: -                {
[0.771s] 5: -                    vector.push_back(std::stof(value));
[0.771s] 5: -                }
[0.771s] 5: -
[0.771s] 5: -                if (std::is_same<int, T>::value)
[0.771s] 5: -                {
[0.771s] 5: -                    vector.push_back(std::stoi(value));
[0.771s] 5: -                }
[0.771s] 5: -
[0.771s] 5: -                begin = spaceSeparatedValues.find(" ", end);
[0.771s] 5: -                end = spaceSeparatedValues.find(" ", begin + 1);
[0.771s] 5: -            }
[0.771s] 5: -
[0.771s] 5: -            std::string value = spaceSeparatedValues.substr(begin);
[0.771s] 5: -
[0.771s] 5: -            if (std::is_same<float, T>::value)
[0.771s] 5: -            {
[0.771s] 5: -                vector.push_back(std::stof(value));
[0.771s] 5: -            }
[0.771s] 5: -
[0.771s] 5: -            if (std::is_same<int, T>::value)
[0.771s] 5: -            {
[0.771s] 5: -                vector.push_back(std::stoi(value));
[0.771s] 5: -            }
[0.771s] 5: -        }
[0.771s] 5: -
[0.771s] 5: -        template <class T, std::size_t N>
[0.771s] 5: -        std::string CriMessage::ArrayToString(std::array<T, N> &array)
[0.771s] 5: -        {
[0.772s] 5: -            std::ostringstream msg;
[0.772s] 5: -            msg << std::showpoint;
[0.772s] 5: -            msg << std::fixed;
[0.772s] 5: -            msg << std::setprecision(FLOAT_PRINT_PRECISION);
[0.772s] 5: -
[0.772s] 5: -            for (T val : array)
[0.772s] 5: -            {
[0.772s] 5: -                msg << val << " ";
[0.772s] 5: -            }
[0.772s] 5: -
[0.772s] 5: -            return msg.str();
[0.772s] 5: -        }
[0.772s] 5: -
[0.772s] 5: -        template <class T>
[0.772s] 5: -        std::string CriMessage::VectorToString(std::vector<T> &vector)
[0.772s] 5: -        {
[0.772s] 5: -            std::ostringstream msg;
[0.772s] 5: -            msg << std::showpoint;
[0.772s] 5: -            msg << std::fixed;
[0.772s] 5: -            msg << std::setprecision(FLOAT_PRINT_PRECISION);
[0.772s] 5: -
[0.772s] 5: -            for (T val : vector)
[0.772s] 5: -            {
[0.772s] 5: -                msg << val << " ";
[0.772s] 5: -            }
[0.772s] 5: -
[0.772s] 5: -            return msg.str();
[0.772s] 5: -        }
[0.772s] 5: -
[0.772s] 5: -        Status::Status(const std::string &messageString) : CriMessage(MessageType::STATUS)
[0.772s] 5: -        {
[0.772s] 5: -            std::string::size_type modeStart = messageString.find(CriKeywords::STATUS_MODE);
[0.772s] 5: -            std::string::size_type posJointSetPointStart = messageString.find(CriKeywords::STATUS_POSJOINTSETPOINT);
[0.772s] 5: -            std::string::size_type posJointCurrentStart = messageString.find(CriKeywords::STATUS_POSJOINTCURRENT);
[0.772s] 5: -            std::string::size_type posCartRobotStart = messageString.find(CriKeywords::STATUS_POSCARTROBOT);
[0.772s] 5: -            std::string::size_type posCartPlattformStart = messageString.find(CriKeywords::STATUS_POSCARTPLATTFORM);
[0.773s] 5: -            std::string::size_type overrideValueStart = messageString.find(CriKeywords::STATUS_OVERRIDE);
[0.773s] 5: -            std::string::size_type dinStart = messageString.find(CriKeywords::STATUS_DIN);
[0.773s] 5: -            std::string::size_type doutStart = messageString.find(CriKeywords::STATUS_DOUT);
[0.773s] 5: -            std::string::size_type eStopStart = messageString.find(CriKeywords::STATUS_ESTOP);
[0.773s] 5: -            std::string::size_type supplyStart = messageString.find(CriKeywords::STATUS_SUPPLY);
[0.773s] 5: -            std::string::size_type currentallStart = messageString.find(CriKeywords::STATUS_CURRENTALL);
[0.773s] 5: -            std::string::size_type currentjointsStart = messageString.find(CriKeywords::STATUS_CURRENTJOINTS);
[0.773s] 5: -            std::string::size_type errorStart = messageString.find(CriKeywords::STATUS_ERROR);
[0.773s] 5: -            std::string::size_type kinstateStart = messageString.find(CriKeywords::STATUS_KINSTATE);
[0.773s] 5: -
[0.773s] 5: -            if (
[0.773s] 5: -                !(
[0.773s] 5: -                    (modeStart < posJointSetPointStart) &&
[0.773s] 5: -                    (posJointSetPointStart < posJointCurrentStart) &&
[0.773s] 5: -                    (posJointCurrentStart < posCartRobotStart) &&
[0.773s] 5: -                    (posCartRobotStart < posCartPlattformStart) &&
[0.773s] 5: -                    (posCartPlattformStart < overrideValueStart) &&
[0.773s] 5: -                    (overrideValueStart < dinStart) &&
[0.773s] 5: -                    (dinStart < doutStart) &&
[0.773s] 5: -                    (doutStart < eStopStart) &&
[0.773s] 5: -                    (eStopStart < supplyStart) &&
[0.773s] 5: -                    (supplyStart < currentallStart) &&
[0.773s] 5: -                    (currentallStart < currentjointsStart) &&
[0.773s] 5: -                    (currentjointsStart < errorStart) &&
[0.773s] 5: -                    (errorStart < kinstateStart)))
[0.773s] 5: -            {
[0.773s] 5: -                RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Bad parsing error for message \"%s\"", messageString.c_str());
[0.773s] 5: -                return;
[0.773s] 5: -            }
[0.773s] 5: -
[0.773s] 5: -            std::string modeString = ParseMessageString(messageString, modeStart, posJointSetPointStart,
[0.773s] 5: +  if (msg.at(0) == ' ') {
[0.773s] 5: +    typeStart = msg.find(" ", 1) + 1;
[0.773s] 5: +  } else {
[0.773s] 5: +    typeStart = msg.find(" ") + 1;
[0.773s] 5: +  }
[0.773s] 5: +  std::string::size_type typeEnd = msg.find(" ", typeStart);
[0.774s] 5: +
[0.774s] 5: +  std::string typeString = msg.substr(typeStart, typeEnd - typeStart);
[0.774s] 5: +
[0.774s] 5: +  if (typeString == CriKeywords::TYPE_STATUS) {
[0.774s] 5: +    return MessageType::STATUS;
[0.774s] 5: +  }
[0.774s] 5: +
[0.774s] 5: +  if (typeString == CriKeywords::TYPE_OPINFO) {
[0.774s] 5: +    return MessageType::OPINFO;
[0.774s] 5: +  }
[0.774s] 5: +
[0.774s] 5: +  if (typeString == CriKeywords::TYPE_GSIG) {
[0.774s] 5: +    return MessageType::GSIG;
[0.774s] 5: +  }
[0.774s] 5: +
[0.774s] 5: +  if (typeString == CriKeywords::TYPE_GRIPPERSTATE) {
[0.774s] 5: +    return MessageType::GRIPPERSTATE;
[0.774s] 5: +  }
[0.774s] 5: +
[0.774s] 5: +  if (typeString == CriKeywords::TYPE_RUNSTATE) {
[0.774s] 5: +    return MessageType::RUNSTATE;
[0.774s] 5: +  }
[0.774s] 5: +
[0.774s] 5: +  if (typeString == CriKeywords::TYPE_MESSAGE) {
[0.774s] 5: +    return MessageType::MESSAGE;
[0.774s] 5: +  }
[0.774s] 5: +
[0.774s] 5: +  if (typeString == CriKeywords::TYPE_CMD) {
[0.774s] 5: +    return MessageType::CMD;
[0.774s] 5: +  }
[0.774s] 5: +
[0.774s] 5: +  if (typeString == CriKeywords::TYPE_CONFIG) {
[0.774s] 5: +    return MessageType::CONFIG;
[0.774s] 5: +  }
[0.774s] 5: +
[0.774s] 5: +  if (typeString == CriKeywords::TYPE_INFO) {
[0.774s] 5: +    return MessageType::INFO;
[0.775s] 5: +  }
[0.775s] 5: +
[0.775s] 5: +  if (typeString == CriKeywords::TYPE_LOGMSG) {
[0.775s] 5: +    return MessageType::LOGMSG;
[0.775s] 5: +  }
[0.775s] 5: +
[0.775s] 5: +  if (typeString == CriKeywords::TYPE_VARIABLES) {
[0.775s] 5: +    return MessageType::VARIABLES;
[0.775s] 5: +  }
[0.775s] 5: +
[0.775s] 5: +  if (typeString == CriKeywords::TYPE_CMDERROR) {
[0.775s] 5: +    return MessageType::CMDERROR;
[0.775s] 5: +  }
[0.775s] 5: +
[0.775s] 5: +  if (typeString == CriKeywords::TYPE_CMDACK) {
[0.775s] 5: +    return MessageType::CMDACK;
[0.775s] 5: +  }
[0.775s] 5: +
[0.775s] 5: +  if (typeString == CriKeywords::TYPE_CYCLESTAT) {
[0.775s] 5: +    return MessageType::CYCLESTAT;
[0.775s] 5: +  }
[0.775s] 5: +
[0.775s] 5: +  RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Unknown message type: \"%s\"",
[0.775s] 5: +        typeString.c_str());
[0.775s] 5: +  return MessageType::UNKNOWN;
[0.775s] 5: +}
[0.775s] 5: +
[0.775s] 5: +std::string CriMessage::ParseMessageString(
[0.775s] 5: +  const std::string & statusString, const std::string::size_type & begin,
[0.775s] 5: +  const std::string::size_type & end, const std::string::size_type & keywordLength)
[0.775s] 5: +{
[0.775s] 5: +  int start = begin + keywordLength + 1;
[0.775s] 5: +  int length = end - start - 1;
[0.775s] 5: +
[0.775s] 5: +  return statusString.substr(start, length);
[0.775s] 5: +}
[0.775s] 5: +
[0.776s] 5: +template<class T, std::size_t N>
[0.776s] 5: +void CriMessage::FillArray(std::array<T, N> & array, const std::string & spaceSeparatedValues)
[0.776s] 5: +{
[0.776s] 5: +  typename std::array<T, N>::size_type idx = 0;
[0.776s] 5: +  std::string::size_type begin = 0;
[0.776s] 5: +  std::string::size_type end = spaceSeparatedValues.find(" ", begin + 1);
[0.776s] 5: +
[0.776s] 5: +  while (end != std::string::npos) {
[0.776s] 5: +    if (idx >= N) {
[0.776s] 5: +      RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Parsing error");
[0.776s] 5: +      return;
[0.776s] 5: +    }
[0.776s] 5: +
[0.776s] 5: +    std::string value = spaceSeparatedValues.substr(begin, end - begin);
[0.776s] 5: +
[0.776s] 5: +    if (std::is_same<float, T>::value) {
[0.776s] 5: +      array.at(idx) = std::stof(value);
[0.776s] 5: +    }
[0.776s] 5: +
[0.776s] 5: +    if (std::is_same<int, T>::value) {
[0.776s] 5: +      array.at(idx) = std::stoi(value);
[0.776s] 5: +    }
[0.776s] 5: +
[0.776s] 5: +    begin = spaceSeparatedValues.find(" ", end);
[0.776s] 5: +    end = spaceSeparatedValues.find(" ", begin + 1);
[0.776s] 5: +    idx++;
[0.776s] 5: +  }
[0.776s] 5: +
[0.776s] 5: +  std::string value = spaceSeparatedValues.substr(begin);
[0.776s] 5: +
[0.776s] 5: +  if (std::is_same<float, T>::value) {
[0.776s] 5: +    array.at(idx) = std::stof(value);
[0.776s] 5: +  }
[0.776s] 5: +
[0.776s] 5: +  if (std::is_same<int, T>::value) {
[0.776s] 5: +    array.at(idx) = std::stoi(value);
[0.776s] 5: +  }
[0.777s] 5: +}
[0.777s] 5: +
[0.777s] 5: +template<class T>
[0.777s] 5: +void CriMessage::FillVector(std::vector<T> & vector, const std::string & spaceSeparatedValues)
[0.777s] 5: +{
[0.777s] 5: +  std::string::size_type begin = 0;
[0.777s] 5: +  std::string::size_type end = spaceSeparatedValues.find(" ", begin + 1);
[0.777s] 5: +
[0.777s] 5: +  while (end != std::string::npos) {
[0.777s] 5: +    std::string value = spaceSeparatedValues.substr(begin, end - begin);
[0.777s] 5: +
[0.777s] 5: +    if (std::is_same<float, T>::value) {
[0.777s] 5: +      vector.push_back(std::stof(value));
[0.777s] 5: +    }
[0.777s] 5: +
[0.777s] 5: +    if (std::is_same<int, T>::value) {
[0.777s] 5: +      vector.push_back(std::stoi(value));
[0.777s] 5: +    }
[0.777s] 5: +
[0.777s] 5: +    begin = spaceSeparatedValues.find(" ", end);
[0.777s] 5: +    end = spaceSeparatedValues.find(" ", begin + 1);
[0.777s] 5: +  }
[0.777s] 5: +
[0.777s] 5: +  std::string value = spaceSeparatedValues.substr(begin);
[0.777s] 5: +
[0.777s] 5: +  if (std::is_same<float, T>::value) {
[0.777s] 5: +    vector.push_back(std::stof(value));
[0.777s] 5: +  }
[0.777s] 5: +
[0.777s] 5: +  if (std::is_same<int, T>::value) {
[0.777s] 5: +    vector.push_back(std::stoi(value));
[0.777s] 5: +  }
[0.777s] 5: +}
[0.777s] 5: +
[0.777s] 5: +template<class T, std::size_t N>
[0.777s] 5: +std::string CriMessage::ArrayToString(std::array<T, N> & array)
[0.777s] 5: +{
[0.778s] 5: +  std::ostringstream msg;
[0.778s] 5: +  msg << std::showpoint;
[0.778s] 5: +  msg << std::fixed;
[0.778s] 5: +  msg << std::setprecision(FLOAT_PRINT_PRECISION);
[0.778s] 5: +
[0.778s] 5: +  for (T val : array) {
[0.778s] 5: +    msg << val << " ";
[0.778s] 5: +  }
[0.778s] 5: +
[0.778s] 5: +  return msg.str();
[0.778s] 5: +}
[0.778s] 5: +
[0.778s] 5: +template<class T>
[0.778s] 5: +std::string CriMessage::VectorToString(std::vector<T> & vector)
[0.778s] 5: +{
[0.778s] 5: +  std::ostringstream msg;
[0.778s] 5: +  msg << std::showpoint;
[0.778s] 5: +  msg << std::fixed;
[0.778s] 5: +  msg << std::setprecision(FLOAT_PRINT_PRECISION);
[0.778s] 5: +
[0.778s] 5: +  for (T val : vector) {
[0.778s] 5: +    msg << val << " ";
[0.778s] 5: +  }
[0.778s] 5: +
[0.778s] 5: +  return msg.str();
[0.778s] 5: +}
[0.778s] 5: +
[0.778s] 5: +Status::Status(const std::string & messageString)
[0.778s] 5: +: CriMessage(MessageType::STATUS)
[0.778s] 5: +{
[0.778s] 5: +  std::string::size_type modeStart = messageString.find(CriKeywords::STATUS_MODE);
[0.778s] 5: +  std::string::size_type posJointSetPointStart =
[0.778s] 5: +    messageString.find(CriKeywords::STATUS_POSJOINTSETPOINT);
[0.778s] 5: +  std::string::size_type posJointCurrentStart =
[0.778s] 5: +    messageString.find(CriKeywords::STATUS_POSJOINTCURRENT);
[0.778s] 5: +  std::string::size_type posCartRobotStart = messageString.find(CriKeywords::STATUS_POSCARTROBOT);
[0.778s] 5: +  std::string::size_type posCartPlattformStart =
[0.779s] 5: +    messageString.find(CriKeywords::STATUS_POSCARTPLATTFORM);
[0.779s] 5: +  std::string::size_type overrideValueStart = messageString.find(CriKeywords::STATUS_OVERRIDE);
[0.779s] 5: +  std::string::size_type dinStart = messageString.find(CriKeywords::STATUS_DIN);
[0.779s] 5: +  std::string::size_type doutStart = messageString.find(CriKeywords::STATUS_DOUT);
[0.779s] 5: +  std::string::size_type eStopStart = messageString.find(CriKeywords::STATUS_ESTOP);
[0.779s] 5: +  std::string::size_type supplyStart = messageString.find(CriKeywords::STATUS_SUPPLY);
[0.779s] 5: +  std::string::size_type currentallStart = messageString.find(CriKeywords::STATUS_CURRENTALL);
[0.779s] 5: +  std::string::size_type currentjointsStart = messageString.find(CriKeywords::STATUS_CURRENTJOINTS);
[0.779s] 5: +  std::string::size_type errorStart = messageString.find(CriKeywords::STATUS_ERROR);
[0.779s] 5: +  std::string::size_type kinstateStart = messageString.find(CriKeywords::STATUS_KINSTATE);
[0.779s] 5: +
[0.779s] 5: +  if (
[0.779s] 5: +    !(
[0.779s] 5: +      (modeStart < posJointSetPointStart) &&
[0.779s] 5: +      (posJointSetPointStart < posJointCurrentStart) &&
[0.779s] 5: +      (posJointCurrentStart < posCartRobotStart) &&
[0.779s] 5: +      (posCartRobotStart < posCartPlattformStart) &&
[0.779s] 5: +      (posCartPlattformStart < overrideValueStart) &&
[0.779s] 5: +      (overrideValueStart < dinStart) &&
[0.779s] 5: +      (dinStart < doutStart) &&
[0.779s] 5: +      (doutStart < eStopStart) &&
[0.779s] 5: +      (eStopStart < supplyStart) &&
[0.779s] 5: +      (supplyStart < currentallStart) &&
[0.779s] 5: +      (currentallStart < currentjointsStart) &&
[0.779s] 5: +      (currentjointsStart < errorStart) &&
[0.779s] 5: +      (errorStart < kinstateStart)))
[0.779s] 5: +  {
[0.779s] 5: +    RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Bad parsing error for message \"%s\"",
[0.779s] 5: +          messageString.c_str());
[0.779s] 5: +    return;
[0.779s] 5: +  }
[0.779s] 5: +
[0.779s] 5: +  std::string modeString = ParseMessageString(messageString, modeStart, posJointSetPointStart,
[0.779s] 5: @@ -264,11 +241,16 @@
[0.779s] 5: -            std::string posJointSetPointString = ParseMessageString(messageString, posJointSetPointStart,
[0.779s] 5: -                                                                    posJointCurrentStart, CriKeywords::STATUS_POSJOINTSETPOINT.size());
[0.779s] 5: -            std::string posJointCurrentString = ParseMessageString(messageString, posJointCurrentStart,
[0.780s] 5: -                                                                   posCartRobotStart, CriKeywords::STATUS_POSJOINTCURRENT.size());
[0.780s] 5: -            std::string posCartRobotString = ParseMessageString(messageString, posCartRobotStart,
[0.780s] 5: -                                                                posCartPlattformStart, CriKeywords::STATUS_POSCARTROBOT.size());
[0.780s] 5: -            std::string posCartPlattformString = ParseMessageString(messageString, posCartPlattformStart,
[0.780s] 5: -                                                                    overrideValueStart, CriKeywords::STATUS_POSCARTPLATTFORM.size());
[0.780s] 5: -            std::string overrideValueString = ParseMessageString(messageString, overrideValueStart,
[0.780s] 5: -                                                                 dinStart, CriKeywords::STATUS_OVERRIDE.size());
[0.780s] 5: -            std::string dinString = ParseMessageString(messageString, dinStart, doutStart,
[0.780s] 5: +  std::string posJointSetPointString = ParseMessageString(messageString, posJointSetPointStart,
[0.780s] 5: +                                                                    posJointCurrentStart,
[0.780s] 5: +        CriKeywords::STATUS_POSJOINTSETPOINT.size());
[0.780s] 5: +  std::string posJointCurrentString = ParseMessageString(messageString, posJointCurrentStart,
[0.780s] 5: +                                                                   posCartRobotStart,
[0.780s] 5: +        CriKeywords::STATUS_POSJOINTCURRENT.size());
[0.780s] 5: +  std::string posCartRobotString = ParseMessageString(messageString, posCartRobotStart,
[0.780s] 5: +                                                                posCartPlattformStart,
[0.780s] 5: +        CriKeywords::STATUS_POSCARTROBOT.size());
[0.780s] 5: +  std::string posCartPlattformString = ParseMessageString(messageString, posCartPlattformStart,
[0.780s] 5: +                                                                    overrideValueStart,
[0.780s] 5: +        CriKeywords::STATUS_POSCARTPLATTFORM.size());
[0.780s] 5: +  std::string overrideValueString = ParseMessageString(messageString, overrideValueStart,
[0.780s] 5: +                                                                 dinStart,
[0.780s] 5: +        CriKeywords::STATUS_OVERRIDE.size());
[0.780s] 5: +  std::string dinString = ParseMessageString(messageString, dinStart, doutStart,
[0.780s] 5: @@ -276 +258 @@
[0.780s] 5: -            std::string doutString = ParseMessageString(messageString, doutStart, eStopStart,
[0.780s] 5: +  std::string doutString = ParseMessageString(messageString, doutStart, eStopStart,
[0.780s] 5: @@ -278 +260 @@
[0.780s] 5: -            std::string eStopString = ParseMessageString(messageString, eStopStart, supplyStart,
[0.780s] 5: +  std::string eStopString = ParseMessageString(messageString, eStopStart, supplyStart,
[0.780s] 5: @@ -280 +262 @@
[0.780s] 5: -            std::string supplyString = ParseMessageString(messageString, supplyStart, currentallStart,
[0.781s] 5: +  std::string supplyString = ParseMessageString(messageString, supplyStart, currentallStart,
[0.781s] 5: @@ -282 +264,2 @@
[0.781s] 5: -            std::string currentallString = ParseMessageString(messageString, currentallStart, currentjointsStart,
[0.781s] 5: +  std::string currentallString = ParseMessageString(messageString, currentallStart,
[0.781s] 5: +        currentjointsStart,
[0.781s] 5: @@ -284,3 +267,5 @@
[0.781s] 5: -            std::string currentjointsString = ParseMessageString(messageString, currentjointsStart, errorStart,
[0.781s] 5: -                                                                 CriKeywords::STATUS_CURRENTJOINTS.size());
[0.781s] 5: -            std::string errorString = ParseMessageString(messageString, errorStart, kinstateStart,
[0.781s] 5: +  std::string currentjointsString = ParseMessageString(messageString, currentjointsStart,
[0.781s] 5: +        errorStart,
[0.781s] 5: +                                                                 CriKeywords::STATUS_CURRENTJOINTS.
[0.781s] 5: +      size());
[0.781s] 5: +  std::string errorString = ParseMessageString(messageString, errorStart, kinstateStart,
[0.781s] 5: @@ -288 +273,2 @@
[0.781s] 5: -            std::string kinstateString = ParseMessageString(messageString, kinstateStart, messageString.size() + 1,
[0.781s] 5: +  std::string kinstateString = ParseMessageString(messageString, kinstateStart,
[0.781s] 5: +        messageString.size() + 1,
[0.781s] 5: @@ -291,20 +277,20 @@
[0.781s] 5: -            std::string::size_type errorSummaryEnd = errorString.find(" ");
[0.781s] 5: -            errorSummary = errorString.substr(0, errorSummaryEnd);
[0.781s] 5: -            std::string errorJointsString = errorString.substr(errorSummaryEnd + 1);
[0.781s] 5: -
[0.781s] 5: -            mode = GetMode(modeString);
[0.781s] 5: -            FillArray(posJointSetPoint, posJointSetPointString);
[0.781s] 5: -            FillArray(posJointCurrent, posJointCurrentString);
[0.781s] 5: -            FillArray(posCartRobot, posCartRobotString);
[0.781s] 5: -            FillArray(posCartPlattform, posCartPlattformString);
[0.781s] 5: -            try {
[0.781s] 5: -                overrideValue = std::stof(overrideValueString);
[0.781s] 5: -                din = std::stoi(dinString);     // TODO: Process further to actual meaning
[0.781s] 5: -                dout = std::stoi(doutString);   // TODO: Process further to actual meaning
[0.781s] 5: -                eStop = std::stoi(eStopString); // TODO: Process further to actual meaning
[0.781s] 5: -                supply = std::stoi(supplyString);
[0.781s] 5: -                currentall = std::stoi(currentallString);
[0.782s] 5: -            } catch (const std::invalid_argument &e) {
[0.782s] 5: -                RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Error parsing status message: %s", e.what());
[0.782s] 5: -            }
[0.782s] 5: -            FillArray(currentjoints, currentjointsString);
[0.782s] 5: +  std::string::size_type errorSummaryEnd = errorString.find(" ");
[0.782s] 5: +  errorSummary = errorString.substr(0, errorSummaryEnd);
[0.782s] 5: +  std::string errorJointsString = errorString.substr(errorSummaryEnd + 1);
[0.782s] 5: +
[0.782s] 5: +  mode = GetMode(modeString);
[0.782s] 5: +  FillArray(posJointSetPoint, posJointSetPointString);
[0.782s] 5: +  FillArray(posJointCurrent, posJointCurrentString);
[0.782s] 5: +  FillArray(posCartRobot, posCartRobotString);
[0.782s] 5: +  FillArray(posCartPlattform, posCartPlattformString);
[0.782s] 5: +  try {
[0.782s] 5: +    overrideValue = std::stof(overrideValueString);
[0.782s] 5: +    din = std::stoi(dinString);                 // TODO: Process further to actual meaning
[0.782s] 5: +    dout = std::stoi(doutString);               // TODO: Process further to actual meaning
[0.782s] 5: +    eStop = std::stoi(eStopString);             // TODO: Process further to actual meaning
[0.782s] 5: +    supply = std::stoi(supplyString);
[0.782s] 5: +    currentall = std::stoi(currentallString);
[0.782s] 5: +  } catch (const std::invalid_argument & e) {
[0.782s] 5: +    RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Error parsing status message: %s", e.what());
[0.782s] 5: +  }
[0.782s] 5: +  FillArray(currentjoints, currentjointsString);
[0.782s] 5: @@ -312,59 +298,60 @@
[0.782s] 5: -            FillArray(errorJoints, errorJointsString); // TODO: Process further to actual meaning
[0.782s] 5: -            kinstate = GetKinstate(kinstateString);
[0.782s] 5: -        }
[0.783s] 5: -
[0.783s] 5: -        Status::Status() : CriMessage(MessageType::STATUS)
[0.783s] 5: -        {
[0.783s] 5: -            mode = Mode::UNKNOWN;
[0.783s] 5: -            posJointSetPoint.fill(0.0f);
[0.783s] 5: -            posJointCurrent.fill(0.0f);
[0.783s] 5: -            posCartRobot.fill(0.0f);
[0.783s] 5: -            posCartPlattform.fill(0.0f);
[0.783s] 5: -            overrideValue = 0.0f;
[0.783s] 5: -            din = 0;
[0.784s] 5: -            dout = 0;
[0.784s] 5: -            eStop = 0;
[0.784s] 5: -            supply = 0;
[0.784s] 5: -            currentall = 0;
[0.784s] 5: -            currentjoints.fill(0);
[0.784s] 5: -            errorSummary = "NotInitialized";
[0.784s] 5: -            errorJoints.fill(0);
[0.784s] 5: -            kinstate = Kinstate::UNKNOWN;
[0.784s] 5: -        }
[0.784s] 5: -
[0.784s] 5: -        std::string Status::ModeToString(const Mode &mode)
[0.784s] 5: -        {
[0.784s] 5: -            switch (mode)
[0.784s] 5: -            {
[0.784s] 5: -            case Mode::JOINT:
[0.784s] 5: -                return "Joint";
[0.784s] 5: -            case Mode::CARTBASE:
[0.784s] 5: -                return "Cartesian (base)";
[0.784s] 5: -            case Mode::CARTTOOL:
[0.784s] 5: -                return "Cartesian (tool)";
[0.784s] 5: -            case Mode::PLATFORM:
[0.784s] 5: -                return "Platform";
[0.784s] 5: -            case Mode::FSM:
[0.784s] 5: -                return "FSM";
[0.784s] 5: -            case Mode::UNKNOWN:
[0.784s] 5: -                return "Unknown";
[0.784s] 5: -            }
[0.784s] 5: -
[0.785s] 5: -            return std::string();
[0.785s] 5: -        }
[0.785s] 5: -
[0.785s] 5: -        void Status::Print()
[0.785s] 5: -        {
[0.785s] 5: -            std::cout << ToString();
[0.785s] 5: -        }
[0.785s] 5: -
[0.785s] 5: -        void Status::Log()
[0.785s] 5: -        {
[0.785s] 5: -            rclcpp::Clock::SharedPtr clock_ = std::make_shared<rclcpp::Clock>(RCL_SYSTEM_TIME);
[0.785s] 5: -            RCLCPP_INFO_THROTTLE(rclcpp::get_logger("igus_rebel"), *clock_, 60, "Rebel status:\n%s", ToString().c_str());
[0.785s] 5: -        }
[0.785s] 5: -
[0.785s] 5: -        std::string Status::ToString()
[0.785s] 5: -        {
[0.785s] 5: -            std::ostringstream msg;
[0.785s] 5: -            msg << std::showpoint
[0.785s] 5: +  FillArray(errorJoints, errorJointsString);           // TODO: Process further to actual meaning
[0.785s] 5: +  kinstate = GetKinstate(kinstateString);
[0.785s] 5: +}
[0.785s] 5: +
[0.785s] 5: +Status::Status()
[0.785s] 5: +: CriMessage(MessageType::STATUS)
[0.785s] 5: +{
[0.785s] 5: +  mode = Mode::UNKNOWN;
[0.785s] 5: +  posJointSetPoint.fill(0.0f);
[0.785s] 5: +  posJointCurrent.fill(0.0f);
[0.785s] 5: +  posCartRobot.fill(0.0f);
[0.785s] 5: +  posCartPlattform.fill(0.0f);
[0.785s] 5: +  overrideValue = 0.0f;
[0.785s] 5: +  din = 0;
[0.785s] 5: +  dout = 0;
[0.785s] 5: +  eStop = 0;
[0.785s] 5: +  supply = 0;
[0.785s] 5: +  currentall = 0;
[0.785s] 5: +  currentjoints.fill(0);
[0.786s] 5: +  errorSummary = "NotInitialized";
[0.786s] 5: +  errorJoints.fill(0);
[0.786s] 5: +  kinstate = Kinstate::UNKNOWN;
[0.786s] 5: +}
[0.786s] 5: +
[0.786s] 5: +std::string Status::ModeToString(const Mode & mode)
[0.786s] 5: +{
[0.786s] 5: +  switch (mode) {
[0.786s] 5: +    case Mode::JOINT:
[0.786s] 5: +      return "Joint";
[0.786s] 5: +    case Mode::CARTBASE:
[0.786s] 5: +      return "Cartesian (base)";
[0.786s] 5: +    case Mode::CARTTOOL:
[0.786s] 5: +      return "Cartesian (tool)";
[0.786s] 5: +    case Mode::PLATFORM:
[0.786s] 5: +      return "Platform";
[0.786s] 5: +    case Mode::FSM:
[0.786s] 5: +      return "FSM";
[0.786s] 5: +    case Mode::UNKNOWN:
[0.786s] 5: +      return "Unknown";
[0.786s] 5: +  }
[0.786s] 5: +
[0.786s] 5: +  return std::string();
[0.786s] 5: +}
[0.786s] 5: +
[0.786s] 5: +void Status::Print()
[0.786s] 5: +{
[0.786s] 5: +  std::cout << ToString();
[0.786s] 5: +}
[0.786s] 5: +
[0.786s] 5: +void Status::Log()
[0.786s] 5: +{
[0.786s] 5: +  rclcpp::Clock::SharedPtr clock_ = std::make_shared<rclcpp::Clock>(RCL_SYSTEM_TIME);
[0.786s] 5: +  RCLCPP_INFO_THROTTLE(rclcpp::get_logger("igus_rebel"), *clock_, 60, "Rebel status:\n%s",
[0.786s] 5: +        ToString().c_str());
[0.786s] 5: +}
[0.787s] 5: +
[0.787s] 5: +std::string Status::ToString()
[0.787s] 5: +{
[0.787s] 5: +  std::ostringstream msg;
[0.787s] 5: +  msg           << std::showpoint
[0.787s] 5: @@ -390,303 +377,175 @@
[0.787s] 5: -            return msg.str();
[0.787s] 5: -        }
[0.787s] 5: -
[0.787s] 5: -        Mode Status::GetMode(const std::string &modeString)
[0.787s] 5: -        {
[0.787s] 5: -            if (modeString == CriKeywords::MODE_JOINT)
[0.787s] 5: -            {
[0.787s] 5: -                return Mode::JOINT;
[0.787s] 5: -            }
[0.787s] 5: -
[0.787s] 5: -            if (modeString == CriKeywords::MODE_CARTBASE)
[0.787s] 5: -            {
[0.787s] 5: -                return Mode::CARTBASE;
[0.787s] 5: -            }
[0.787s] 5: -
[0.787s] 5: -            if (modeString == CriKeywords::MODE_CARTTOOL)
[0.787s] 5: -            {
[0.787s] 5: -                return Mode::CARTTOOL;
[0.787s] 5: -            }
[0.787s] 5: -
[0.787s] 5: -            if (modeString == CriKeywords::MODE_PLATFORM)
[0.787s] 5: -            {
[0.787s] 5: -                return Mode::PLATFORM;
[0.787s] 5: -            }
[0.787s] 5: -
[0.787s] 5: -            if (modeString == CriKeywords::MODE_FSM)
[0.787s] 5: -            {
[0.787s] 5: -                return Mode::FSM;
[0.787s] 5: -            }
[0.787s] 5: -
[0.787s] 5: -            RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Unknown robot mode during parsing: %s", modeString.c_str());
[0.788s] 5: -            return Mode::UNKNOWN;
[0.788s] 5: -        }
[0.788s] 5: -
[0.788s] 5: -        Kinstate Status::GetKinstate(const std::string &kinstateString)
[0.788s] 5: -        {
[0.788s] 5: -            int kinstateInt = std::stoi(kinstateString);
[0.788s] 5: -
[0.788s] 5: -            switch (kinstateInt)
[0.788s] 5: -            {
[0.788s] 5: -            case (int)Kinstate::NO_ERROR:
[0.788s] 5: -                return Kinstate::NO_ERROR;
[0.788s] 5: -
[0.788s] 5: -            case (int)Kinstate::JOINT_LIMIT_MIN:
[0.788s] 5: -                return Kinstate::JOINT_LIMIT_MIN;
[0.788s] 5: -
[0.788s] 5: -            case (int)Kinstate::JOINT_LIMIT_MAX:
[0.788s] 5: -                return Kinstate::JOINT_LIMIT_MAX;
[0.788s] 5: -
[0.788s] 5: -            case (int)Kinstate::CARTESIAN_SINGULARITY_CENTER:
[0.788s] 5: -                return Kinstate::CARTESIAN_SINGULARITY_CENTER;
[0.788s] 5: -
[0.788s] 5: -            case (int)Kinstate::CARTESIAN_SINGULARITY_REACH:
[0.788s] 5: -                return Kinstate::CARTESIAN_SINGULARITY_REACH;
[0.788s] 5: -
[0.788s] 5: -            case (int)Kinstate::CARTESIAN_SINGULARITY_WRIST:
[0.788s] 5: -                return Kinstate::CARTESIAN_SINGULARITY_WRIST;
[0.788s] 5: -
[0.788s] 5: -            case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_1:
[0.788s] 5: -                return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_1;
[0.788s] 5: -
[0.788s] 5: -            case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_2:
[0.788s] 5: -                return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_2;
[0.788s] 5: -
[0.788s] 5: -            case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_3:
[0.788s] 5: -                return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_3;
[0.788s] 5: -
[0.788s] 5: -            case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_4:
[0.788s] 5: -                return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_4;
[0.789s] 5: -
[0.789s] 5: -            case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_5:
[0.789s] 5: -                return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_5;
[0.789s] 5: -
[0.789s] 5: -            case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_6:
[0.789s] 5: -                return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_6;
[0.789s] 5: -
[0.789s] 5: -            case (int)Kinstate::MOTION_NOT_ALLOWED:
[0.789s] 5: -                return Kinstate::MOTION_NOT_ALLOWED;
[0.789s] 5: -
[0.789s] 5: -            default:
[0.789s] 5: -                return Kinstate::UNKNOWN;
[0.789s] 5: -            }
[0.789s] 5: -        }
[0.789s] 5: -
[0.789s] 5: -        Message::Message(const std::string &messageString) : CriMessage(MessageType::MESSAGE)
[0.789s] 5: -        {
[0.789s] 5: -            std::string::size_type messageStart =
[0.789s] 5: -                messageString.find(CriKeywords::TYPE_MESSAGE) + CriKeywords::TYPE_MESSAGE.size() + 1;
[0.789s] 5: -            message = messageString.substr(messageStart);
[0.789s] 5: -        }
[0.789s] 5: -
[0.789s] 5: -        Command::Command(const std::string &messageString) : CriMessage(MessageType::CMD)
[0.789s] 5: -        {
[0.789s] 5: -            std::string::size_type commandStart =
[0.789s] 5: -                messageString.find(CriKeywords::TYPE_CMD) + CriKeywords::TYPE_CMD.size() + 1;
[0.789s] 5: -            command = messageString.substr(commandStart);
[0.789s] 5: -        }
[0.789s] 5: -
[0.789s] 5: -        Info::Info(const std::string &messageString) : CriMessage(MessageType::INFO)
[0.789s] 5: -        {
[0.789s] 5: -            std::string::size_type infoStart =
[0.789s] 5: -                messageString.find(CriKeywords::TYPE_INFO) + CriKeywords::TYPE_INFO.size() + 1;
[0.789s] 5: -            info = messageString.substr(infoStart);
[0.789s] 5: -        }
[0.789s] 5: -
[0.790s] 5: -        LogMsg::LogMsg(const std::string &messageString) : CriMessage(MessageType::LOGMSG)
[0.790s] 5: -        {
[0.790s] 5: -            std::string::size_type logLvlStart = messageString.find(CriKeywords::TYPE_LOGMSG) + CriKeywords::TYPE_LOGMSG.size() + 1;
[0.790s] 5: -            std::string::size_type timestampStart = messageString.find(" ", logLvlStart) + 1;
[0.790s] 5: -            std::string::size_type msgStart = messageString.find(" ", timestampStart) + 1;
[0.790s] 5: -
[0.790s] 5: -            logLevel = GetLogLevel(messageString.substr(logLvlStart, (timestampStart - logLvlStart - 1)));
[0.790s] 5: -            timestamp = std::stol(messageString.substr(timestampStart, (msgStart - timestampStart - 1)));
[0.790s] 5: -            logMsg = messageString.substr(msgStart);
[0.790s] 5: -        }
[0.790s] 5: -
[0.790s] 5: -        LogLevel LogMsg::GetLogLevel(const std::string &logLvlString)
[0.790s] 5: -        {
[0.790s] 5: -            if (logLvlString == CriKeywords::LOG_LEVEL_DEBUG)
[0.790s] 5: -            {
[0.790s] 5: -                return LogLevel::DEBUG;
[0.790s] 5: -            }
[0.790s] 5: -
[0.790s] 5: -            if (logLvlString == CriKeywords::LOG_LEVEL_APP_INFO)
[0.790s] 5: -            {
[0.790s] 5: -                return LogLevel::APP_INFO;
[0.790s] 5: -            }
[0.790s] 5: -
[0.790s] 5: -            if (logLvlString == CriKeywords::LOG_LEVEL_APP_ERROR)
[0.790s] 5: -            {
[0.790s] 5: -                return LogLevel::APP_ERROR;
[0.790s] 5: -            }
[0.790s] 5: -
[0.790s] 5: -            if (logLvlString == CriKeywords::LOG_LEVEL_INFO)
[0.790s] 5: -            {
[0.790s] 5: -                return LogLevel::INFO;
[0.790s] 5: -            }
[0.790s] 5: -
[0.790s] 5: -            if (logLvlString == CriKeywords::LOG_LEVEL_WARN)
[0.790s] 5: -            {
[0.790s] 5: -                return LogLevel::WARN;
[0.790s] 5: -            }
[0.791s] 5: -
[0.791s] 5: -            if (logLvlString == CriKeywords::LOG_LEVEL_ERROR)
[0.791s] 5: -            {
[0.791s] 5: -                return LogLevel::ERROR;
[0.791s] 5: -            }
[0.791s] 5: -
[0.791s] 5: -            if (logLvlString == CriKeywords::LOG_LEVEL_FATAL)
[0.791s] 5: -            {
[0.791s] 5: -                return LogLevel::FATAL;
[0.791s] 5: -            }
[0.791s] 5: -
[0.791s] 5: -            RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Unknown log level during parsing: %s", logLvlString.c_str());
[0.791s] 5: -            return LogLevel::UNKNOWN;
[0.791s] 5: -        }
[0.791s] 5: -
[0.791s] 5: -        Variables::Variables(const std::string &messageString) : CriMessage(MessageType::VARIABLES),
[0.791s] 5: -                                                                 numberVariables(),
[0.791s] 5: -                                                                 positionVariables()
[0.791s] 5: -        {
[0.791s] 5: -            std::regex variables_regex("\\S+");
[0.791s] 5: -            auto variables_begin = std::sregex_iterator(messageString.begin(), messageString.end(), variables_regex);
[0.791s] 5: -            auto variables_end = std::sregex_iterator();
[0.791s] 5: -
[0.791s] 5: -            std::sregex_iterator it = variables_begin;
[0.791s] 5: -            while (it != variables_end)
[0.791s] 5: -            {
[0.791s] 5: -                std::string matchStr = GetMatchString((*it));
[0.791s] 5: -
[0.791s] 5: -                if (matchStr.compare(CriKeywords::VARIABLES_NR_VARIABLE) == 0)
[0.791s] 5: -                {
[0.791s] 5: -                    NumberVariable nv;
[0.791s] 5: -
[0.791s] 5: -                    it++;
[0.791s] 5: -                    nv.name = GetMatchString(*it);
[0.791s] 5: -
[0.791s] 5: -                    it++;
[0.791s] 5: -                    nv.value = std::stod(GetMatchString(*it));
[0.791s] 5: -
[0.792s] 5: -                    numberVariables.push_back(nv);
[0.792s] 5: -                }
[0.792s] 5: -
[0.792s] 5: -                if (matchStr.compare(CriKeywords::VARIABLES_POS_VARIABLE) == 0)
[0.792s] 5: -                {
[0.792s] 5: -                    PositionVariable pv;
[0.792s] 5: -
[0.792s] 5: -                    it++;
[0.792s] 5: -                    pv.name = GetMatchString(*it);
[0.792s] 5: -
[0.792s] 5: -                    for (auto i = 0; i < 15; i++)
[0.792s] 5: -                    {
[0.792s] 5: -                        it++;
[0.792s] 5: -                        pv.values[i] = std::stod(GetMatchString(*it));
[0.792s] 5: -                    }
[0.792s] 5: -                    positionVariables.push_back(pv);
[0.792s] 5: -                }
[0.792s] 5: -
[0.792s] 5: -                it++;
[0.792s] 5: -            }
[0.792s] 5: -        }
[0.792s] 5: -
[0.792s] 5: -        std::string Variables::GetMatchString(const std::smatch &smatch)
[0.792s] 5: -        {
[0.792s] 5: -            std::string matchStr = smatch.str();
[0.792s] 5: -            if (matchStr.length() > 0 && matchStr.back() == ',')
[0.792s] 5: -            {
[0.792s] 5: -                matchStr.pop_back();
[0.792s] 5: -            }
[0.792s] 5: -            return matchStr;
[0.792s] 5: -        }
[0.792s] 5: -
[0.792s] 5: -        CmdError::CmdError(const std::string &messageString) : CriMessage(MessageType::CMDERROR)
[0.792s] 5: -        {
[0.792s] 5: -            std::string::size_type commandErrorStart = messageString.find(CriKeywords::TYPE_CMDERROR) + CriKeywords::TYPE_CMDERROR.size();
[0.792s] 5: -            std::string::size_type countStart = messageString.find(" ", commandErrorStart) + 1;
[0.792s] 5: -            std::string::size_type errorMsgStart = messageString.find(" ", countStart) + 1;
[0.793s] 5: -
[0.793s] 5: -            recjectedCmd = std::stoi(messageString.substr(countStart, errorMsgStart - countStart - 1));
[0.793s] 5: -            error = messageString.substr(errorMsgStart);
[0.793s] 5: -        }
[0.793s] 5: -
[0.793s] 5: -        CmdAck::CmdAck(const std::string &messageString) : CriMessage(MessageType::CMDACK)
[0.793s] 5: -        {
[0.793s] 5: -            std::string::size_type commandAckStart = messageString.find(CriKeywords::TYPE_CMDACK) + CriKeywords::TYPE_CMDACK.size();
[0.793s] 5: -            acceptedCmd = std::stoi(messageString.substr(commandAckStart));
[0.793s] 5: -        }
[0.793s] 5: -
[0.793s] 5: -        Cyclestat::Cyclestat(const std::string &messageString) : CriMessage(MessageType::CYCLESTAT)
[0.793s] 5: -        {
[0.793s] 5: -            std::string::size_type cyclestatStart = messageString.find(CriKeywords::TYPE_CYCLESTAT) + CriKeywords::TYPE_CYCLESTAT.size();
[0.793s] 5: -            std::string::size_type cycletimeStart = messageString.find(" ", cyclestatStart) + 1;
[0.793s] 5: -            std::string::size_type workloadStart = messageString.find(" ", cycletimeStart) + 1;
[0.793s] 5: -
[0.793s] 5: -            cycletime = std::stoi(messageString.substr(cycletimeStart, workloadStart - cycletimeStart));
[0.793s] 5: -            workload = std::stoi(messageString.substr(workloadStart));
[0.793s] 5: -        }
[0.793s] 5: -
[0.793s] 5: -        ConfigType Config::GetConfigType(const std::string &msg)
[0.793s] 5: -        {
[0.793s] 5: -            std::string::size_type typeStart = msg.find(" ") + 1;
[0.793s] 5: -            std::string::size_type typeEnd = msg.find(" ", typeStart);
[0.793s] 5: -
[0.793s] 5: -            std::string typeString = msg.substr(typeStart, typeEnd - typeStart);
[0.793s] 5: -
[0.793s] 5: -            if (typeString != CriKeywords::TYPE_CONFIG)
[0.793s] 5: -            {
[0.793s] 5: -                RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Got message to parse for config data that was not a config message.");
[0.793s] 5: -                return ConfigType::UNKNOWN;
[0.793s] 5: -            }
[0.793s] 5: -
[0.793s] 5: -            std::string::size_type configTypeStart = typeEnd + 1;
[0.793s] 5: -            std::string::size_type configTypeEnd = msg.find(" ", configTypeStart + 1);
[0.793s] 5: -
[0.794s] 5: -            std::string configTypeString = msg.substr(configTypeStart, configTypeEnd - configTypeStart);
[0.794s] 5: -
[0.794s] 5: -            if (configTypeString == CriKeywords::CONFIG_GETKINEMATICLIMITS_ANSWER)
[0.794s] 5: -            {
[0.794s] 5: -                return ConfigType::KINEMATICLIMITS;
[0.794s] 5: -            }
[0.794s] 5: -
[0.794s] 5: -            RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Unknown config type: \"%s\"", configTypeString.c_str());
[0.794s] 5: -            return ConfigType::UNKNOWN;
[0.794s] 5: -        }
[0.794s] 5: -
[0.794s] 5: -        KinematicLimits::KinematicLimits(const std::string &messageString) : Config(ConfigType::KINEMATICLIMITS)
[0.794s] 5: -        {
[0.794s] 5: -            std::string::size_type answerStart = messageString.find(CriKeywords::CONFIG_GETKINEMATICLIMITS_ANSWER);
[0.794s] 5: -            answerStart += CriKeywords::CONFIG_GETKINEMATICLIMITS_ANSWER.size() + 1;
[0.794s] 5: -
[0.794s] 5: -            std::vector<float> minMax;
[0.794s] 5: -            FillVector(minMax, messageString.substr(answerStart));
[0.794s] 5: -
[0.794s] 5: -            if (minMax.size() % 2 != 0)
[0.794s] 5: -            {
[0.794s] 5: -                RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Error parsing config message of type %d", (int)configType);
[0.794s] 5: -                return;
[0.794s] 5: -            }
[0.794s] 5: -
[0.794s] 5: -            for (size_t i = 0; i < minMax.size(); i += 2)
[0.794s] 5: -            {
[0.794s] 5: -                minMaxPairs.push_back(std::pair<float, float>(minMax.at(i), minMax.at(i + 1)));
[0.794s] 5: -            }
[0.794s] 5: -        }
[0.794s] 5: -
[0.794s] 5: -        std::string KinematicLimits::ToString()
[0.794s] 5: -        {
[0.794s] 5: -            std::ostringstream msg;
[0.794s] 5: -
[0.794s] 5: -            for (size_t i = 0; i < minMaxPairs.size() - 1; i++)
[0.795s] 5: -            {
[0.795s] 5: -                msg << "(" << minMaxPairs.at(i).first << ", " << minMaxPairs.at(i).second << ") ";
[0.795s] 5: -            }
[0.795s] 5: -
[0.795s] 5: -            msg << "(" << minMaxPairs.at(minMaxPairs.size() - 1).first << ", " << minMaxPairs.at(minMaxPairs.size() - 1).second << ")";
[0.795s] 5: -
[0.795s] 5: -            return msg.str();
[0.795s] 5: -        }
[0.795s] 5: -
[0.795s] 5: -        void KinematicLimits::Print()
[0.795s] 5: -        {
[0.795s] 5: -            std::cout << "Kinematic limits: " << ToString() << std::endl;
[0.795s] 5: -        }
[0.795s] 5: +  return msg.str();
[0.795s] 5: +}
[0.795s] 5: +
[0.795s] 5: +Mode Status::GetMode(const std::string & modeString)
[0.795s] 5: +{
[0.795s] 5: +  if (modeString == CriKeywords::MODE_JOINT) {
[0.795s] 5: +    return Mode::JOINT;
[0.795s] 5: +  }
[0.795s] 5: +
[0.795s] 5: +  if (modeString == CriKeywords::MODE_CARTBASE) {
[0.795s] 5: +    return Mode::CARTBASE;
[0.795s] 5: +  }
[0.795s] 5: +
[0.795s] 5: +  if (modeString == CriKeywords::MODE_CARTTOOL) {
[0.795s] 5: +    return Mode::CARTTOOL;
[0.795s] 5: +  }
[0.795s] 5: +
[0.795s] 5: +  if (modeString == CriKeywords::MODE_PLATFORM) {
[0.795s] 5: +    return Mode::PLATFORM;
[0.795s] 5: +  }
[0.795s] 5: +
[0.795s] 5: +  if (modeString == CriKeywords::MODE_FSM) {
[0.795s] 5: +    return Mode::FSM;
[0.796s] 5: +  }
[0.796s] 5: +
[0.796s] 5: +  RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Unknown robot mode during parsing: %s",
[0.796s] 5: +        modeString.c_str());
[0.796s] 5: +  return Mode::UNKNOWN;
[0.796s] 5: +}
[0.796s] 5: +
[0.796s] 5: +Kinstate Status::GetKinstate(const std::string & kinstateString)
[0.796s] 5: +{
[0.796s] 5: +  int kinstateInt = std::stoi(kinstateString);
[0.796s] 5: +
[0.796s] 5: +  switch (kinstateInt) {
[0.796s] 5: +    case (int)Kinstate::NO_ERROR:
[0.796s] 5: +      return Kinstate::NO_ERROR;
[0.796s] 5: +
[0.796s] 5: +    case (int)Kinstate::JOINT_LIMIT_MIN:
[0.796s] 5: +      return Kinstate::JOINT_LIMIT_MIN;
[0.796s] 5: +
[0.796s] 5: +    case (int)Kinstate::JOINT_LIMIT_MAX:
[0.796s] 5: +      return Kinstate::JOINT_LIMIT_MAX;
[0.796s] 5: +
[0.796s] 5: +    case (int)Kinstate::CARTESIAN_SINGULARITY_CENTER:
[0.796s] 5: +      return Kinstate::CARTESIAN_SINGULARITY_CENTER;
[0.796s] 5: +
[0.796s] 5: +    case (int)Kinstate::CARTESIAN_SINGULARITY_REACH:
[0.796s] 5: +      return Kinstate::CARTESIAN_SINGULARITY_REACH;
[0.796s] 5: +
[0.796s] 5: +    case (int)Kinstate::CARTESIAN_SINGULARITY_WRIST:
[0.796s] 5: +      return Kinstate::CARTESIAN_SINGULARITY_WRIST;
[0.796s] 5: +
[0.796s] 5: +    case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_1:
[0.796s] 5: +      return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_1;
[0.796s] 5: +
[0.796s] 5: +    case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_2:
[0.797s] 5: +      return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_2;
[0.797s] 5: +
[0.797s] 5: +    case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_3:
[0.797s] 5: +      return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_3;
[0.797s] 5: +
[0.797s] 5: +    case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_4:
[0.797s] 5: +      return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_4;
[0.797s] 5: +
[0.797s] 5: +    case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_5:
[0.797s] 5: +      return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_5;
[0.797s] 5: +
[0.797s] 5: +    case (int)Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_6:
[0.797s] 5: +      return Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_6;
[0.797s] 5: +
[0.797s] 5: +    case (int)Kinstate::MOTION_NOT_ALLOWED:
[0.797s] 5: +      return Kinstate::MOTION_NOT_ALLOWED;
[0.797s] 5: +
[0.797s] 5: +    default:
[0.797s] 5: +      return Kinstate::UNKNOWN;
[0.797s] 5: +  }
[0.797s] 5: +}
[0.797s] 5: +
[0.797s] 5: +Message::Message(const std::string & messageString)
[0.797s] 5: +: CriMessage(MessageType::MESSAGE)
[0.797s] 5: +{
[0.797s] 5: +  std::string::size_type messageStart =
[0.797s] 5: +    messageString.find(CriKeywords::TYPE_MESSAGE) + CriKeywords::TYPE_MESSAGE.size() + 1;
[0.797s] 5: +  message = messageString.substr(messageStart);
[0.797s] 5: +}
[0.797s] 5: +
[0.797s] 5: +Command::Command(const std::string & messageString)
[0.797s] 5: +: CriMessage(MessageType::CMD)
[0.797s] 5: +{
[0.797s] 5: +  std::string::size_type commandStart =
[0.797s] 5: +    messageString.find(CriKeywords::TYPE_CMD) + CriKeywords::TYPE_CMD.size() + 1;
[0.797s] 5: +  command = messageString.substr(commandStart);
[0.798s] 5: +}
[0.798s] 5: +
[0.798s] 5: +Info::Info(const std::string & messageString)
[0.798s] 5: +: CriMessage(MessageType::INFO)
[0.798s] 5: +{
[0.798s] 5: +  std::string::size_type infoStart =
[0.798s] 5: +    messageString.find(CriKeywords::TYPE_INFO) + CriKeywords::TYPE_INFO.size() + 1;
[0.798s] 5: +  info = messageString.substr(infoStart);
[0.798s] 5: +}
[0.798s] 5: +
[0.798s] 5: +LogMsg::LogMsg(const std::string & messageString)
[0.798s] 5: +: CriMessage(MessageType::LOGMSG)
[0.798s] 5: +{
[0.798s] 5: +  std::string::size_type logLvlStart = messageString.find(CriKeywords::TYPE_LOGMSG) +
[0.798s] 5: +    CriKeywords::TYPE_LOGMSG.size() + 1;
[0.798s] 5: +  std::string::size_type timestampStart = messageString.find(" ", logLvlStart) + 1;
[0.798s] 5: +  std::string::size_type msgStart = messageString.find(" ", timestampStart) + 1;
[0.798s] 5: +
[0.798s] 5: +  logLevel = GetLogLevel(messageString.substr(logLvlStart, (timestampStart - logLvlStart - 1)));
[0.798s] 5: +  timestamp = std::stol(messageString.substr(timestampStart, (msgStart - timestampStart - 1)));
[0.798s] 5: +  logMsg = messageString.substr(msgStart);
[0.798s] 5: +}
[0.798s] 5: +
[0.798s] 5: +LogLevel LogMsg::GetLogLevel(const std::string & logLvlString)
[0.798s] 5: +{
[0.798s] 5: +  if (logLvlString == CriKeywords::LOG_LEVEL_DEBUG) {
[0.798s] 5: +    return LogLevel::DEBUG;
[0.798s] 5: +  }
[0.798s] 5: +
[0.798s] 5: +  if (logLvlString == CriKeywords::LOG_LEVEL_APP_INFO) {
[0.798s] 5: +    return LogLevel::APP_INFO;
[0.798s] 5: +  }
[0.798s] 5: +
[0.798s] 5: +  if (logLvlString == CriKeywords::LOG_LEVEL_APP_ERROR) {
[0.798s] 5: +    return LogLevel::APP_ERROR;
[0.798s] 5: +  }
[0.799s] 5: +
[0.799s] 5: +  if (logLvlString == CriKeywords::LOG_LEVEL_INFO) {
[0.799s] 5: +    return LogLevel::INFO;
[0.799s] 5: +  }
[0.799s] 5: +
[0.799s] 5: +  if (logLvlString == CriKeywords::LOG_LEVEL_WARN) {
[0.799s] 5: +    return LogLevel::WARN;
[0.799s] 5: +  }
[0.799s] 5: +
[0.799s] 5: +  if (logLvlString == CriKeywords::LOG_LEVEL_ERROR) {
[0.799s] 5: +    return LogLevel::ERROR;
[0.799s] 5: +  }
[0.799s] 5: +
[0.799s] 5: +  if (logLvlString == CriKeywords::LOG_LEVEL_FATAL) {
[0.799s] 5: +    return LogLevel::FATAL;
[0.799s] 5: +  }
[0.799s] 5: +
[0.799s] 5: +  RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Unknown log level during parsing: %s",
[0.799s] 5: +        logLvlString.c_str());
[0.799s] 5: +  return LogLevel::UNKNOWN;
[0.799s] 5: +}
[0.799s] 5: +
[0.799s] 5: +Variables::Variables(const std::string & messageString)
[0.799s] 5: +: CriMessage(MessageType::VARIABLES),
[0.799s] 5: +  numberVariables(),
[0.799s] 5: +  positionVariables()
[0.799s] 5: +{
[0.799s] 5: +  std::regex variables_regex("\\S+");
[0.799s] 5: +  auto variables_begin = std::sregex_iterator(messageString.begin(), messageString.end(),
[0.799s] 5: +        variables_regex);
[0.799s] 5: +  auto variables_end = std::sregex_iterator();
[0.799s] 5: +
[0.799s] 5: +  std::sregex_iterator it = variables_begin;
[0.799s] 5: +  while (it != variables_end) {
[0.799s] 5: +    std::string matchStr = GetMatchString((*it));
[0.800s] 5: +
[0.800s] 5: +    if (matchStr.compare(CriKeywords::VARIABLES_NR_VARIABLE) == 0) {
[0.800s] 5: +      NumberVariable nv;
[0.800s] 5: +
[0.800s] 5: +      it++;
[0.800s] 5: +      nv.name = GetMatchString(*it);
[0.800s] 5: +
[0.800s] 5: +      it++;
[0.800s] 5: +      nv.value = std::stod(GetMatchString(*it));
[0.800s] 5: +
[0.800s] 5: +      numberVariables.push_back(nv);
[0.800s] 5: @@ -694 +553,127 @@
[0.800s] 5: -}
[0.800s] 5: +
[0.800s] 5: +    if (matchStr.compare(CriKeywords::VARIABLES_POS_VARIABLE) == 0) {
[0.800s] 5: +      PositionVariable pv;
[0.800s] 5: +
[0.800s] 5: +      it++;
[0.800s] 5: +      pv.name = GetMatchString(*it);
[0.800s] 5: +
[0.800s] 5: +      for (auto i = 0; i < 15; i++) {
[0.800s] 5: +        it++;
[0.800s] 5: +        pv.values[i] = std::stod(GetMatchString(*it));
[0.800s] 5: +      }
[0.800s] 5: +      positionVariables.push_back(pv);
[0.800s] 5: +    }
[0.800s] 5: +
[0.800s] 5: +    it++;
[0.800s] 5: +  }
[0.800s] 5: +}
[0.800s] 5: +
[0.800s] 5: +std::string Variables::GetMatchString(const std::smatch & smatch)
[0.800s] 5: +{
[0.800s] 5: +  std::string matchStr = smatch.str();
[0.800s] 5: +  if (matchStr.length() > 0 && matchStr.back() == ',') {
[0.801s] 5: +    matchStr.pop_back();
[0.801s] 5: +  }
[0.801s] 5: +  return matchStr;
[0.801s] 5: +}
[0.801s] 5: +
[0.801s] 5: +CmdError::CmdError(const std::string & messageString)
[0.801s] 5: +: CriMessage(MessageType::CMDERROR)
[0.801s] 5: +{
[0.801s] 5: +  std::string::size_type commandErrorStart = messageString.find(CriKeywords::TYPE_CMDERROR) +
[0.801s] 5: +    CriKeywords::TYPE_CMDERROR.size();
[0.801s] 5: +  std::string::size_type countStart = messageString.find(" ", commandErrorStart) + 1;
[0.801s] 5: +  std::string::size_type errorMsgStart = messageString.find(" ", countStart) + 1;
[0.801s] 5: +
[0.801s] 5: +  recjectedCmd = std::stoi(messageString.substr(countStart, errorMsgStart - countStart - 1));
[0.801s] 5: +  error = messageString.substr(errorMsgStart);
[0.801s] 5: +}
[0.801s] 5: +
[0.801s] 5: +CmdAck::CmdAck(const std::string & messageString)
[0.801s] 5: +: CriMessage(MessageType::CMDACK)
[0.801s] 5: +{
[0.801s] 5: +  std::string::size_type commandAckStart = messageString.find(CriKeywords::TYPE_CMDACK) +
[0.801s] 5: +    CriKeywords::TYPE_CMDACK.size();
[0.801s] 5: +  acceptedCmd = std::stoi(messageString.substr(commandAckStart));
[0.801s] 5: +}
[0.801s] 5: +
[0.801s] 5: +Cyclestat::Cyclestat(const std::string & messageString)
[0.801s] 5: +: CriMessage(MessageType::CYCLESTAT)
[0.801s] 5: +{
[0.801s] 5: +  std::string::size_type cyclestatStart = messageString.find(CriKeywords::TYPE_CYCLESTAT) +
[0.801s] 5: +    CriKeywords::TYPE_CYCLESTAT.size();
[0.801s] 5: +  std::string::size_type cycletimeStart = messageString.find(" ", cyclestatStart) + 1;
[0.801s] 5: +  std::string::size_type workloadStart = messageString.find(" ", cycletimeStart) + 1;
[0.801s] 5: +
[0.801s] 5: +  cycletime = std::stoi(messageString.substr(cycletimeStart, workloadStart - cycletimeStart));
[0.801s] 5: +  workload = std::stoi(messageString.substr(workloadStart));
[0.802s] 5: +}
[0.802s] 5: +
[0.802s] 5: +ConfigType Config::GetConfigType(const std::string & msg)
[0.802s] 5: +{
[0.802s] 5: +  std::string::size_type typeStart = msg.find(" ") + 1;
[0.802s] 5: +  std::string::size_type typeEnd = msg.find(" ", typeStart);
[0.802s] 5: +
[0.802s] 5: +  std::string typeString = msg.substr(typeStart, typeEnd - typeStart);
[0.802s] 5: +
[0.802s] 5: +  if (typeString != CriKeywords::TYPE_CONFIG) {
[0.802s] 5: +    RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"),
[0.802s] 5: +          "Got message to parse for config data that was not a config message.");
[0.802s] 5: +    return ConfigType::UNKNOWN;
[0.802s] 5: +  }
[0.802s] 5: +
[0.802s] 5: +  std::string::size_type configTypeStart = typeEnd + 1;
[0.802s] 5: +  std::string::size_type configTypeEnd = msg.find(" ", configTypeStart + 1);
[0.802s] 5: +
[0.802s] 5: +  std::string configTypeString = msg.substr(configTypeStart, configTypeEnd - configTypeStart);
[0.802s] 5: +
[0.802s] 5: +  if (configTypeString == CriKeywords::CONFIG_GETKINEMATICLIMITS_ANSWER) {
[0.802s] 5: +    return ConfigType::KINEMATICLIMITS;
[0.802s] 5: +  }
[0.802s] 5: +
[0.802s] 5: +  RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Unknown config type: \"%s\"",
[0.802s] 5: +        configTypeString.c_str());
[0.802s] 5: +  return ConfigType::UNKNOWN;
[0.802s] 5: +}
[0.802s] 5: +
[0.802s] 5: +KinematicLimits::KinematicLimits(const std::string & messageString)
[0.802s] 5: +: Config(ConfigType::KINEMATICLIMITS)
[0.802s] 5: +{
[0.802s] 5: +  std::string::size_type answerStart =
[0.802s] 5: +    messageString.find(CriKeywords::CONFIG_GETKINEMATICLIMITS_ANSWER);
[0.802s] 5: +  answerStart += CriKeywords::CONFIG_GETKINEMATICLIMITS_ANSWER.size() + 1;
[0.803s] 5: +
[0.803s] 5: +  std::vector<float> minMax;
[0.803s] 5: +  FillVector(minMax, messageString.substr(answerStart));
[0.803s] 5: +
[0.803s] 5: +  if (minMax.size() % 2 != 0) {
[0.803s] 5: +    RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Error parsing config message of type %d",
[0.803s] 5: +      (int)configType);
[0.803s] 5: +    return;
[0.803s] 5: +  }
[0.803s] 5: +
[0.803s] 5: +  for (size_t i = 0; i < minMax.size(); i += 2) {
[0.803s] 5: +    minMaxPairs.push_back(std::pair<float, float>(minMax.at(i), minMax.at(i + 1)));
[0.803s] 5: +  }
[0.803s] 5: +}
[0.803s] 5: +
[0.803s] 5: +std::string KinematicLimits::ToString()
[0.803s] 5: +{
[0.803s] 5: +  std::ostringstream msg;
[0.803s] 5: +
[0.803s] 5: +  for (size_t i = 0; i < minMaxPairs.size() - 1; i++) {
[0.803s] 5: +    msg << "(" << minMaxPairs.at(i).first << ", " << minMaxPairs.at(i).second << ") ";
[0.803s] 5: +  }
[0.803s] 5: +
[0.803s] 5: +  msg << "(" << minMaxPairs.at(minMaxPairs.size() - 1).first << ", " <<
[0.803s] 5: +    minMaxPairs.at(minMaxPairs.size() - 1).second << ")";
[0.803s] 5: +
[0.803s] 5: +  return msg.str();
[0.803s] 5: +}
[0.803s] 5: +
[0.803s] 5: +void KinematicLimits::Print()
[0.803s] 5: +{
[0.803s] 5: +  std::cout << "Kinematic limits: " << ToString() << std::endl;
[0.803s] 5: +}
[0.803s] 5: +}
[0.803s] 5: +}
[0.804s] 5: 
[0.804s] 5: Code style divergence in file 'src/Rebel.cpp':
[0.804s] 5: 
[0.804s] 5: --- src/Rebel.cpp
[0.804s] 5: +++ src/Rebel.cpp.uncrustify
[0.804s] 5: @@ -15,8 +15,8 @@
[0.804s] 5: -    Rebel::Rebel()
[0.804s] 5: -    {
[0.804s] 5: -    }
[0.804s] 5: -
[0.804s] 5: -    Rebel::~Rebel()
[0.804s] 5: -    {
[0.804s] 5: -        Stop();
[0.804s] 5: -    }
[0.804s] 5: +Rebel::Rebel()
[0.804s] 5: +{
[0.804s] 5: +}
[0.804s] 5: +
[0.804s] 5: +Rebel::~Rebel()
[0.804s] 5: +{
[0.804s] 5: +  Stop();
[0.804s] 5: +}
[0.804s] 5: @@ -27 +27,17 @@
[0.804s] 5: -    void Rebel::AliveThreadFunction()
[0.804s] 5: +void Rebel::AliveThreadFunction()
[0.804s] 5: +{
[0.804s] 5: +  RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Starting to send ALIVEJOG");
[0.804s] 5: +
[0.804s] 5: +  while (continueAlive) {
[0.804s] 5: +    std::ostringstream msg;
[0.804s] 5: +    msg << std::showpoint;
[0.804s] 5: +    msg << std::fixed;
[0.804s] 5: +    msg << std::setprecision(8);
[0.804s] 5: +    msg << "CRISTART " << Ccnt() << " ";
[0.804s] 5: +    msg << "ALIVEJOG ";
[0.804s] 5: +    msg << j1 << " " << j2 << " " << j3 << " ";
[0.805s] 5: +    msg << j4 << " " << j5 << " " << j6 << " ";
[0.805s] 5: +    msg << 0.0f << " " << 0.0f << " " << 0.0f << " ";
[0.805s] 5: +    msg << "CRIEND" << std::endl;
[0.805s] 5: +
[0.805s] 5: +            // std::cout << msg.str();
[0.805s] 5: @@ -29,3 +45,272 @@
[0.805s] 5: -        RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Starting to send ALIVEJOG");
[0.805s] 5: -
[0.805s] 5: -        while (continueAlive)
[0.805s] 5: +      std::lock_guard<std::mutex> lockGuard(aliveLock);
[0.805s] 5: +      rebelSocket->SendMessage(msg.str());
[0.805s] 5: +    }
[0.805s] 5: +
[0.805s] 5: +    std::this_thread::sleep_for(std::chrono::milliseconds(aliveWaitMs));
[0.805s] 5: +  }
[0.805s] 5: +
[0.805s] 5: +  RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "Stopped to send ALIVEJOG");
[0.805s] 5: +}
[0.805s] 5: +
[0.805s] 5: +void Rebel::MessageThreadFunction()
[0.805s] 5: +{
[0.805s] 5: +  RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Starting to process robot messages");
[0.805s] 5: +
[0.805s] 5: +  while (continueMessage) {
[0.805s] 5: +    if (rebelSocket->HasMessage()) {
[0.805s] 5: +      std::string msg = rebelSocket->GetMessage();
[0.805s] 5: +
[0.805s] 5: +      CriMessages::MessageType type = CriMessages::CriMessage::GetMessageType(msg);
[0.805s] 5: +
[0.805s] 5: +      switch (type) {
[0.805s] 5: +        case CriMessages::MessageType::STATUS:
[0.805s] 5: +          {
[0.805s] 5: +            CriMessages::Status status = CriMessages::Status(msg);
[0.805s] 5: +                    // status.Print();
[0.805s] 5: +            status.Log();
[0.805s] 5: +            currentStatus = status;
[0.806s] 5: +            ProcessStatus(currentStatus);
[0.806s] 5: +            break;
[0.806s] 5: +          }
[0.806s] 5: +
[0.806s] 5: +        case CriMessages::MessageType::RUNSTATE:
[0.806s] 5: +          {
[0.806s] 5: +            break;
[0.806s] 5: +          }
[0.806s] 5: +
[0.806s] 5: +        case CriMessages::MessageType::MESSAGE:
[0.806s] 5: +          {
[0.806s] 5: +            CriMessages::Message message = CriMessages::Message(msg);
[0.806s] 5: +            RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Rebel MESSAGE: %s",
[0.806s] 5: +              message.message.c_str());
[0.806s] 5: +            break;
[0.806s] 5: +          }
[0.806s] 5: +
[0.806s] 5: +        case CriMessages::MessageType::CMD:
[0.806s] 5: +          {
[0.806s] 5: +            CriMessages::Command command = CriMessages::Command(msg);
[0.806s] 5: +
[0.806s] 5: +                    // Not sure if the ROS node should display these?
[0.806s] 5: +            RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "CMD: %s", command.command.c_str());
[0.806s] 5: +            break;
[0.806s] 5: +          }
[0.806s] 5: +
[0.806s] 5: +        case CriMessages::MessageType::CONFIG:
[0.806s] 5: +          {
[0.806s] 5: +            CriMessages::ConfigType configType = CriMessages::Config::GetConfigType(msg);
[0.806s] 5: +
[0.806s] 5: +            switch (configType) {
[0.806s] 5: +              case CriMessages::ConfigType::KINEMATICLIMITS:
[0.806s] 5: +                {
[0.806s] 5: +                  CriMessages::KinematicLimits kinematicLimits = CriMessages::KinematicLimits(msg);
[0.806s] 5: +                  kinematicLimits.Print();
[0.807s] 5: +                  break;
[0.807s] 5: +                }
[0.807s] 5: +              case CriMessages::ConfigType::UNKNOWN:
[0.807s] 5: +                {
[0.807s] 5: +                  RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Unknown config message: %s",
[0.807s] 5: +                  msg.c_str());
[0.807s] 5: +                  break;
[0.807s] 5: +                }
[0.807s] 5: +
[0.807s] 5: +            }
[0.807s] 5: +
[0.807s] 5: +            break;
[0.807s] 5: +          }
[0.807s] 5: +
[0.807s] 5: +        case CriMessages::MessageType::INFO:
[0.807s] 5: +          {
[0.807s] 5: +            CriMessages::Info info = CriMessages::Info(msg);
[0.807s] 5: +            RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "INFO: %s", info.info.c_str());
[0.807s] 5: +            break;
[0.807s] 5: +          }
[0.807s] 5: +
[0.807s] 5: +        case CriMessages::MessageType::LOGMSG:
[0.807s] 5: +          {
[0.807s] 5: +            CriMessages::LogMsg log = CriMessages::LogMsg(msg);
[0.807s] 5: +
[0.807s] 5: +            switch (log.logLevel) {
[0.807s] 5: +              case CriMessages::LogLevel::DEBUG:
[0.807s] 5: +                {
[0.807s] 5: +                  RCLCPP_DEBUG(rclcpp::get_logger("igus_rebel"), "REBEL LOG: %s (%ld ms)",
[0.807s] 5: +                  log.logMsg.c_str(), log.timestamp);
[0.807s] 5: +                  break;
[0.807s] 5: +                }
[0.807s] 5: +
[0.807s] 5: +              case CriMessages::LogLevel::APP_INFO:
[0.807s] 5: +                {
[0.808s] 5: +                  RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "REBEL LOG (APP_INFO): %s (%ld ms)",
[0.808s] 5: +                  log.logMsg.c_str(), log.timestamp);
[0.808s] 5: +                  break;
[0.808s] 5: +                }
[0.808s] 5: +
[0.808s] 5: +              case CriMessages::LogLevel::APP_ERROR:
[0.808s] 5: +                {
[0.808s] 5: +                  RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"),
[0.808s] 5: +                  "REBEL LOG (APP_ERROR): %s (%ld ms)", log.logMsg.c_str(), log.timestamp);
[0.808s] 5: +                  break;
[0.808s] 5: +                }
[0.808s] 5: +
[0.808s] 5: +              case CriMessages::LogLevel::INFO:
[0.808s] 5: +                {
[0.808s] 5: +                        // The Rebel is pretty chatty with its INFO level log messages, so I've set them to output only to the ROS DEBUG level.
[0.808s] 5: +                  RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "REBEL LOG: %s (%ld ms)",
[0.808s] 5: +                  log.logMsg.c_str(), log.timestamp);
[0.808s] 5: +                  break;
[0.808s] 5: +                }
[0.808s] 5: +
[0.808s] 5: +              case CriMessages::LogLevel::WARN:
[0.808s] 5: +                {
[0.808s] 5: +                  RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "REBEL LOG: %s (%ld ms)",
[0.808s] 5: +                  log.logMsg.c_str(), log.timestamp);
[0.808s] 5: +                  break;
[0.808s] 5: +                }
[0.808s] 5: +
[0.808s] 5: +              case CriMessages::LogLevel::ERROR:
[0.808s] 5: +                {
[0.808s] 5: +                  RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "REBEL LOG: %s (%ld ms)",
[0.808s] 5: +                  log.logMsg.c_str(), log.timestamp);
[0.808s] 5: +                  break;
[0.808s] 5: +                }
[0.808s] 5: +
[0.808s] 5: +              case CriMessages::LogLevel::FATAL:
[0.808s] 5: +                {
[0.809s] 5: +                  RCLCPP_FATAL(rclcpp::get_logger("igus_rebel"), "REBEL LOG: %s (%ld ms)",
[0.809s] 5: +                  log.logMsg.c_str(), log.timestamp);
[0.809s] 5: +                  break;
[0.809s] 5: +                }
[0.809s] 5: +
[0.809s] 5: +              case CriMessages::LogLevel::UNKNOWN:
[0.809s] 5: +                {
[0.809s] 5: +                  RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"),
[0.809s] 5: +                  "REBEL LOG (UNKNOWN LOG LEVEL): %s (%ld ms)", log.logMsg.c_str(), log.timestamp);
[0.809s] 5: +                  break;
[0.809s] 5: +                }
[0.809s] 5: +            }
[0.809s] 5: +
[0.809s] 5: +            break;
[0.809s] 5: +          }
[0.809s] 5: +
[0.809s] 5: +        case CriMessages::MessageType::VARIABLES:
[0.809s] 5: +          {
[0.809s] 5: +                    // CriMessages::Variables vars = CriMessages::Variables(msg);
[0.809s] 5: +            break;
[0.809s] 5: +          }
[0.809s] 5: +
[0.809s] 5: +        case CriMessages::MessageType::CMDERROR:
[0.809s] 5: +          {
[0.809s] 5: +            CriMessages::CmdError error = CriMessages::CmdError(msg);
[0.809s] 5: +
[0.809s] 5: +            try {
[0.809s] 5: +              std::string command = unacknowledgedCommands.at(error.recjectedCmd);
[0.809s] 5: +              unacknowledgedCommands.erase(error.recjectedCmd);
[0.809s] 5: +              RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"),
[0.809s] 5: +                "Rebel did not accept command: %s. Error message: %s", command.c_str(),
[0.809s] 5: +                error.error.c_str());
[0.809s] 5: +            } catch (const std::out_of_range & e) {
[0.809s] 5: +              RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"),
[0.809s] 5: +                "Rebel did not accept unknown command. Error message: %s (%d)", error.error.c_str(),
[0.809s] 5: +                error.recjectedCmd);
[0.810s] 5: +            }
[0.810s] 5: +            break;
[0.810s] 5: +          }
[0.810s] 5: +
[0.810s] 5: +        case CriMessages::MessageType::CMDACK:
[0.810s] 5: +          {
[0.810s] 5: +            CriMessages::CmdAck ack = CriMessages::CmdAck(msg);
[0.810s] 5: +
[0.810s] 5: +            try {
[0.810s] 5: +              std::string command = unacknowledgedCommands.at(ack.acceptedCmd);
[0.810s] 5: +              unacknowledgedCommands.erase(ack.acceptedCmd);
[0.810s] 5: +              RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Rebel accepted command: %s",
[0.810s] 5: +                command.c_str());
[0.810s] 5: +              break;
[0.810s] 5: +            } catch (const std::out_of_range & e) {
[0.810s] 5: +              RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "Rebel accepted unknown command: %d",
[0.810s] 5: +                ack.acceptedCmd);
[0.810s] 5: +              break;
[0.810s] 5: +            }
[0.810s] 5: +            break;
[0.810s] 5: +          }
[0.810s] 5: +
[0.810s] 5: +        case CriMessages::MessageType::CYCLESTAT:
[0.810s] 5: +          {
[0.810s] 5: +            CriMessages::Cyclestat cyclestat = CriMessages::Cyclestat(msg);
[0.810s] 5: +                    // Will only output this once every 2 minutes, because this is sent every 0.5 seconds.
[0.810s] 5: +            RCLCPP_INFO_THROTTLE(rclcpp::get_logger("igus_rebel"), *node_->get_clock(), 120,
[0.810s] 5: +              "Rebel cycle statistics -- Cycletime: %d -- Workload: %d%%", cyclestat.cycletime,
[0.810s] 5: +              cyclestat.workload);
[0.810s] 5: +            break;
[0.810s] 5: +          }
[0.810s] 5: +
[0.810s] 5: +        case CriMessages::MessageType::UNKNOWN:
[0.810s] 5: +          {
[0.810s] 5: +            RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "UNKNOW MESSAGE: %s", msg.c_str());
[0.810s] 5: +            break;
[0.811s] 5: +          }
[0.811s] 5: +
[0.811s] 5: +        case CriMessages::MessageType::OPINFO:
[0.811s] 5: +          {
[0.811s] 5: +            break;
[0.811s] 5: +          }
[0.811s] 5: +
[0.811s] 5: +        case CriMessages::MessageType::GSIG:
[0.811s] 5: +          {
[0.811s] 5: +            break;
[0.811s] 5: +          }
[0.811s] 5: +        case CriMessages::MessageType::GRIPPERSTATE:
[0.811s] 5: +          {
[0.811s] 5: +            break;
[0.811s] 5: +          }
[0.811s] 5: +      }
[0.811s] 5: +    }
[0.811s] 5: +  }
[0.811s] 5: +
[0.811s] 5: +  RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "Stopped to process robot messages");
[0.811s] 5: +}
[0.811s] 5: +
[0.811s] 5: +int Rebel::Ccnt()
[0.811s] 5: +{
[0.811s] 5: +  std::lock_guard<std::mutex> lockGuard(cntLock);
[0.811s] 5: +  int current = current_ccnt;
[0.811s] 5: +  current_ccnt = (current_ccnt % 9999) + 1;
[0.811s] 5: +  return current;
[0.811s] 5: +}
[0.811s] 5: +
[0.811s] 5: +void Rebel::SetDigitalOut(const int & output, const bool & is_on)
[0.811s] 5: +{
[0.811s] 5: +  std::ostringstream cmd;
[0.811s] 5: +  cmd << CriKeywords::COMMAND_DOUT << " " << output << " " << (is_on ? "true" : "false");
[0.811s] 5: +  Command(cmd.str());
[0.812s] 5: +}
[0.812s] 5: +
[0.812s] 5: +void Rebel::Command(const std::string & command)
[0.812s] 5: +{
[0.812s] 5: +  int commandCount = Ccnt();
[0.812s] 5: +  std::ostringstream msg;
[0.812s] 5: +  msg << CriKeywords::START << " " << commandCount << " ";
[0.812s] 5: +  msg << CriKeywords::TYPE_CMD << " ";
[0.812s] 5: +  msg << command << " ";
[0.812s] 5: +  msg << CriKeywords::END << std::endl;
[0.812s] 5: +
[0.812s] 5: +  unacknowledgedCommands[commandCount] = command;
[0.812s] 5: +
[0.812s] 5: +  rebelSocket->SendMessage(msg.str());
[0.812s] 5: +}
[0.812s] 5: +
[0.812s] 5: +void Rebel::GetConfig(const std::string & config)
[0.812s] 5: +{
[0.812s] 5: +  std::ostringstream msg;
[0.812s] 5: +  msg << CriKeywords::START << " " << Ccnt() << " ";
[0.812s] 5: +  msg << CriKeywords::TYPE_CONFIG << " ";
[0.812s] 5: +  msg << config << " ";
[0.812s] 5: +  msg << CriKeywords::END << std::endl;
[0.812s] 5: +
[0.812s] 5: +  rebelSocket->SendMessage(msg.str());
[0.812s] 5: +}
[0.812s] 5: +
[0.812s] 5: +void Rebel::SetControlMode(const ControlMode & mode)
[0.812s] 5: +{
[0.812s] 5: +  switch (mode) {
[0.812s] 5: +    case Rebel::ControlMode::POSITION:
[0.812s] 5: +      {
[0.812s] 5: @@ -33,21 +318,36 @@
[0.812s] 5: -            std::ostringstream msg;
[0.812s] 5: -            msg << std::showpoint;
[0.813s] 5: -            msg << std::fixed;
[0.813s] 5: -            msg << std::setprecision(8);
[0.813s] 5: -            msg << "CRISTART " << Ccnt() << " ";
[0.813s] 5: -            msg << "ALIVEJOG ";
[0.813s] 5: -            msg << j1 << " " << j2 << " " << j3 << " ";
[0.813s] 5: -            msg << j4 << " " << j5 << " " << j6 << " ";
[0.813s] 5: -            msg << 0.0f << " " << 0.0f << " " << 0.0f << " ";
[0.813s] 5: -            msg << "CRIEND" << std::endl;
[0.813s] 5: -
[0.813s] 5: -            // std::cout << msg.str();
[0.813s] 5: -            {
[0.813s] 5: -                std::lock_guard<std::mutex> lockGuard(aliveLock);
[0.813s] 5: -                rebelSocket->SendMessage(msg.str());
[0.813s] 5: -            }
[0.813s] 5: -
[0.813s] 5: -            std::this_thread::sleep_for(std::chrono::milliseconds(aliveWaitMs));
[0.813s] 5: -        }
[0.813s] 5: -
[0.813s] 5: -        RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "Stopped to send ALIVEJOG");
[0.813s] 5: +          std::lock_guard<std::mutex> lockGuard(aliveLock);
[0.813s] 5: +
[0.813s] 5: +          j1 = currentStatus.posJointCurrent.at(0);
[0.813s] 5: +          j2 = currentStatus.posJointCurrent.at(1);
[0.813s] 5: +          j3 = currentStatus.posJointCurrent.at(2);
[0.813s] 5: +          j4 = currentStatus.posJointCurrent.at(3);
[0.813s] 5: +          j5 = currentStatus.posJointCurrent.at(4);
[0.813s] 5: +          j6 = currentStatus.posJointCurrent.at(5);
[0.813s] 5: +
[0.813s] 5: +          Command(CriKeywords::COMMAND_MOTIONTYPECARTBASE);
[0.813s] 5: +          controlMode = mode;
[0.813s] 5: +        }
[0.813s] 5: +        RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Rebel now controlled by position control.");
[0.813s] 5: +        break;
[0.813s] 5: +      }
[0.813s] 5: +
[0.813s] 5: +    case Rebel::ControlMode::VELOCITY:
[0.814s] 5: +      {
[0.814s] 5: +        Command(CriKeywords::COMMAND_MOTIONTYPEJOINT);
[0.814s] 5: +        controlMode = mode;
[0.814s] 5: +        RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Rebel now controlled by velocity control.");
[0.814s] 5: +        break;
[0.814s] 5: +      }
[0.814s] 5: +  }
[0.814s] 5: +}
[0.814s] 5: +
[0.814s] 5: +void Rebel::ProcessStatus(const CriMessages::Status & status)
[0.814s] 5: +{
[0.814s] 5: +  CriMessages::Kinstate currentKinstate = status.kinstate;
[0.814s] 5: +  std::array<int, 16> currentErrorJoints = status.errorJoints;
[0.814s] 5: +
[0.814s] 5: +  if (lastKinstate != currentKinstate) {
[0.814s] 5: +
[0.814s] 5: +    if (lastKinstate != CriMessages::Kinstate::NO_ERROR) {
[0.814s] 5: +      RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Kinematics error resolved [%s]",
[0.814s] 5: +          kinstateMessage.c_str());
[0.814s] 5: @@ -56,208 +356,90 @@
[0.814s] 5: -    void Rebel::MessageThreadFunction()
[0.814s] 5: -    {
[0.814s] 5: -        RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Starting to process robot messages");
[0.814s] 5: -
[0.814s] 5: -        while (continueMessage)
[0.814s] 5: -        {
[0.814s] 5: -            if (rebelSocket->HasMessage())
[0.814s] 5: -            {
[0.814s] 5: -                std::string msg = rebelSocket->GetMessage();
[0.814s] 5: -
[0.814s] 5: -                CriMessages::MessageType type = CriMessages::CriMessage::GetMessageType(msg);
[0.814s] 5: -
[0.814s] 5: -                switch (type)
[0.814s] 5: -                {
[0.814s] 5: -                case CriMessages::MessageType::STATUS:
[0.814s] 5: -                {
[0.815s] 5: -                    CriMessages::Status status = CriMessages::Status(msg);
[0.815s] 5: -                    // status.Print();
[0.815s] 5: -                    status.Log();
[0.815s] 5: -                    currentStatus = status;
[0.815s] 5: -                    ProcessStatus(currentStatus);
[0.815s] 5: -                    break;
[0.815s] 5: -                }
[0.815s] 5: -
[0.815s] 5: -                case CriMessages::MessageType::RUNSTATE:
[0.815s] 5: -                {
[0.815s] 5: -                    break;
[0.815s] 5: -                }
[0.815s] 5: -
[0.815s] 5: -                case CriMessages::MessageType::MESSAGE:
[0.815s] 5: -                {
[0.815s] 5: -                    CriMessages::Message message = CriMessages::Message(msg);
[0.815s] 5: -                    RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Rebel MESSAGE: %s", message.message.c_str());
[0.815s] 5: -                    break;
[0.815s] 5: -                }
[0.815s] 5: -
[0.815s] 5: -                case CriMessages::MessageType::CMD:
[0.815s] 5: -                {
[0.815s] 5: -                    CriMessages::Command command = CriMessages::Command(msg);
[0.815s] 5: -
[0.815s] 5: -                    // Not sure if the ROS node should display these?
[0.815s] 5: -                    RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "CMD: %s", command.command.c_str());
[0.815s] 5: -                    break;
[0.815s] 5: -                }
[0.815s] 5: -
[0.815s] 5: -                case CriMessages::MessageType::CONFIG:
[0.815s] 5: -                {
[0.815s] 5: -                    CriMessages::ConfigType configType = CriMessages::Config::GetConfigType(msg);
[0.815s] 5: -
[0.815s] 5: -                    switch (configType)
[0.815s] 5: -                    {
[0.815s] 5: -                    case CriMessages::ConfigType::KINEMATICLIMITS:
[0.816s] 5: -                    {
[0.816s] 5: -                        CriMessages::KinematicLimits kinematicLimits = CriMessages::KinematicLimits(msg);
[0.816s] 5: -                        kinematicLimits.Print();
[0.816s] 5: -                        break;
[0.816s] 5: -                    }
[0.816s] 5: -                    case CriMessages::ConfigType::UNKNOWN:
[0.816s] 5: -                    {
[0.816s] 5: -                        RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Unknown config message: %s", msg.c_str());
[0.816s] 5: -                        break;
[0.816s] 5: -                    }
[0.816s] 5: -
[0.816s] 5: -                    }
[0.816s] 5: -
[0.816s] 5: -                    break;
[0.816s] 5: -                }
[0.816s] 5: -
[0.816s] 5: -                case CriMessages::MessageType::INFO:
[0.816s] 5: -                {
[0.816s] 5: -                    CriMessages::Info info = CriMessages::Info(msg);
[0.816s] 5: -                    RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "INFO: %s", info.info.c_str());
[0.816s] 5: -                    break;
[0.816s] 5: -                }
[0.816s] 5: -
[0.816s] 5: -                case CriMessages::MessageType::LOGMSG:
[0.816s] 5: -                {
[0.816s] 5: -                    CriMessages::LogMsg log = CriMessages::LogMsg(msg);
[0.816s] 5: -
[0.816s] 5: -                    switch (log.logLevel)
[0.816s] 5: -                    {
[0.816s] 5: -                    case CriMessages::LogLevel::DEBUG:
[0.816s] 5: -                    {
[0.816s] 5: -                        RCLCPP_DEBUG(rclcpp::get_logger("igus_rebel"), "REBEL LOG: %s (%ld ms)", log.logMsg.c_str(), log.timestamp);
[0.816s] 5: -                        break;
[0.816s] 5: -                    }
[0.816s] 5: -
[0.816s] 5: -                    case CriMessages::LogLevel::APP_INFO:
[0.817s] 5: -                    {
[0.817s] 5: -                        RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "REBEL LOG (APP_INFO): %s (%ld ms)", log.logMsg.c_str(), log.timestamp);
[0.817s] 5: -                        break;
[0.817s] 5: -                    }
[0.817s] 5: -
[0.817s] 5: -                    case CriMessages::LogLevel::APP_ERROR:
[0.817s] 5: -                    {
[0.817s] 5: -                        RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "REBEL LOG (APP_ERROR): %s (%ld ms)", log.logMsg.c_str(), log.timestamp);
[0.817s] 5: -                        break;
[0.817s] 5: -                    }
[0.817s] 5: -
[0.817s] 5: -                    case CriMessages::LogLevel::INFO:
[0.817s] 5: -                    {
[0.817s] 5: -                        // The Rebel is pretty chatty with its INFO level log messages, so I've set them to output only to the ROS DEBUG level.
[0.817s] 5: -                        RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "REBEL LOG: %s (%ld ms)", log.logMsg.c_str(), log.timestamp);
[0.817s] 5: -                        break;
[0.817s] 5: -                    }
[0.817s] 5: -
[0.817s] 5: -                    case CriMessages::LogLevel::WARN:
[0.817s] 5: -                    {
[0.817s] 5: -                        RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "REBEL LOG: %s (%ld ms)", log.logMsg.c_str(), log.timestamp);
[0.817s] 5: -                        break;
[0.817s] 5: -                    }
[0.817s] 5: -
[0.817s] 5: -                    case CriMessages::LogLevel::ERROR:
[0.817s] 5: -                    {
[0.817s] 5: -                        RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "REBEL LOG: %s (%ld ms)", log.logMsg.c_str(), log.timestamp);
[0.817s] 5: -                        break;
[0.817s] 5: -                    }
[0.817s] 5: -
[0.817s] 5: -                    case CriMessages::LogLevel::FATAL:
[0.817s] 5: -                    {
[0.817s] 5: -                        RCLCPP_FATAL(rclcpp::get_logger("igus_rebel"), "REBEL LOG: %s (%ld ms)", log.logMsg.c_str(), log.timestamp);
[0.817s] 5: -                        break;
[0.817s] 5: -                    }
[0.818s] 5: -
[0.818s] 5: -                    case CriMessages::LogLevel::UNKNOWN:
[0.818s] 5: -                    {
[0.818s] 5: -                        RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "REBEL LOG (UNKNOWN LOG LEVEL): %s (%ld ms)", log.logMsg.c_str(), log.timestamp);
[0.818s] 5: -                        break;
[0.818s] 5: -                    }
[0.818s] 5: -                    }
[0.818s] 5: -
[0.818s] 5: -                    break;
[0.818s] 5: -                }
[0.818s] 5: -
[0.818s] 5: -                case CriMessages::MessageType::VARIABLES:
[0.818s] 5: -                {
[0.818s] 5: -                    // CriMessages::Variables vars = CriMessages::Variables(msg);
[0.818s] 5: -                    break;
[0.818s] 5: -                }
[0.818s] 5: -
[0.818s] 5: -                case CriMessages::MessageType::CMDERROR:
[0.818s] 5: -                {
[0.818s] 5: -                    CriMessages::CmdError error = CriMessages::CmdError(msg);
[0.818s] 5: -
[0.818s] 5: -                    try
[0.818s] 5: -                    {
[0.818s] 5: -                        std::string command = unacknowledgedCommands.at(error.recjectedCmd);
[0.818s] 5: -                        unacknowledgedCommands.erase(error.recjectedCmd);
[0.818s] 5: -                        RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Rebel did not accept command: %s. Error message: %s", command.c_str(), error.error.c_str());
[0.818s] 5: -                    }
[0.818s] 5: -                    catch (const std::out_of_range& e)
[0.818s] 5: -                    {
[0.818s] 5: -                        RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Rebel did not accept unknown command. Error message: %s (%d)", error.error.c_str(), error.recjectedCmd);
[0.818s] 5: -                    }
[0.818s] 5: -                    break;
[0.818s] 5: -                }
[0.818s] 5: -
[0.818s] 5: -                case CriMessages::MessageType::CMDACK:
[0.818s] 5: -                {
[0.818s] 5: -                    CriMessages::CmdAck ack = CriMessages::CmdAck(msg);
[0.819s] 5: -
[0.819s] 5: -                    try
[0.819s] 5: -                    {
[0.819s] 5: -                        std::string command = unacknowledgedCommands.at(ack.acceptedCmd);
[0.819s] 5: -                        unacknowledgedCommands.erase(ack.acceptedCmd);
[0.819s] 5: -                        RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Rebel accepted command: %s", command.c_str());
[0.819s] 5: -                        break;
[0.819s] 5: -                    }
[0.819s] 5: -                    catch (const std::out_of_range& e)
[0.819s] 5: -                    {
[0.819s] 5: -                        RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "Rebel accepted unknown command: %d", ack.acceptedCmd);
[0.819s] 5: -                        break;
[0.819s] 5: -                    }
[0.819s] 5: -                    break;
[0.819s] 5: -                }
[0.819s] 5: -
[0.819s] 5: -                case CriMessages::MessageType::CYCLESTAT:
[0.819s] 5: -                {
[0.819s] 5: -                    CriMessages::Cyclestat cyclestat = CriMessages::Cyclestat(msg);
[0.819s] 5: -                    // Will only output this once every 2 minutes, because this is sent every 0.5 seconds.
[0.819s] 5: -                    RCLCPP_INFO_THROTTLE(rclcpp::get_logger("igus_rebel"), *node_->get_clock(), 120, "Rebel cycle statistics -- Cycletime: %d -- Workload: %d%%", cyclestat.cycletime, cyclestat.workload);
[0.819s] 5: -                    break;
[0.819s] 5: -                }
[0.819s] 5: -
[0.819s] 5: -                case CriMessages::MessageType::UNKNOWN:
[0.819s] 5: -                {
[0.819s] 5: -                    RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "UNKNOW MESSAGE: %s", msg.c_str());
[0.819s] 5: -                    break;
[0.819s] 5: -                }
[0.819s] 5: -
[0.819s] 5: -                case CriMessages::MessageType::OPINFO:
[0.819s] 5: -                {
[0.819s] 5: -                    break;
[0.819s] 5: -                }
[0.819s] 5: -
[0.820s] 5: -                case CriMessages::MessageType::GSIG:
[0.820s] 5: -                {
[0.820s] 5: -                    break;
[0.820s] 5: -                }
[0.820s] 5: -                case CriMessages::MessageType::GRIPPERSTATE:
[0.820s] 5: -                {
[0.820s] 5: -                    break;
[0.820s] 5: -                }
[0.820s] 5: -                }
[0.820s] 5: -            }
[0.820s] 5: -        }
[0.820s] 5: -
[0.820s] 5: -        RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "Stopped to process robot messages");
[0.820s] 5: +    if (currentKinstate != CriMessages::Kinstate::NO_ERROR) {
[0.820s] 5: +
[0.820s] 5: +      switch (status.kinstate) {
[0.820s] 5: +        case CriMessages::Kinstate::JOINT_LIMIT_MIN:
[0.820s] 5: +          {
[0.820s] 5: +            kinstateMessage = "joint at minimum limit";
[0.820s] 5: +            break;
[0.820s] 5: +          }
[0.820s] 5: +
[0.820s] 5: +        case CriMessages::Kinstate::JOINT_LIMIT_MAX:
[0.820s] 5: +          {
[0.820s] 5: +            kinstateMessage = "joint at maximum limit";
[0.820s] 5: +            break;
[0.820s] 5: +          }
[0.820s] 5: +
[0.820s] 5: +        case CriMessages::Kinstate::CARTESIAN_SINGULARITY_CENTER:
[0.820s] 5: +          {
[0.820s] 5: +            kinstateMessage = "cartesian singularity (center)";
[0.820s] 5: +            break;
[0.820s] 5: +          }
[0.820s] 5: +
[0.820s] 5: +        case CriMessages::Kinstate::CARTESIAN_SINGULARITY_REACH:
[0.820s] 5: +          {
[0.821s] 5: +            kinstateMessage = "cartesian singularity (reach)";
[0.821s] 5: +            break;
[0.821s] 5: +          }
[0.821s] 5: +
[0.821s] 5: +        case CriMessages::Kinstate::CARTESIAN_SINGULARITY_WRIST:
[0.821s] 5: +          {
[0.821s] 5: +            kinstateMessage = "cartesian singularity (wrist)";
[0.821s] 5: +            break;
[0.821s] 5: +          }
[0.821s] 5: +
[0.821s] 5: +        case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_1:
[0.821s] 5: +          {
[0.821s] 5: +            kinstateMessage = "tool at virtual box limit 1";
[0.821s] 5: +            break;
[0.821s] 5: +          }
[0.821s] 5: +
[0.821s] 5: +        case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_2:
[0.821s] 5: +          {
[0.821s] 5: +            kinstateMessage = "tool at virtual box limit 2";
[0.821s] 5: +            break;
[0.821s] 5: +          }
[0.821s] 5: +
[0.821s] 5: +        case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_3:
[0.821s] 5: +          {
[0.821s] 5: +            kinstateMessage = "tool at virtual box limit 3";
[0.821s] 5: +            break;
[0.821s] 5: +          }
[0.821s] 5: +
[0.821s] 5: +        case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_4:
[0.821s] 5: +          {
[0.821s] 5: +            kinstateMessage = "tool at virtual box limit 4";
[0.821s] 5: +            break;
[0.821s] 5: +          }
[0.821s] 5: +
[0.821s] 5: +        case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_5:
[0.821s] 5: +          {
[0.822s] 5: +            kinstateMessage = "tool at virtual box limit 5";
[0.822s] 5: +            break;
[0.822s] 5: +          }
[0.822s] 5: +
[0.822s] 5: +        case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_6:
[0.822s] 5: +          {
[0.822s] 5: +            kinstateMessage = "tool at virtual box limit 6";
[0.822s] 5: +            break;
[0.822s] 5: +          }
[0.822s] 5: +
[0.822s] 5: +        case CriMessages::Kinstate::MOTION_NOT_ALLOWED:
[0.822s] 5: +          {
[0.822s] 5: +            kinstateMessage = "motion not allowed";
[0.822s] 5: +            break;
[0.822s] 5: +          }
[0.822s] 5: +
[0.822s] 5: +        case CriMessages::Kinstate::UNKNOWN:
[0.822s] 5: +          {
[0.822s] 5: +            kinstateMessage = "unknown error";
[0.822s] 5: +            break;
[0.822s] 5: +          }
[0.822s] 5: +
[0.822s] 5: +        case CriMessages::Kinstate::NO_ERROR:
[0.822s] 5: +          {
[0.822s] 5: +            kinstateMessage = "no error";
[0.822s] 5: +            break;
[0.822s] 5: +          }
[0.822s] 5: +      }
[0.822s] 5: +
[0.822s] 5: +      RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Kinematics error [%s]",
[0.822s] 5: +          kinstateMessage.c_str());
[0.822s] 5: @@ -265,7 +447,56 @@
[0.822s] 5: -
[0.822s] 5: -    int Rebel::Ccnt()
[0.822s] 5: -    {
[0.822s] 5: -        std::lock_guard<std::mutex> lockGuard(cntLock);
[0.823s] 5: -        int current = current_ccnt;
[0.823s] 5: -        current_ccnt = (current_ccnt % 9999) + 1;
[0.823s] 5: -        return current;
[0.823s] 5: +  }
[0.823s] 5: +
[0.823s] 5: +  if (currentErrorJoints != lastErrorJoints) {
[0.823s] 5: +
[0.823s] 5: +            // loop throught the 6 joint errors
[0.823s] 5: +    for (unsigned int i = 0; i < 6; i++) {
[0.823s] 5: +      int errorJoint = currentErrorJoints.at(i);
[0.823s] 5: +      std::array<int, 8> errorJointBit;
[0.823s] 5: +
[0.823s] 5: +      if (errorJoint != lastErrorJoints.at(i)) {
[0.823s] 5: +
[0.823s] 5: +                    // extract bits from the error to analyze it
[0.823s] 5: +        for (unsigned j = 0; j < 8; j++) {
[0.823s] 5: +          errorJointBit[j] = errorJoint & (int)exp2(j);
[0.823s] 5: +        }
[0.823s] 5: +
[0.823s] 5: +        std::string errorMsg = "";
[0.823s] 5: +        if (errorJointBit.at(0) == static_cast<int>(CriMessages::ErrorJoint::TEMP)) {
[0.823s] 5: +          errorMsg += "'Overtemperature' ";
[0.823s] 5: +        }
[0.823s] 5: +
[0.823s] 5: +        if (errorJointBit.at(1) == static_cast<int>(CriMessages::ErrorJoint::ESTOP_LOWV)) {
[0.823s] 5: +          errorMsg += "'Supply too low: Is emergency button pressed?' ";
[0.823s] 5: +        }
[0.823s] 5: +
[0.823s] 5: +        if (errorJointBit.at(2) == static_cast<int>(CriMessages::ErrorJoint::MNE)) {
[0.823s] 5: +          errorMsg += "'Motor not enabled' ";
[0.823s] 5: +        }
[0.823s] 5: +
[0.823s] 5: +        if (errorJointBit.at(3) == static_cast<int>(CriMessages::ErrorJoint::COM)) {
[0.823s] 5: +          errorMsg += "'Communication watch dog' ";
[0.823s] 5: +        }
[0.823s] 5: +
[0.824s] 5: +        if (errorJointBit.at(4) == static_cast<int>(CriMessages::ErrorJoint::POS)) {
[0.824s] 5: +          errorMsg += "'Position lag' ";
[0.824s] 5: +        }
[0.824s] 5: +
[0.824s] 5: +        if (errorJointBit.at(5) == static_cast<int>(CriMessages::ErrorJoint::ENC)) {
[0.824s] 5: +          errorMsg += "'Encoder Error' ";
[0.824s] 5: +        }
[0.824s] 5: +
[0.824s] 5: +        if (errorJointBit.at(6) == static_cast<int>(CriMessages::ErrorJoint::OC)) {
[0.824s] 5: +          errorMsg += "'Overcurrent' ";
[0.824s] 5: +        }
[0.824s] 5: +
[0.824s] 5: +        if (errorJointBit.at(7) == static_cast<int>(CriMessages::ErrorJoint::DRV)) {
[0.824s] 5: +          errorMsg += "'DriveError/SVM' ";
[0.824s] 5: +        }
[0.824s] 5: +
[0.824s] 5: +        if (errorMsg != "") {
[0.824s] 5: +          RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Joint %i Error: [%s]", i,
[0.824s] 5: +              errorMsg.c_str());
[0.824s] 5: +        } else {
[0.824s] 5: +          RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Joint %i Error: Cleared", i);
[0.824s] 5: +        }
[0.824s] 5: +      }
[0.824s] 5: @@ -273,247 +504,5 @@
[0.824s] 5: -
[0.824s] 5: -    void Rebel::SetDigitalOut(const int &output, const bool &is_on)
[0.824s] 5: -    {
[0.824s] 5: -        std::ostringstream cmd;
[0.824s] 5: -        cmd << CriKeywords::COMMAND_DOUT << " " << output << " " << (is_on ? "true" : "false");
[0.824s] 5: -        Command(cmd.str());
[0.824s] 5: -    }
[0.824s] 5: -
[0.824s] 5: -    void Rebel::Command(const std::string &command)
[0.824s] 5: -    {
[0.824s] 5: -        int commandCount = Ccnt();
[0.824s] 5: -        std::ostringstream msg;
[0.825s] 5: -        msg << CriKeywords::START << " " << commandCount << " ";
[0.825s] 5: -        msg << CriKeywords::TYPE_CMD << " ";
[0.825s] 5: -        msg << command << " ";
[0.825s] 5: -        msg << CriKeywords::END << std::endl;
[0.825s] 5: -
[0.825s] 5: -        unacknowledgedCommands[commandCount] = command;
[0.825s] 5: -
[0.825s] 5: -        rebelSocket->SendMessage(msg.str());
[0.825s] 5: -    }
[0.825s] 5: -
[0.825s] 5: -    void Rebel::GetConfig(const std::string &config)
[0.825s] 5: -    {
[0.825s] 5: -        std::ostringstream msg;
[0.825s] 5: -        msg << CriKeywords::START << " " << Ccnt() << " ";
[0.825s] 5: -        msg << CriKeywords::TYPE_CONFIG << " ";
[0.825s] 5: -        msg << config << " ";
[0.825s] 5: -        msg << CriKeywords::END << std::endl;
[0.825s] 5: -
[0.825s] 5: -        rebelSocket->SendMessage(msg.str());
[0.825s] 5: -    }
[0.825s] 5: -
[0.825s] 5: -    void Rebel::SetControlMode(const ControlMode &mode)
[0.825s] 5: -    {
[0.825s] 5: -        switch (mode)
[0.825s] 5: -        {
[0.825s] 5: -        case Rebel::ControlMode::POSITION:
[0.825s] 5: -        {
[0.825s] 5: -            {
[0.825s] 5: -                std::lock_guard<std::mutex> lockGuard(aliveLock);
[0.825s] 5: -
[0.825s] 5: -                j1 = currentStatus.posJointCurrent.at(0);
[0.825s] 5: -                j2 = currentStatus.posJointCurrent.at(1);
[0.825s] 5: -                j3 = currentStatus.posJointCurrent.at(2);
[0.825s] 5: -                j4 = currentStatus.posJointCurrent.at(3);
[0.825s] 5: -                j5 = currentStatus.posJointCurrent.at(4);
[0.825s] 5: -                j6 = currentStatus.posJointCurrent.at(5);
[0.826s] 5: -
[0.826s] 5: -                Command(CriKeywords::COMMAND_MOTIONTYPECARTBASE);
[0.826s] 5: -                controlMode = mode;
[0.826s] 5: -            }
[0.826s] 5: -            RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Rebel now controlled by position control.");
[0.826s] 5: -            break;
[0.826s] 5: -        }
[0.826s] 5: -
[0.826s] 5: -        case Rebel::ControlMode::VELOCITY:
[0.826s] 5: -        {
[0.826s] 5: -            Command(CriKeywords::COMMAND_MOTIONTYPEJOINT);
[0.826s] 5: -            controlMode = mode;
[0.826s] 5: -            RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Rebel now controlled by velocity control.");
[0.826s] 5: -            break;
[0.826s] 5: -        }
[0.826s] 5: -        }
[0.826s] 5: -    }
[0.826s] 5: -
[0.826s] 5: -    void Rebel::ProcessStatus(const CriMessages::Status &status)
[0.826s] 5: -    {
[0.826s] 5: -        CriMessages::Kinstate currentKinstate = status.kinstate;
[0.826s] 5: -        std::array<int, 16> currentErrorJoints = status.errorJoints;
[0.826s] 5: -
[0.826s] 5: -        if (lastKinstate != currentKinstate)
[0.826s] 5: -        {
[0.826s] 5: -
[0.826s] 5: -            if (lastKinstate != CriMessages::Kinstate::NO_ERROR)
[0.826s] 5: -            {
[0.826s] 5: -                RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Kinematics error resolved [%s]", kinstateMessage.c_str());
[0.826s] 5: -            }
[0.826s] 5: -
[0.826s] 5: -            if (currentKinstate != CriMessages::Kinstate::NO_ERROR)
[0.826s] 5: -            {
[0.826s] 5: -
[0.826s] 5: -                switch (status.kinstate)
[0.826s] 5: -                {
[0.827s] 5: -                case CriMessages::Kinstate::JOINT_LIMIT_MIN:
[0.827s] 5: -                {
[0.827s] 5: -                    kinstateMessage = "joint at minimum limit";
[0.827s] 5: -                    break;
[0.827s] 5: -                }
[0.827s] 5: -
[0.827s] 5: -                case CriMessages::Kinstate::JOINT_LIMIT_MAX:
[0.827s] 5: -                {
[0.827s] 5: -                    kinstateMessage = "joint at maximum limit";
[0.827s] 5: -                    break;
[0.827s] 5: -                }
[0.827s] 5: -
[0.827s] 5: -                case CriMessages::Kinstate::CARTESIAN_SINGULARITY_CENTER:
[0.827s] 5: -                {
[0.827s] 5: -                    kinstateMessage = "cartesian singularity (center)";
[0.827s] 5: -                    break;
[0.827s] 5: -                }
[0.827s] 5: -
[0.827s] 5: -                case CriMessages::Kinstate::CARTESIAN_SINGULARITY_REACH:
[0.827s] 5: -                {
[0.827s] 5: -                    kinstateMessage = "cartesian singularity (reach)";
[0.827s] 5: -                    break;
[0.827s] 5: -                }
[0.827s] 5: -
[0.827s] 5: -                case CriMessages::Kinstate::CARTESIAN_SINGULARITY_WRIST:
[0.827s] 5: -                {
[0.827s] 5: -                    kinstateMessage = "cartesian singularity (wrist)";
[0.827s] 5: -                    break;
[0.827s] 5: -                }
[0.827s] 5: -
[0.827s] 5: -                case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_1:
[0.827s] 5: -                {
[0.827s] 5: -                    kinstateMessage = "tool at virtual box limit 1";
[0.827s] 5: -                    break;
[0.827s] 5: -                }
[0.827s] 5: -
[0.827s] 5: -                case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_2:
[0.828s] 5: -                {
[0.828s] 5: -                    kinstateMessage = "tool at virtual box limit 2";
[0.828s] 5: -                    break;
[0.828s] 5: -                }
[0.828s] 5: -
[0.828s] 5: -                case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_3:
[0.828s] 5: -                {
[0.828s] 5: -                    kinstateMessage = "tool at virtual box limit 3";
[0.828s] 5: -                    break;
[0.828s] 5: -                }
[0.828s] 5: -
[0.828s] 5: -                case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_4:
[0.828s] 5: -                {
[0.828s] 5: -                    kinstateMessage = "tool at virtual box limit 4";
[0.828s] 5: -                    break;
[0.828s] 5: -                }
[0.828s] 5: -
[0.828s] 5: -                case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_5:
[0.828s] 5: -                {
[0.828s] 5: -                    kinstateMessage = "tool at virtual box limit 5";
[0.828s] 5: -                    break;
[0.828s] 5: -                }
[0.828s] 5: -
[0.828s] 5: -                case CriMessages::Kinstate::TOOL_AT_VIRTUAL_BOX_LIMIT_6:
[0.828s] 5: -                {
[0.828s] 5: -                    kinstateMessage = "tool at virtual box limit 6";
[0.828s] 5: -                    break;
[0.828s] 5: -                }
[0.828s] 5: -
[0.828s] 5: -                case CriMessages::Kinstate::MOTION_NOT_ALLOWED:
[0.828s] 5: -                {
[0.828s] 5: -                    kinstateMessage = "motion not allowed";
[0.828s] 5: -                    break;
[0.828s] 5: -                }
[0.828s] 5: -
[0.828s] 5: -                case CriMessages::Kinstate::UNKNOWN:
[0.829s] 5: -                {
[0.829s] 5: -                    kinstateMessage = "unknown error";
[0.829s] 5: -                    break;
[0.829s] 5: -                }
[0.829s] 5: -
[0.829s] 5: -                case CriMessages::Kinstate::NO_ERROR:
[0.829s] 5: -                {
[0.829s] 5: -                    kinstateMessage = "no error";
[0.829s] 5: -                    break;
[0.829s] 5: -                }
[0.829s] 5: -                }
[0.829s] 5: -
[0.829s] 5: -                RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Kinematics error [%s]", kinstateMessage.c_str());
[0.829s] 5: -            }
[0.829s] 5: -        }
[0.829s] 5: -
[0.829s] 5: -        if (currentErrorJoints != lastErrorJoints)
[0.829s] 5: -        {
[0.829s] 5: -
[0.829s] 5: -            // loop throught the 6 joint errors
[0.829s] 5: -            for (unsigned int i = 0; i < 6; i++)
[0.829s] 5: -            {
[0.829s] 5: -                int errorJoint = currentErrorJoints.at(i);
[0.829s] 5: -                std::array<int, 8> errorJointBit;
[0.829s] 5: -
[0.829s] 5: -                if (errorJoint != lastErrorJoints.at(i))
[0.829s] 5: -                {
[0.829s] 5: -
[0.829s] 5: -                    // extract bits from the error to analyze it
[0.829s] 5: -                    for (unsigned j = 0; j < 8; j++)
[0.829s] 5: -                    {
[0.829s] 5: -                        errorJointBit[j] = errorJoint & (int)exp2(j);
[0.829s] 5: -                    }
[0.829s] 5: -
[0.829s] 5: -                    std::string errorMsg = "";
[0.829s] 5: -                    if (errorJointBit.at(0) == static_cast<int>(CriMessages::ErrorJoint::TEMP))
[0.830s] 5: -                    {
[0.830s] 5: -                        errorMsg += "'Overtemperature' ";
[0.830s] 5: -                    }
[0.830s] 5: -
[0.830s] 5: -                    if (errorJointBit.at(1) == static_cast<int>(CriMessages::ErrorJoint::ESTOP_LOWV))
[0.830s] 5: -                    {
[0.830s] 5: -                        errorMsg += "'Supply too low: Is emergency button pressed?' ";
[0.830s] 5: -                    }
[0.830s] 5: -
[0.830s] 5: -                    if (errorJointBit.at(2) == static_cast<int>(CriMessages::ErrorJoint::MNE))
[0.830s] 5: -                    {
[0.830s] 5: -                        errorMsg += "'Motor not enabled' ";
[0.830s] 5: -                    }
[0.830s] 5: -
[0.830s] 5: -                    if (errorJointBit.at(3) == static_cast<int>(CriMessages::ErrorJoint::COM))
[0.830s] 5: -                    {
[0.830s] 5: -                        errorMsg += "'Communication watch dog' ";
[0.830s] 5: -                    }
[0.830s] 5: -
[0.830s] 5: -                    if (errorJointBit.at(4) == static_cast<int>(CriMessages::ErrorJoint::POS))
[0.830s] 5: -                    {
[0.830s] 5: -                        errorMsg += "'Position lag' ";
[0.830s] 5: -                    }
[0.830s] 5: -
[0.830s] 5: -                    if (errorJointBit.at(5) == static_cast<int>(CriMessages::ErrorJoint::ENC))
[0.830s] 5: -                    {
[0.830s] 5: -                        errorMsg += "'Encoder Error' ";
[0.830s] 5: -                    }
[0.830s] 5: -
[0.830s] 5: -                    if (errorJointBit.at(6) == static_cast<int>(CriMessages::ErrorJoint::OC))
[0.830s] 5: -                    {
[0.830s] 5: -                        errorMsg += "'Overcurrent' ";
[0.830s] 5: -                    }
[0.830s] 5: -
[0.830s] 5: -                    if (errorJointBit.at(7) == static_cast<int>(CriMessages::ErrorJoint::DRV))
[0.830s] 5: -                    {
[0.831s] 5: -                        errorMsg += "'DriveError/SVM' ";
[0.831s] 5: -                    }
[0.831s] 5: -
[0.831s] 5: -                    if (errorMsg != "")
[0.831s] 5: -                    {
[0.831s] 5: -                        RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Joint %i Error: [%s]", i, errorMsg.c_str());
[0.831s] 5: -                    }
[0.831s] 5: -                    else
[0.831s] 5: -                    {
[0.831s] 5: -                        RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Joint %i Error: Cleared", i);
[0.831s] 5: -                    }
[0.831s] 5: -                }
[0.831s] 5: -            }
[0.831s] 5: -        }
[0.831s] 5: -
[0.831s] 5: -        lastKinstate = currentKinstate;
[0.831s] 5: -        lastErrorJoints = currentErrorJoints;
[0.831s] 5: -    }
[0.831s] 5: +  }
[0.831s] 5: +
[0.831s] 5: +  lastKinstate = currentKinstate;
[0.831s] 5: +  lastErrorJoints = currentErrorJoints;
[0.831s] 5: +}
[0.831s] 5: @@ -524,52 +513,54 @@
[0.831s] 5: -    void Rebel::SetJog(const float &joint1, const float &joint2, const float &joint3,
[0.831s] 5: -                       const float &joint4, const float &joint5, const float &joint6)
[0.831s] 5: -    {
[0.831s] 5: -        j1 = joint1;
[0.831s] 5: -        j2 = joint2;
[0.831s] 5: -        j3 = joint3;
[0.831s] 5: -        j4 = joint4;
[0.831s] 5: -        j5 = joint5;
[0.831s] 5: -        j6 = joint6;
[0.831s] 5: -    }
[0.831s] 5: -
[0.831s] 5: -    void Rebel::GetJoints(float &joint1, float &joint2, float &joint3,
[0.832s] 5: -                          float &joint4, float &joint5, float &joint6)
[0.832s] 5: -    {
[0.832s] 5: -        joint1 = currentStatus.posJointCurrent.at(0);
[0.832s] 5: -        joint2 = currentStatus.posJointCurrent.at(1);
[0.832s] 5: -        joint3 = currentStatus.posJointCurrent.at(2);
[0.832s] 5: -        joint4 = currentStatus.posJointCurrent.at(3);
[0.832s] 5: -        joint5 = currentStatus.posJointCurrent.at(4);
[0.832s] 5: -        joint6 = currentStatus.posJointCurrent.at(5);
[0.832s] 5: -    }
[0.832s] 5: -
[0.832s] 5: -    CallbackReturn Rebel::on_init(const HardwareInfo&)
[0.832s] 5: -    {
[0.832s] 5: -        rebelSocket = std::make_shared<RebelSocket>(ip, port, 200),
[0.832s] 5: -        j1 = 0.0f;
[0.832s] 5: -        j2 = 0.0f;
[0.832s] 5: -        j3 = 0.0f;
[0.832s] 5: -        j4 = 0.0f;
[0.832s] 5: -        j5 = 0.0f;
[0.832s] 5: -        j6 = 0.0f;
[0.832s] 5: -        controlMode = Rebel::ControlMode::VELOCITY;
[0.832s] 5: -        current_ccnt = 1;
[0.832s] 5: -        continueAlive = false;
[0.832s] 5: -        continueMessage = false;
[0.832s] 5: -        aliveWaitMs = 100;
[0.832s] 5: -        lastKinstate = CriMessages::Kinstate::NO_ERROR;
[0.832s] 5: -        kinstateMessage = "";
[0.832s] 5: -        node_ = std::make_shared<rclcpp::Node>("igus_rebel");
[0.832s] 5: -        digital_output_srv_ = node_->create_service<igus_rebel_msgs::srv::SetDigitalOutput>(
[0.832s] 5: -            "set_digital_output", std::bind(&Rebel::dio_callback, this, std::placeholders::_1, std::placeholders::_2));
[0.832s] 5: -        Start();
[0.832s] 5: -        return CallbackReturn::SUCCESS;
[0.832s] 5: -    }
[0.832s] 5: -
[0.832s] 5: -    std::vector<StateInterface> Rebel::export_state_interfaces()
[0.832s] 5: -    {
[0.832s] 5: -        std::vector<StateInterface> state_interfaces;
[0.833s] 5: -
[0.833s] 5: -        for (int i = 0; i < 6; ++i)
[0.833s] 5: -        {
[0.833s] 5: -            state_interfaces.emplace_back(StateInterface(
[0.833s] 5: +void Rebel::SetJog(
[0.833s] 5: +  const float & joint1, const float & joint2, const float & joint3,
[0.833s] 5: +  const float & joint4, const float & joint5, const float & joint6)
[0.833s] 5: +{
[0.833s] 5: +  j1 = joint1;
[0.833s] 5: +  j2 = joint2;
[0.833s] 5: +  j3 = joint3;
[0.833s] 5: +  j4 = joint4;
[0.833s] 5: +  j5 = joint5;
[0.833s] 5: +  j6 = joint6;
[0.833s] 5: +}
[0.833s] 5: +
[0.833s] 5: +void Rebel::GetJoints(
[0.833s] 5: +  float & joint1, float & joint2, float & joint3,
[0.833s] 5: +  float & joint4, float & joint5, float & joint6)
[0.833s] 5: +{
[0.833s] 5: +  joint1 = currentStatus.posJointCurrent.at(0);
[0.833s] 5: +  joint2 = currentStatus.posJointCurrent.at(1);
[0.833s] 5: +  joint3 = currentStatus.posJointCurrent.at(2);
[0.833s] 5: +  joint4 = currentStatus.posJointCurrent.at(3);
[0.833s] 5: +  joint5 = currentStatus.posJointCurrent.at(4);
[0.833s] 5: +  joint6 = currentStatus.posJointCurrent.at(5);
[0.833s] 5: +}
[0.833s] 5: +
[0.833s] 5: +CallbackReturn Rebel::on_init(const HardwareInfo &)
[0.833s] 5: +{
[0.833s] 5: +  rebelSocket = std::make_shared<RebelSocket>(ip, port, 200),
[0.833s] 5: +  j1 = 0.0f;
[0.833s] 5: +  j2 = 0.0f;
[0.833s] 5: +  j3 = 0.0f;
[0.833s] 5: +  j4 = 0.0f;
[0.833s] 5: +  j5 = 0.0f;
[0.833s] 5: +  j6 = 0.0f;
[0.834s] 5: +  controlMode = Rebel::ControlMode::VELOCITY;
[0.834s] 5: +  current_ccnt = 1;
[0.834s] 5: +  continueAlive = false;
[0.834s] 5: +  continueMessage = false;
[0.834s] 5: +  aliveWaitMs = 100;
[0.834s] 5: +  lastKinstate = CriMessages::Kinstate::NO_ERROR;
[0.834s] 5: +  kinstateMessage = "";
[0.834s] 5: +  node_ = std::make_shared<rclcpp::Node>("igus_rebel");
[0.834s] 5: +  digital_output_srv_ = node_->create_service<igus_rebel_msgs::srv::SetDigitalOutput>(
[0.834s] 5: +            "set_digital_output",
[0.834s] 5: +      std::bind(&Rebel::dio_callback, this, std::placeholders::_1, std::placeholders::_2));
[0.834s] 5: +  Start();
[0.834s] 5: +  return CallbackReturn::SUCCESS;
[0.834s] 5: +}
[0.834s] 5: +
[0.834s] 5: +std::vector<StateInterface> Rebel::export_state_interfaces()
[0.834s] 5: +{
[0.834s] 5: +  std::vector<StateInterface> state_interfaces;
[0.834s] 5: +
[0.834s] 5: +  for (int i = 0; i < 6; ++i) {
[0.834s] 5: +    state_interfaces.emplace_back(StateInterface(
[0.834s] 5: @@ -577 +568 @@
[0.834s] 5: -            state_interfaces.emplace_back(StateInterface(
[0.834s] 5: +    state_interfaces.emplace_back(StateInterface(
[0.834s] 5: @@ -579,12 +570,11 @@
[0.834s] 5: -        }
[0.834s] 5: -
[0.834s] 5: -        return state_interfaces;
[0.834s] 5: -    }
[0.834s] 5: -
[0.834s] 5: -    std::vector<CommandInterface> Rebel::export_command_interfaces()
[0.834s] 5: -    {
[0.834s] 5: -        std::vector<CommandInterface> command_interfaces;
[0.834s] 5: -
[0.834s] 5: -        for (int i = 0; i < 6; ++i)
[0.834s] 5: -        {
[0.835s] 5: -            command_interfaces.emplace_back(CommandInterface(
[0.835s] 5: +  }
[0.835s] 5: +
[0.835s] 5: +  return state_interfaces;
[0.835s] 5: +}
[0.835s] 5: +
[0.835s] 5: +std::vector<CommandInterface> Rebel::export_command_interfaces()
[0.835s] 5: +{
[0.835s] 5: +  std::vector<CommandInterface> command_interfaces;
[0.835s] 5: +
[0.835s] 5: +  for (int i = 0; i < 6; ++i) {
[0.835s] 5: +    command_interfaces.emplace_back(CommandInterface(
[0.835s] 5: @@ -592,37 +582,37 @@
[0.835s] 5: -        }
[0.835s] 5: -
[0.835s] 5: -        return command_interfaces;
[0.835s] 5: -    }
[0.835s] 5: -
[0.835s] 5: -    return_type Rebel::read(const rclcpp::Time&, const rclcpp::Duration &period)
[0.835s] 5: -    {
[0.835s] 5: -        read();
[0.835s] 5: -
[0.835s] 5: -        vel[0] = (pos[0] - last_pos[0]) / period.seconds();
[0.835s] 5: -        vel[1] = (pos[1] - last_pos[1]) / period.seconds();
[0.835s] 5: -        vel[2] = (pos[2] - last_pos[2]) / period.seconds();
[0.835s] 5: -        vel[3] = (pos[3] - last_pos[3]) / period.seconds();
[0.835s] 5: -        vel[4] = (pos[4] - last_pos[4]) / period.seconds();
[0.835s] 5: -        vel[5] = (pos[5] - last_pos[5]) / period.seconds();
[0.835s] 5: -
[0.835s] 5: -        last_pos[0] = pos[0];
[0.835s] 5: -        last_pos[1] = pos[1];
[0.835s] 5: -        last_pos[2] = pos[2];
[0.835s] 5: -        last_pos[3] = pos[3];
[0.835s] 5: -        last_pos[4] = pos[4];
[0.835s] 5: -        last_pos[5] = pos[5];
[0.835s] 5: -        return return_type::OK;
[0.835s] 5: -    }
[0.836s] 5: -
[0.836s] 5: -    void Rebel::read()
[0.836s] 5: -    {
[0.836s] 5: -        pos[0] = currentStatus.posJointCurrent.at(0) * degToRad;
[0.836s] 5: -        pos[1] = currentStatus.posJointCurrent.at(1) * degToRad;
[0.836s] 5: -        pos[2] = currentStatus.posJointCurrent.at(2) * degToRad;
[0.836s] 5: -        pos[3] = currentStatus.posJointCurrent.at(3) * degToRad;
[0.836s] 5: -        pos[4] = currentStatus.posJointCurrent.at(4) * degToRad;
[0.836s] 5: -        pos[5] = currentStatus.posJointCurrent.at(5) * degToRad;
[0.836s] 5: -    }
[0.836s] 5: -
[0.836s] 5: -    return_type Rebel::write(const rclcpp::Time&, const rclcpp::Duration&)
[0.836s] 5: -    {
[0.836s] 5: +  }
[0.836s] 5: +
[0.836s] 5: +  return command_interfaces;
[0.836s] 5: +}
[0.836s] 5: +
[0.836s] 5: +return_type Rebel::read(const rclcpp::Time &, const rclcpp::Duration & period)
[0.836s] 5: +{
[0.836s] 5: +  read();
[0.836s] 5: +
[0.836s] 5: +  vel[0] = (pos[0] - last_pos[0]) / period.seconds();
[0.836s] 5: +  vel[1] = (pos[1] - last_pos[1]) / period.seconds();
[0.836s] 5: +  vel[2] = (pos[2] - last_pos[2]) / period.seconds();
[0.836s] 5: +  vel[3] = (pos[3] - last_pos[3]) / period.seconds();
[0.836s] 5: +  vel[4] = (pos[4] - last_pos[4]) / period.seconds();
[0.836s] 5: +  vel[5] = (pos[5] - last_pos[5]) / period.seconds();
[0.836s] 5: +
[0.836s] 5: +  last_pos[0] = pos[0];
[0.836s] 5: +  last_pos[1] = pos[1];
[0.836s] 5: +  last_pos[2] = pos[2];
[0.836s] 5: +  last_pos[3] = pos[3];
[0.836s] 5: +  last_pos[4] = pos[4];
[0.836s] 5: +  last_pos[5] = pos[5];
[0.836s] 5: +  return return_type::OK;
[0.836s] 5: +}
[0.837s] 5: +
[0.837s] 5: +void Rebel::read()
[0.837s] 5: +{
[0.837s] 5: +  pos[0] = currentStatus.posJointCurrent.at(0) * degToRad;
[0.837s] 5: +  pos[1] = currentStatus.posJointCurrent.at(1) * degToRad;
[0.837s] 5: +  pos[2] = currentStatus.posJointCurrent.at(2) * degToRad;
[0.837s] 5: +  pos[3] = currentStatus.posJointCurrent.at(3) * degToRad;
[0.837s] 5: +  pos[4] = currentStatus.posJointCurrent.at(4) * degToRad;
[0.837s] 5: +  pos[5] = currentStatus.posJointCurrent.at(5) * degToRad;
[0.837s] 5: +}
[0.837s] 5: +
[0.837s] 5: +return_type Rebel::write(const rclcpp::Time &, const rclcpp::Duration &)
[0.837s] 5: +{
[0.837s] 5: @@ -630,6 +620,6 @@
[0.837s] 5: -        write();
[0.837s] 5: -        return return_type::OK;
[0.837s] 5: -    }
[0.837s] 5: -
[0.837s] 5: -    void Rebel::write()
[0.837s] 5: -    {
[0.837s] 5: +  write();
[0.837s] 5: +  return return_type::OK;
[0.837s] 5: +}
[0.837s] 5: +
[0.837s] 5: +void Rebel::write()
[0.837s] 5: +{
[0.837s] 5: @@ -637,32 +627,31 @@
[0.837s] 5: -        if (rclcpp::ok())
[0.837s] 5: -        {
[0.837s] 5: -            rclcpp::spin_some(node_);
[0.837s] 5: -        }
[0.837s] 5: -
[0.837s] 5: -        j1 = (float)vel_cmd[0];
[0.837s] 5: -        j2 = (float)vel_cmd[1];
[0.837s] 5: -        j3 = (float)vel_cmd[2];
[0.837s] 5: -        j4 = (float)vel_cmd[3];
[0.837s] 5: -        j5 = (float)vel_cmd[4];
[0.837s] 5: -        j6 = (float)vel_cmd[5];
[0.838s] 5: -    }
[0.838s] 5: -
[0.838s] 5: -    void Rebel::dio_callback(
[0.838s] 5: -        const std::shared_ptr<igus_rebel_msgs::srv::SetDigitalOutput::Request> request,
[0.838s] 5: -        std::shared_ptr<igus_rebel_msgs::srv::SetDigitalOutput::Response> response)
[0.838s] 5: -    {
[0.838s] 5: -        SetDigitalOut(request->output.output, request->output.is_on);
[0.838s] 5: -        response->success = true;
[0.838s] 5: -    }
[0.838s] 5: -
[0.838s] 5: -    void Rebel::GetReferenceInfo()
[0.838s] 5: -    {
[0.838s] 5: -        Command(std::string("GetReferencingInfo"));
[0.838s] 5: -    }
[0.838s] 5: -
[0.838s] 5: -    void Rebel::Start()
[0.838s] 5: -    {
[0.838s] 5: -        continueMessage = true;
[0.838s] 5: -        messageThread = std::thread(&Rebel::MessageThreadFunction, this);
[0.838s] 5: -
[0.838s] 5: -        rebelSocket->Start();
[0.838s] 5: +  if (rclcpp::ok()) {
[0.838s] 5: +    rclcpp::spin_some(node_);
[0.838s] 5: +  }
[0.838s] 5: +
[0.838s] 5: +  j1 = (float)vel_cmd[0];
[0.838s] 5: +  j2 = (float)vel_cmd[1];
[0.838s] 5: +  j3 = (float)vel_cmd[2];
[0.838s] 5: +  j4 = (float)vel_cmd[3];
[0.838s] 5: +  j5 = (float)vel_cmd[4];
[0.838s] 5: +  j6 = (float)vel_cmd[5];
[0.838s] 5: +}
[0.838s] 5: +
[0.838s] 5: +void Rebel::dio_callback(
[0.838s] 5: +  const std::shared_ptr<igus_rebel_msgs::srv::SetDigitalOutput::Request> request,
[0.838s] 5: +  std::shared_ptr<igus_rebel_msgs::srv::SetDigitalOutput::Response> response)
[0.838s] 5: +{
[0.839s] 5: +  SetDigitalOut(request->output.output, request->output.is_on);
[0.839s] 5: +  response->success = true;
[0.839s] 5: +}
[0.839s] 5: +
[0.839s] 5: +void Rebel::GetReferenceInfo()
[0.839s] 5: +{
[0.839s] 5: +  Command(std::string("GetReferencingInfo"));
[0.839s] 5: +}
[0.839s] 5: +
[0.839s] 5: +void Rebel::Start()
[0.839s] 5: +{
[0.839s] 5: +  continueMessage = true;
[0.839s] 5: +  messageThread = std::thread(&Rebel::MessageThreadFunction, this);
[0.839s] 5: +
[0.839s] 5: +  rebelSocket->Start();
[0.839s] 5: @@ -673,30 +662,29 @@
[0.839s] 5: -        Command(CriKeywords::COMMAND_SETACTIVE + " true");
[0.839s] 5: -        Command(CriKeywords::COMMAND_RESET);
[0.839s] 5: -        Command(CriKeywords::COMMAND_ENABLE);
[0.839s] 5: -
[0.839s] 5: -        continueAlive = true;
[0.839s] 5: -        aliveThread = std::thread(&Rebel::AliveThreadFunction, this);
[0.839s] 5: -
[0.839s] 5: -        GetConfig(CriKeywords::CONFIG_GETKINEMATICLIMITS);
[0.839s] 5: -        SetControlMode(ControlMode::VELOCITY);
[0.839s] 5: -    }
[0.839s] 5: -
[0.839s] 5: -    void Rebel::Stop()
[0.839s] 5: -    {
[0.839s] 5: -        j1 = 0.0f;
[0.839s] 5: -        j2 = 0.0f;
[0.839s] 5: -        j3 = 0.0f;
[0.839s] 5: -        j4 = 0.0f;
[0.839s] 5: -        j5 = 0.0f;
[0.839s] 5: -        j6 = 0.0f;
[0.839s] 5: -
[0.839s] 5: -        std::this_thread::sleep_for(std::chrono::milliseconds(aliveWaitMs + 10));
[0.839s] 5: -
[0.840s] 5: -        continueAlive = false;
[0.840s] 5: -
[0.840s] 5: -        if (aliveThread.joinable())
[0.840s] 5: -        {
[0.840s] 5: -            aliveThread.join();
[0.840s] 5: -        }
[0.840s] 5: -
[0.840s] 5: -        Command(CriKeywords::COMMAND_DISABLE);
[0.840s] 5: +  Command(CriKeywords::COMMAND_SETACTIVE + " true");
[0.840s] 5: +  Command(CriKeywords::COMMAND_RESET);
[0.840s] 5: +  Command(CriKeywords::COMMAND_ENABLE);
[0.840s] 5: +
[0.840s] 5: +  continueAlive = true;
[0.840s] 5: +  aliveThread = std::thread(&Rebel::AliveThreadFunction, this);
[0.840s] 5: +
[0.840s] 5: +  GetConfig(CriKeywords::CONFIG_GETKINEMATICLIMITS);
[0.840s] 5: +  SetControlMode(ControlMode::VELOCITY);
[0.840s] 5: +}
[0.840s] 5: +
[0.840s] 5: +void Rebel::Stop()
[0.840s] 5: +{
[0.840s] 5: +  j1 = 0.0f;
[0.840s] 5: +  j2 = 0.0f;
[0.840s] 5: +  j3 = 0.0f;
[0.840s] 5: +  j4 = 0.0f;
[0.840s] 5: +  j5 = 0.0f;
[0.840s] 5: +  j6 = 0.0f;
[0.840s] 5: +
[0.840s] 5: +  std::this_thread::sleep_for(std::chrono::milliseconds(aliveWaitMs + 10));
[0.840s] 5: +
[0.840s] 5: +  continueAlive = false;
[0.840s] 5: +
[0.840s] 5: +  if (aliveThread.joinable()) {
[0.840s] 5: +    aliveThread.join();
[0.840s] 5: +  }
[0.840s] 5: +
[0.840s] 5: +  Command(CriKeywords::COMMAND_DISABLE);
[0.840s] 5: @@ -704,11 +692,10 @@
[0.841s] 5: -        Command(CriKeywords::COMMAND_QUIT);
[0.841s] 5: -
[0.841s] 5: -        rebelSocket->Stop();
[0.841s] 5: -
[0.841s] 5: -        continueMessage = false;
[0.841s] 5: -
[0.841s] 5: -        if (messageThread.joinable())
[0.841s] 5: -        {
[0.841s] 5: -            messageThread.join();
[0.841s] 5: -        }
[0.841s] 5: -    }
[0.841s] 5: +  Command(CriKeywords::COMMAND_QUIT);
[0.841s] 5: +
[0.841s] 5: +  rebelSocket->Stop();
[0.841s] 5: +
[0.841s] 5: +  continueMessage = false;
[0.841s] 5: +
[0.841s] 5: +  if (messageThread.joinable()) {
[0.841s] 5: +    messageThread.join();
[0.841s] 5: +  }
[0.841s] 5: +}
[0.841s] 5: 
[0.841s] 5: Code style divergence in file 'src/RebelSocket.cpp':
[0.841s] 5: 
[0.841s] 5: --- src/RebelSocket.cpp
[0.841s] 5: +++ src/RebelSocket.cpp.uncrustify
[0.841s] 5: @@ -15,14 +15,14 @@
[0.841s] 5: -    RebelSocket::RebelSocket(const std::string &ip, const int &port, const int &timeout)
[0.841s] 5: -        : sock(0),
[0.841s] 5: -          ip(ip),
[0.841s] 5: -          port(port),
[0.841s] 5: -          timeout(timeout),
[0.841s] 5: -          unprocessedMessages(),
[0.841s] 5: -          fragmentBuffer{0}
[0.841s] 5: -    {
[0.841s] 5: -    }
[0.841s] 5: -
[0.841s] 5: -    RebelSocket::~RebelSocket()
[0.842s] 5: -    {
[0.842s] 5: -        Stop();
[0.842s] 5: -    }
[0.842s] 5: +RebelSocket::RebelSocket(const std::string & ip, const int & port, const int & timeout)
[0.842s] 5: +: sock(0),
[0.842s] 5: +  ip(ip),
[0.842s] 5: +  port(port),
[0.842s] 5: +  timeout(timeout),
[0.842s] 5: +  unprocessedMessages(),
[0.842s] 5: +  fragmentBuffer{0}
[0.842s] 5: +{
[0.842s] 5: +}
[0.842s] 5: +
[0.842s] 5: +RebelSocket::~RebelSocket()
[0.842s] 5: +{
[0.842s] 5: +  Stop();
[0.842s] 5: +}
[0.842s] 5: @@ -33,2 +33,2 @@
[0.842s] 5: -    void RebelSocket::MakeConnection()
[0.842s] 5: -    {
[0.842s] 5: +void RebelSocket::MakeConnection()
[0.842s] 5: +{
[0.842s] 5: @@ -37,16 +37,14 @@
[0.842s] 5: -        std::lock_guard<std::mutex> lockGuard(connectionLock);
[0.842s] 5: -
[0.842s] 5: -        while (connectionNeeded)
[0.842s] 5: -        {
[0.842s] 5: -            sock = 0;
[0.842s] 5: -            struct sockaddr_in serv_addr;
[0.842s] 5: -
[0.842s] 5: -            if ((sock = socket(AF_INET, SOCK_STREAM, 0)) < 0)
[0.842s] 5: -            {
[0.842s] 5: -                RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Socket creation error.");
[0.842s] 5: -                std::this_thread::sleep_for(std::chrono::milliseconds(100));
[0.842s] 5: -                continue;
[0.842s] 5: -            }
[0.842s] 5: -
[0.842s] 5: -            serv_addr.sin_family = AF_INET;
[0.843s] 5: -            serv_addr.sin_port = htons(port);
[0.843s] 5: +  std::lock_guard<std::mutex> lockGuard(connectionLock);
[0.843s] 5: +
[0.843s] 5: +  while (connectionNeeded) {
[0.843s] 5: +    sock = 0;
[0.843s] 5: +    struct sockaddr_in serv_addr;
[0.843s] 5: +
[0.843s] 5: +    if ((sock = socket(AF_INET, SOCK_STREAM, 0)) < 0) {
[0.843s] 5: +      RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Socket creation error.");
[0.843s] 5: +      std::this_thread::sleep_for(std::chrono::milliseconds(100));
[0.843s] 5: +      continue;
[0.843s] 5: +    }
[0.843s] 5: +
[0.843s] 5: +    serv_addr.sin_family = AF_INET;
[0.843s] 5: +    serv_addr.sin_port = htons(port);
[0.843s] 5: @@ -55,16 +53,42 @@
[0.843s] 5: -            if (inet_pton(AF_INET, ip.c_str(), &serv_addr.sin_addr) <= 0)
[0.843s] 5: -            {
[0.843s] 5: -                RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Invalid robot IP address / Address not supported.");
[0.843s] 5: -                std::this_thread::sleep_for(std::chrono::milliseconds(100));
[0.843s] 5: -                continue;
[0.843s] 5: -            }
[0.843s] 5: -
[0.843s] 5: -            if (connect(sock, (struct sockaddr *)&serv_addr, sizeof(serv_addr)) < 0)
[0.843s] 5: -            {
[0.843s] 5: -                RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Connection Failed.");
[0.843s] 5: -                std::this_thread::sleep_for(std::chrono::milliseconds(100));
[0.843s] 5: -                continue;
[0.843s] 5: -            }
[0.843s] 5: -
[0.843s] 5: -            connectionNeeded = false;
[0.843s] 5: -            RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Connected to ReBeL at %s:%d", ip.c_str(), port);
[0.843s] 5: +    if (inet_pton(AF_INET, ip.c_str(), &serv_addr.sin_addr) <= 0) {
[0.843s] 5: +      RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"),
[0.843s] 5: +          "Invalid robot IP address / Address not supported.");
[0.843s] 5: +      std::this_thread::sleep_for(std::chrono::milliseconds(100));
[0.843s] 5: +      continue;
[0.844s] 5: +    }
[0.844s] 5: +
[0.844s] 5: +    if (connect(sock, (struct sockaddr *)&serv_addr, sizeof(serv_addr)) < 0) {
[0.844s] 5: +      RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Connection Failed.");
[0.844s] 5: +      std::this_thread::sleep_for(std::chrono::milliseconds(100));
[0.844s] 5: +      continue;
[0.844s] 5: +    }
[0.844s] 5: +
[0.844s] 5: +    connectionNeeded = false;
[0.844s] 5: +    RCLCPP_INFO(rclcpp::get_logger("igus_rebel"), "Connected to ReBeL at %s:%d", ip.c_str(), port);
[0.844s] 5: +  }
[0.844s] 5: +}
[0.844s] 5: +
[0.844s] 5: +void RebelSocket::SeparateMessages(const char *msg)
[0.844s] 5: +{
[0.844s] 5: +  const char *start;
[0.844s] 5: +  const char *end = msg;
[0.844s] 5: +
[0.844s] 5: +  while (true) {
[0.844s] 5: +    start = std::strstr(end, CriKeywords::START.c_str());
[0.844s] 5: +
[0.844s] 5: +    if (start == nullptr) {
[0.844s] 5: +      break;
[0.844s] 5: +    }
[0.844s] 5: +
[0.844s] 5: +    end = std::strstr(start, CriKeywords::END.c_str());
[0.844s] 5: +
[0.844s] 5: +    if (end == nullptr) {
[0.844s] 5: +                // Found a start without end.
[0.844s] 5: +      const char *remainingStart = start + CriKeywords::START.size();
[0.844s] 5: +      const char *remainingEnd = std::strchr(remainingStart, '\0');
[0.844s] 5: +
[0.844s] 5: +      if (remainingEnd != nullptr) {
[0.844s] 5: +        fragmentLength = remainingEnd - remainingStart;
[0.844s] 5: +
[0.844s] 5: +        for (int i = 0; i < fragmentLength; i++) {
[0.844s] 5: +          fragmentBuffer[i] = *(remainingStart + i);
[0.845s] 5: @@ -72,3 +96,8 @@
[0.845s] 5: -    }
[0.845s] 5: -
[0.845s] 5: -    void RebelSocket::SeparateMessages(const char *msg)
[0.845s] 5: +      } else {
[0.845s] 5: +        RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"),
[0.845s] 5: +            "Socket read was not null-terminated, somehow.");
[0.845s] 5: +      }
[0.845s] 5: +
[0.845s] 5: +      break;
[0.845s] 5: +    }
[0.845s] 5: +
[0.845s] 5: @@ -76,40 +105,2 @@
[0.845s] 5: -        const char *start;
[0.845s] 5: -        const char *end = msg;
[0.845s] 5: -
[0.845s] 5: -        while (true)
[0.845s] 5: -        {
[0.845s] 5: -            start = std::strstr(end, CriKeywords::START.c_str());
[0.845s] 5: -
[0.845s] 5: -            if (start == nullptr)
[0.845s] 5: -            {
[0.845s] 5: -                break;
[0.845s] 5: -            }
[0.845s] 5: -
[0.845s] 5: -            end = std::strstr(start, CriKeywords::END.c_str());
[0.845s] 5: -
[0.845s] 5: -            if (end == nullptr)
[0.845s] 5: -            {
[0.845s] 5: -                // Found a start without end.
[0.845s] 5: -                const char *remainingStart = start + CriKeywords::START.size();
[0.845s] 5: -                const char *remainingEnd = std::strchr(remainingStart, '\0');
[0.845s] 5: -
[0.845s] 5: -                if (remainingEnd != nullptr)
[0.845s] 5: -                {
[0.845s] 5: -                    fragmentLength = remainingEnd - remainingStart;
[0.845s] 5: -
[0.845s] 5: -                    for (int i = 0; i < fragmentLength; i++)
[0.846s] 5: -                    {
[0.846s] 5: -                        fragmentBuffer[i] = *(remainingStart + i);
[0.846s] 5: -                    }
[0.846s] 5: -                }
[0.846s] 5: -                else
[0.846s] 5: -                {
[0.846s] 5: -                    RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Socket read was not null-terminated, somehow.");
[0.846s] 5: -                }
[0.846s] 5: -
[0.846s] 5: -                break;
[0.846s] 5: -            }
[0.846s] 5: -
[0.846s] 5: -            {
[0.846s] 5: -                std::lock_guard<std::mutex> lockGuard(messageLock);
[0.846s] 5: -                unprocessedMessages.push_front(
[0.846s] 5: +      std::lock_guard<std::mutex> lockGuard(messageLock);
[0.846s] 5: +      unprocessedMessages.push_front(
[0.846s] 5: @@ -119 +110,29 @@
[0.846s] 5: -            }
[0.846s] 5: +    }
[0.846s] 5: +  }
[0.846s] 5: +}
[0.846s] 5: +
[0.846s] 5: +void RebelSocket::ReceiveThreadFunction()
[0.846s] 5: +{
[0.846s] 5: +  RCLCPP_DEBUG(rclcpp::get_logger("igus_rebel"), "Starting to receive messages from robot.");
[0.846s] 5: +
[0.846s] 5: +  char buffer[bufferSize * 2] = {0};
[0.846s] 5: +
[0.846s] 5: +  while (continueReceive) {
[0.846s] 5: +    if (connectionNeeded) {
[0.846s] 5: +      MakeConnection();
[0.846s] 5: +    }
[0.846s] 5: +
[0.846s] 5: +    int valread = read(sock, buffer + fragmentLength, bufferSize);
[0.846s] 5: +
[0.846s] 5: +    if (!IsSocketOk()) {
[0.847s] 5: +      connectionNeeded = true;
[0.847s] 5: +    } else {
[0.847s] 5: +      if (valread == 0) {
[0.847s] 5: +        RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "Empty message received");
[0.847s] 5: +        connectionNeeded = true;
[0.847s] 5: +      } else {
[0.847s] 5: +        if (fragmentLength > 0) {
[0.847s] 5: +          for (int i = 0; i < fragmentLength; i++) {
[0.847s] 5: +            buffer[i] = fragmentBuffer[i];
[0.847s] 5: +          }
[0.847s] 5: +          fragmentLength = 0;
[0.847s] 5: @@ -121,46 +140,4 @@
[0.847s] 5: -    }
[0.847s] 5: -
[0.847s] 5: -    void RebelSocket::ReceiveThreadFunction()
[0.847s] 5: -    {
[0.847s] 5: -        RCLCPP_DEBUG(rclcpp::get_logger("igus_rebel"), "Starting to receive messages from robot.");
[0.847s] 5: -
[0.847s] 5: -        char buffer[bufferSize * 2] = {0};
[0.847s] 5: -
[0.847s] 5: -        while (continueReceive)
[0.847s] 5: -        {
[0.847s] 5: -            if (connectionNeeded)
[0.847s] 5: -            {
[0.847s] 5: -                MakeConnection();
[0.847s] 5: -            }
[0.847s] 5: -
[0.847s] 5: -            int valread = read(sock, buffer + fragmentLength, bufferSize);
[0.847s] 5: -
[0.847s] 5: -            if (!IsSocketOk())
[0.847s] 5: -            {
[0.847s] 5: -                connectionNeeded = true;
[0.847s] 5: -            }
[0.847s] 5: -            else
[0.847s] 5: -            {
[0.847s] 5: -                if (valread == 0)
[0.847s] 5: -                {
[0.847s] 5: -                    RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "Empty message received");
[0.848s] 5: -                    connectionNeeded = true;
[0.848s] 5: -                }
[0.848s] 5: -                else
[0.848s] 5: -                {
[0.848s] 5: -                    if (fragmentLength > 0)
[0.848s] 5: -                    {
[0.848s] 5: -                        for (int i = 0; i < fragmentLength; i++)
[0.848s] 5: -                        {
[0.848s] 5: -                            buffer[i] = fragmentBuffer[i];
[0.848s] 5: -                        }
[0.848s] 5: -                        fragmentLength = 0;
[0.848s] 5: -                    }
[0.848s] 5: -
[0.848s] 5: -                    SeparateMessages(buffer);
[0.848s] 5: -                    for (int i = 0; i < bufferSize * 2; i++)
[0.848s] 5: -                    {
[0.848s] 5: -                        buffer[i] = 0;
[0.848s] 5: -                    }
[0.848s] 5: -                }
[0.848s] 5: -            }
[0.848s] 5: +
[0.848s] 5: +        SeparateMessages(buffer);
[0.848s] 5: +        for (int i = 0; i < bufferSize * 2; i++) {
[0.848s] 5: +          buffer[i] = 0;
[0.848s] 5: @@ -168,3 +145,6 @@
[0.848s] 5: -
[0.848s] 5: -        RCLCPP_DEBUG(rclcpp::get_logger("igus_rebel"), "Stopped to receive messages from robot.");
[0.848s] 5: -    }
[0.848s] 5: +      }
[0.848s] 5: +    }
[0.848s] 5: +  }
[0.848s] 5: +
[0.848s] 5: +  RCLCPP_DEBUG(rclcpp::get_logger("igus_rebel"), "Stopped to receive messages from robot.");
[0.848s] 5: +}
[0.848s] 5: @@ -175,42 +155,41 @@
[0.848s] 5: -    void RebelSocket::ListCheckThreadFunction()
[0.848s] 5: -    {
[0.849s] 5: -        RCLCPP_DEBUG(rclcpp::get_logger("igus_rebel"), "Starting to check if the message list is being processed.");
[0.849s] 5: -
[0.849s] 5: -        while (continueReceive)
[0.849s] 5: -        {
[0.849s] 5: -            if (unprocessedMessages.size() > maxUnprocessedMessages)
[0.849s] 5: -            {
[0.849s] 5: -                RCLCPP_WARN(rclcpp::get_logger("igus_rebel"), "Robot messages are not processed fast enough. Discarding messages.");
[0.849s] 5: -
[0.849s] 5: -                while (unprocessedMessages.size() > (maxUnprocessedMessages * 0.9))
[0.849s] 5: -                {
[0.849s] 5: -                    unprocessedMessages.pop_back();
[0.849s] 5: -                }
[0.849s] 5: -            }
[0.849s] 5: -
[0.849s] 5: -            std::this_thread::sleep_for(std::chrono::milliseconds(listCheckWaitMs));
[0.849s] 5: -        }
[0.849s] 5: -
[0.849s] 5: -        RCLCPP_DEBUG(rclcpp::get_logger("igus_rebel"), "Stopped to check if the message list is being processed.");
[0.849s] 5: -    }
[0.849s] 5: -
[0.849s] 5: -    bool RebelSocket::IsSocketOk()
[0.849s] 5: -    {
[0.849s] 5: -        int error = 0;
[0.849s] 5: -        socklen_t len = sizeof(error);
[0.849s] 5: -        int retval = getsockopt(sock, SOL_SOCKET, SO_ERROR, &error, &len);
[0.849s] 5: -
[0.849s] 5: -        if (retval != 0)
[0.849s] 5: -        {
[0.849s] 5: -            RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Error getting socket error code: %s", strerror(retval));
[0.849s] 5: -            return false;
[0.849s] 5: -        }
[0.849s] 5: -
[0.849s] 5: -        if (error != 0)
[0.849s] 5: -        {
[0.849s] 5: -            RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Socket error: %s", strerror(error));
[0.849s] 5: -            return false;
[0.849s] 5: -        }
[0.849s] 5: -
[0.850s] 5: -        return true;
[0.850s] 5: -    }
[0.850s] 5: +void RebelSocket::ListCheckThreadFunction()
[0.850s] 5: +{
[0.850s] 5: +  RCLCPP_DEBUG(rclcpp::get_logger("igus_rebel"),
[0.850s] 5: +      "Starting to check if the message list is being processed.");
[0.850s] 5: +
[0.850s] 5: +  while (continueReceive) {
[0.850s] 5: +    if (unprocessedMessages.size() > maxUnprocessedMessages) {
[0.850s] 5: +      RCLCPP_WARN(rclcpp::get_logger("igus_rebel"),
[0.850s] 5: +          "Robot messages are not processed fast enough. Discarding messages.");
[0.850s] 5: +
[0.850s] 5: +      while (unprocessedMessages.size() > (maxUnprocessedMessages * 0.9)) {
[0.850s] 5: +        unprocessedMessages.pop_back();
[0.850s] 5: +      }
[0.850s] 5: +    }
[0.850s] 5: +
[0.850s] 5: +    std::this_thread::sleep_for(std::chrono::milliseconds(listCheckWaitMs));
[0.850s] 5: +  }
[0.850s] 5: +
[0.850s] 5: +  RCLCPP_DEBUG(rclcpp::get_logger("igus_rebel"),
[0.850s] 5: +      "Stopped to check if the message list is being processed.");
[0.850s] 5: +}
[0.850s] 5: +
[0.850s] 5: +bool RebelSocket::IsSocketOk()
[0.850s] 5: +{
[0.850s] 5: +  int error = 0;
[0.850s] 5: +  socklen_t len = sizeof(error);
[0.850s] 5: +  int retval = getsockopt(sock, SOL_SOCKET, SO_ERROR, &error, &len);
[0.850s] 5: +
[0.850s] 5: +  if (retval != 0) {
[0.850s] 5: +    RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Error getting socket error code: %s",
[0.850s] 5: +        strerror(retval));
[0.850s] 5: +    return false;
[0.850s] 5: +  }
[0.850s] 5: +
[0.850s] 5: +  if (error != 0) {
[0.850s] 5: +    RCLCPP_ERROR(rclcpp::get_logger("igus_rebel"), "Socket error: %s", strerror(error));
[0.851s] 5: +    return false;
[0.851s] 5: +  }
[0.851s] 5: +
[0.851s] 5: +  return true;
[0.851s] 5: +}
[0.851s] 5: @@ -221,67 +200,61 @@
[0.851s] 5: -    void RebelSocket::Start()
[0.851s] 5: -    {
[0.851s] 5: -        connectionNeeded = true;
[0.851s] 5: -        continueReceive = true;
[0.851s] 5: -
[0.851s] 5: -        listCheckThread = std::thread(&RebelSocket::ListCheckThreadFunction, this);
[0.851s] 5: -        receiveThread = std::thread(&RebelSocket::ReceiveThreadFunction, this);
[0.851s] 5: -    }
[0.851s] 5: -
[0.851s] 5: -    void RebelSocket::Stop()
[0.851s] 5: -    {
[0.851s] 5: -        connectionNeeded = false;
[0.851s] 5: -        continueReceive = false;
[0.851s] 5: -
[0.851s] 5: -        if (receiveThread.joinable())
[0.851s] 5: -        {
[0.851s] 5: -            receiveThread.join();
[0.851s] 5: -        }
[0.851s] 5: -
[0.851s] 5: -        if (listCheckThread.joinable())
[0.851s] 5: -        {
[0.851s] 5: -            listCheckThread.join();
[0.851s] 5: -        }
[0.851s] 5: -    }
[0.851s] 5: -
[0.851s] 5: -    bool RebelSocket::HasMessage()
[0.851s] 5: -    {
[0.851s] 5: -        return unprocessedMessages.size() > 0;
[0.851s] 5: -    }
[0.851s] 5: -
[0.851s] 5: -    std::string RebelSocket::GetMessage()
[0.851s] 5: -    {
[0.852s] 5: -        std::lock_guard<std::mutex> lockGuard(messageLock);
[0.852s] 5: -
[0.852s] 5: -        if (!HasMessage())
[0.852s] 5: -        {
[0.852s] 5: -            return "";
[0.852s] 5: -        }
[0.852s] 5: -
[0.852s] 5: -        std::string msg = unprocessedMessages.back();
[0.852s] 5: -        unprocessedMessages.pop_back();
[0.852s] 5: -
[0.852s] 5: -        return msg;
[0.852s] 5: -    }
[0.852s] 5: -
[0.852s] 5: -    void RebelSocket::SendMessage(const std::string &msg)
[0.852s] 5: -    {
[0.852s] 5: -        std::lock_guard<std::mutex> lockGuard(socketWriteLock);
[0.852s] 5: -
[0.852s] 5: -        if (connectionNeeded)
[0.852s] 5: -        {
[0.852s] 5: -            MakeConnection();
[0.852s] 5: -        }
[0.852s] 5: -
[0.852s] 5: -        int sent = send(sock, msg.c_str(), msg.length(), 0);
[0.852s] 5: -
[0.852s] 5: -        if (!IsSocketOk())
[0.852s] 5: -        {
[0.852s] 5: -            connectionNeeded = true;
[0.852s] 5: -        }
[0.852s] 5: -
[0.852s] 5: -        if (sent < 0)
[0.852s] 5: -        {
[0.852s] 5: -            connectionNeeded = true;
[0.852s] 5: -        }
[0.852s] 5: -    }
[0.852s] 5: -}
[0.852s] 5: +void RebelSocket::Start()
[0.852s] 5: +{
[0.853s] 5: +  connectionNeeded = true;
[0.853s] 5: +  continueReceive = true;
[0.853s] 5: +
[0.853s] 5: +  listCheckThread = std::thread(&RebelSocket::ListCheckThreadFunction, this);
[0.853s] 5: +  receiveThread = std::thread(&RebelSocket::ReceiveThreadFunction, this);
[0.853s] 5: +}
[0.853s] 5: +
[0.853s] 5: +void RebelSocket::Stop()
[0.853s] 5: +{
[0.853s] 5: +  connectionNeeded = false;
[0.853s] 5: +  continueReceive = false;
[0.853s] 5: +
[0.853s] 5: +  if (receiveThread.joinable()) {
[0.853s] 5: +    receiveThread.join();
[0.853s] 5: +  }
[0.853s] 5: +
[0.853s] 5: +  if (listCheckThread.joinable()) {
[0.853s] 5: +    listCheckThread.join();
[0.853s] 5: +  }
[0.853s] 5: +}
[0.853s] 5: +
[0.853s] 5: +bool RebelSocket::HasMessage()
[0.853s] 5: +{
[0.853s] 5: +  return unprocessedMessages.size() > 0;
[0.853s] 5: +}
[0.853s] 5: +
[0.853s] 5: +std::string RebelSocket::GetMessage()
[0.853s] 5: +{
[0.853s] 5: +  std::lock_guard<std::mutex> lockGuard(messageLock);
[0.853s] 5: +
[0.853s] 5: +  if (!HasMessage()) {
[0.853s] 5: +    return "";
[0.853s] 5: +  }
[0.853s] 5: +
[0.853s] 5: +  std::string msg = unprocessedMessages.back();
[0.853s] 5: +  unprocessedMessages.pop_back();
[0.853s] 5: +
[0.853s] 5: +  return msg;
[0.854s] 5: +}
[0.854s] 5: +
[0.854s] 5: +void RebelSocket::SendMessage(const std::string & msg)
[0.854s] 5: +{
[0.854s] 5: +  std::lock_guard<std::mutex> lockGuard(socketWriteLock);
[0.854s] 5: +
[0.854s] 5: +  if (connectionNeeded) {
[0.854s] 5: +    MakeConnection();
[0.854s] 5: +  }
[0.854s] 5: +
[0.854s] 5: +  int sent = send(sock, msg.c_str(), msg.length(), 0);
[0.854s] 5: +
[0.854s] 5: +  if (!IsSocketOk()) {
[0.854s] 5: +    connectionNeeded = true;
[0.854s] 5: +  }
[0.854s] 5: +
[0.854s] 5: +  if (sent < 0) {
[0.854s] 5: +    connectionNeeded = true;
[0.854s] 5: +  }
[0.854s] 5: +}
[0.854s] 5: +}
[0.854s] 5: 
[0.854s] 5: 7 files with code style divergence
[0.854s] 5: -- run_test.py: return code 1
[0.854s] 5: -- run_test.py: verify result file '/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/uncrustify.xunit.xml'
[0.854s] 5/6 Test #5: uncrustify .......................***Failed    0.23 sec
[0.854s] test 6
[0.854s]     Start 6: xmllint
[0.854s] 
[0.854s] 6: Test command: /usr/bin/python3 "-u" "/opt/ros/jazzy/share/ament_cmake_test/cmake/run_test.py" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/xmllint.xunit.xml" "--package-name" "igus_rebel" "--output-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/ament_xmllint/xmllint.txt" "--command" "/opt/ros/jazzy/bin/ament_xmllint" "--xunit-file" "/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/xmllint.xunit.xml"
[0.854s] 6: Working Directory: /home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel
[0.854s] 6: Test timeout computed to be: 60
[0.854s] 6: -- run_test.py: invoking following command in '/home/amrl-linux24-04/ros2_ben/src/igus_rebel_ros2/igus_rebel':
[0.854s] 6:  - /opt/ros/jazzy/bin/ament_xmllint --xunit-file /home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/xmllint.xunit.xml
[1.350s] 6: File 'package.xml' is valid
[1.350s] 6: 
[1.350s] 6: File 'rebel.xml' is valid
[1.350s] 6: 
[1.350s] 6: No problems found
[1.359s] 6: -- run_test.py: return code 0
[1.359s] 6: -- run_test.py: verify result file '/home/amrl-linux24-04/ros2_ben/build/igus_rebel/test_results/igus_rebel/xmllint.xunit.xml'
[1.366s] 6/6 Test #6: xmllint ..........................   Passed    0.61 sec
[1.366s] 
[1.366s] 50% tests passed[0;0m, [0;31m3 tests failed[0;0m out of 6
[1.366s] 
[1.367s] Label Time Summary:
[1.367s] cppcheck      =   0.10 sec*proc (1 test)
[1.367s] flake8        =   0.19 sec*proc (1 test)
[1.367s] lint_cmake    =   0.09 sec*proc (1 test)
[1.367s] linter        =   1.34 sec*proc (6 tests)
[1.367s] pep257        =   0.12 sec*proc (1 test)
[1.367s] uncrustify    =   0.23 sec*proc (1 test)
[1.367s] xmllint       =   0.61 sec*proc (1 test)
[1.367s] 
[1.367s] Total Test time (real) =   1.34 sec
[1.367s] 
[1.367s] The following tests FAILED:
[1.367s] 	[0;31m  2 - flake8 (Failed)[0;0m
[1.367s] 	[0;31m  3 - lint_cmake (Failed)[0;0m
[1.367s] 	[0;31m  5 - uncrustify (Failed)[0;0m
[1.372s] Errors while running CTest
[1.372s] Output from these tests are in: /home/amrl-linux24-04/ros2_ben/build/igus_rebel/Testing/Temporary/LastTest.log
[1.372s] Use "--rerun-failed --output-on-failure" to re-run the failed cases verbosely.
[1.373s] Invoked command in '/home/amrl-linux24-04/ros2_ben/build/igus_rebel' returned '8': AMENT_PREFIX_PATH=/home/amrl-linux24-04/ros2_ben/install/igus_rebel:/home/amrl-linux24-04/ros2_ben/install/igus_rebel_msgs:${AMENT_PREFIX_PATH} CMAKE_PREFIX_PATH=/home/amrl-linux24-04/ros2_ben/install/igus_rebel:/home/amrl-linux24-04/ros2_ben/install/igus_rebel_msgs:${CMAKE_PREFIX_PATH} DEBUGINFOD_URLS=https://debuginfod.ubuntu.com LD_LIBRARY_PATH=/home/amrl-linux24-04/ros2_ben/install/igus_rebel/lib:/home/amrl-linux24-04/ros2_ben/install/igus_rebel_msgs/lib:${LD_LIBRARY_PATH} PYTHONPATH=/home/amrl-linux24-04/ros2_ben/install/igus_rebel_msgs/lib/python3.12/site-packages:${PYTHONPATH} /usr/bin/ctest -C Release -D ExperimentalTest --no-compress-output -V --force-new-ctest-process
